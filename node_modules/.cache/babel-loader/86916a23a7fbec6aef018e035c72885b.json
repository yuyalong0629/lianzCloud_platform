{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/thread-loader/dist/cjs.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/CustomerInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/CustomerInfo.vue","mtime":1563248233194},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Object$keys from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _Promise from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport PromptTitle from '@/components/tools/prompt/PromptTitle';\nimport CustForm from './CustForm';\nimport ConcatForm from './ContactForm';\nimport InvoiceForm from './InvoiceForm';\nimport AddressForm from './AddressForm';\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin';\nimport { subAddCust, uploadCustomerAndMallUser, removeCustomer } from '../basic_lib/index';\nimport { findParentId } from 'utils/utils.js';\nexport default {\n  name: 'CustomerInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data: function data() {\n    return {\n      customer: {},\n      // 客户信息\n      mallUserNatureDtos: [],\n      // 联系人信息\n      custInvoiceInfo: {},\n      // 发票信息\n      customerAddrList: [],\n      // 地址信息\n      custFormInfo: {},\n      invoiceInfo: {},\n      mallUsersInfo: [],\n      addressInfo: [],\n      custManager: undefined\n    };\n  },\n  props: {\n    customerInfo: {\n      type: Object,\n      default: {},\n      required: false\n    }\n  },\n  created: function created() {},\n  methods: {\n    // 提交\n    onSubmit: function onSubmit(e) {\n      var _this = this;\n\n      e.preventDefault();\n      this.getFormData().then(function () {\n        console.log(_this.mallUserNatureDtos.map(function (item) {\n          delete item.deleted;\n          return _objectSpread({}, item);\n        }));\n        var params = {\n          customer: _objectSpread({}, _this.customer, {\n            custManager: _this.customer.custManagerId.label,\n            custManagerId: _this.customer.custManagerId.key\n          }),\n          mallUsers: _this.mallUserNatureDtos.map(function (item) {\n            delete item.deleted;\n            return _objectSpread({}, item);\n          }),\n          custInvoiceInfo: _objectSpread({}, _this.custInvoiceInfo),\n          customerAddrList: _this.customerAddrList.map(function (item) {\n            delete item.deleted;\n            return _objectSpread({}, item);\n          })\n        };\n        delete params.custInvoiceInfo.deleted;\n        console.log(params);\n        subAddCust.call(_this, params);\n      });\n    },\n    // 保存修改\n    onSave: function onSave(e) {\n      var _this2 = this;\n\n      e.preventDefault();\n      this.getFormData().then(function () {\n        var params = {\n          customer: _objectSpread({}, _this2.customer, {\n            id: _this2.custFormInfo.id,\n            custFrom: _this2.customer.custFrom === '线上注册' ? 0 : 1,\n            custManager: _this2.customer.custManagerId.label,\n            custManagerId: _this2.customer.custManagerId.key\n          }),\n          mallUsers: _toConsumableArray(_this2.mallUserNatureDtos),\n          custInvoiceInfo: _objectSpread({}, _this2.custInvoiceInfo, {\n            id: _this2.invoiceInfo.id,\n            custId: _this2.invoiceInfo.custId,\n            deleted: false\n          }),\n          customerAddrList: _toConsumableArray(_this2.customerAddrList)\n        };\n        console.log(params);\n        uploadCustomerAndMallUser.call(_this2, params);\n      });\n    },\n    // 编辑 || 取消\n    isDisabled: function isDisabled(val) {\n      var _this3 = this;\n\n      var edit = new _Promise(function (resolved) {\n        // Input选中\n        _this3.disabled = !val; // label color\n\n        _this3.isLabelColor = !_this3.isLabelColor;\n        resolved();\n      });\n      edit.then(function () {\n        if (_this3.disabled) {\n          _this3.setFormData();\n        }\n      });\n    },\n    // 删除\n    isDelete: function isDelete(val) {\n      console.log(this.customerInfo.customer.id);\n    },\n    // 联系人数组\n    userNatureDtos: function userNatureDtos(val) {\n      var _this4 = this;\n\n      val.forEach(function (item, index) {\n        _this4.mallUserNatureDtos[index] = _objectSpread({}, item);\n      });\n      console.log(this.mallUserNatureDtos);\n    },\n    // 地址信息\n    custAddrList: function custAddrList(val) {\n      this.customerAddrList = val;\n      console.log(this.customerAddrList);\n    },\n    // FormData\n    getFormData: function () {\n      var _getFormData = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this5 = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // 基本信息\n                this.$refs.custForm.custForm.validateFields(function (err, values) {\n                  if (!err) {\n                    console.log(values); // console.log(values.custLevel)\n\n                    var custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5'];\n                    _this5.customer = _objectSpread({}, values, {\n                      custProvince: values.custAddress ? values.custAddress[0] : '',\n                      custCity: values.custAddress ? values.custAddress[1] : '',\n                      custArea: values.custAddress ? values.custAddress[2] : '',\n                      custLevel: custLevelArr.includes(values.custLevel) ? custLevelArr.indexOf(values.custLevel) + 1 : values.custLevel\n                    });\n                    delete _this5.customer.custAddress;\n                  }\n                }); // 发票信息\n\n                this.$refs.invoiceForm.invoiceForm.validateFields(function (err, values) {\n                  if (!err) {\n                    console.log(values);\n                    _this5.custInvoiceInfo = values;\n                  }\n                });\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getFormData() {\n        return _getFormData.apply(this, arguments);\n      }\n\n      return getFormData;\n    }(),\n    // Form详情\n    setFormData: function setFormData() {\n      var _this$$refs$invoiceFo;\n\n      // 客户信息\n      console.log(this.getCustLevel);\n      this.$refs.custForm.custForm.setFieldsValue({\n        custName: this.custFormInfo.custName,\n        custIndustry: this.custFormInfo.custIndustry,\n        custShortName: this.custFormInfo.custShortName,\n        custManagerId: {\n          key: this.custFormInfo.custManagerId || '',\n          label: this.custFormInfo.custManager\n        },\n        custLevel: this.getCustLevel,\n        custAddress: [this.custFormInfo.custProvince, this.custFormInfo.custCity, this.custFormInfo.custArea],\n        custDetailAddr: this.custFormInfo.custDetailAddr,\n        custFax: this.custFormInfo.custFax,\n        custWebsite: this.custFormInfo.custWebsite,\n        custFrom: this.custFormInfo.custFrom === 0 ? '线上注册' : '线下注册'\n      }); // 发票信息\n\n      this.$refs.invoiceForm.invoiceForm.setFieldsValue((_this$$refs$invoiceFo = {\n        iiCompanyName: this.invoiceInfo.iiCompanyName,\n        iiTaxpayerId: this.invoiceInfo.iiTaxpayerId,\n        iiBank: this.invoiceInfo.iiBank,\n        iiAccountName: this.invoiceInfo.iiAccountName,\n        iiTaxContent: this.invoiceInfo.iiTaxContent\n      }, _defineProperty(_this$$refs$invoiceFo, \"iiTaxContent\", this.invoiceInfo.iiTaxContent), _defineProperty(_this$$refs$invoiceFo, \"iiContact\", this.invoiceInfo.iiContact), _defineProperty(_this$$refs$invoiceFo, \"iiAddress\", this.invoiceInfo.iiAddress), _this$$refs$invoiceFo));\n    }\n  },\n  watch: {\n    customerInfo: {\n      handler: function handler(val) {\n        console.log(_Object$keys(val).length);\n\n        if (_Object$keys(val).length) {\n          this.custFormInfo = val.customer;\n          this.invoiceInfo = val.custInvoiceInfo;\n          this.mallUsersInfo = val.mallUsers;\n          this.addressInfo = val.customerAddrList;\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getCustLevel: function getCustLevel() {\n      var custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5']; // console.log(this.custFormInfo.custLevel)\n\n      return custLevelArr[this.custFormInfo.custLevel - 1];\n    },\n    getDetailPermission: function getDetailPermission() {\n      return this.$store.state.detailPermission;\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'cust-form': CustForm,\n    'concat-form': ConcatForm,\n    'invoice-form': InvoiceForm,\n    'address-form': AddressForm\n  }\n};",{"version":3,"sources":["CustomerInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"customer-info\">\n    <prompt-title @isDisabled=\"isDisabled\" @isDelete=\"isDelete\"></prompt-title>\n    <a-row>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">基本信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <cust-form ref=\"custForm\" :custFormInfo=\"custFormInfo\" :childDisabled=\"disabled\" />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">联系人信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <concat-form\n          @userNatureDtos=\"userNatureDtos\"\n          :childDisabled=\"disabled\"\n          :mallUsersInfo=\"mallUsersInfo\"\n        />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">发票信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <invoice-form ref=\"invoiceForm\" :childDisabled=\"disabled\" :invoiceInfo=\"invoiceInfo\" />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">收货地址</h3>\n      </a-col>\n      <a-col :span=\"24\" style=\"margin-bottom: 30px;\">\n        <address-form\n          @custAddrList=\"custAddrList\"\n          :addressInfo=\"addressInfo\"\n          :childDisabled=\"disabled\"\n        />\n      </a-col>\n    </a-row>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #E9E9E9',\n          padding: '10px 16px',\n          background: '#FFF',\n          zIndex: 10,\n          textAlign: 'right',\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" type=\"primary\" :loading=\"loading\" v-if=\"isEdit\">提交</a-button>\n      <a-button\n        @click=\"onSave\"\n        type=\"primary\"\n        :disabled=\"!disabled\"\n        :loading=\"loading\"\n        v-else=\"isEdit\"\n        v-show=\"getDetailPermission.includes('UPDATE')\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport CustForm from './CustForm'\nimport ConcatForm from './ContactForm'\nimport InvoiceForm from './InvoiceForm'\nimport AddressForm from './AddressForm'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport {\n  subAddCust,\n  uploadCustomerAndMallUser,\n  removeCustomer\n} from '../basic_lib/index'\nimport { findParentId } from 'utils/utils.js'\n\nexport default {\n  name: 'CustomerInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      customer: {}, // 客户信息\n      mallUserNatureDtos: [], // 联系人信息\n      custInvoiceInfo: {}, // 发票信息\n      customerAddrList: [], // 地址信息\n      custFormInfo: {},\n      invoiceInfo: {},\n      mallUsersInfo: [],\n      addressInfo: [],\n      custManager: undefined\n    }\n  },\n  props: {\n    customerInfo: {\n      type: Object,\n      default: {},\n      required: false\n    }\n  },\n  created() {},\n  methods: {\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData().then(() => {\n        console.log(\n          this.mallUserNatureDtos.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          })\n        )\n        const params = {\n          customer: {\n            ...this.customer,\n            custManager: this.customer.custManagerId.label,\n            custManagerId: this.customer.custManagerId.key\n          },\n          mallUsers: this.mallUserNatureDtos.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          }),\n          custInvoiceInfo: {\n            ...this.custInvoiceInfo\n          },\n          customerAddrList: this.customerAddrList.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          })\n        }\n        delete params.custInvoiceInfo.deleted\n        console.log(params)\n        subAddCust.call(this, params)\n      })\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData().then(() => {\n        const params = {\n          customer: {\n            ...this.customer,\n            id: this.custFormInfo.id,\n            custFrom: this.customer.custFrom === '线上注册' ? 0 : 1,\n            custManager: this.customer.custManagerId.label,\n            custManagerId: this.customer.custManagerId.key\n          },\n          mallUsers: [...this.mallUserNatureDtos],\n          custInvoiceInfo: {\n            ...this.custInvoiceInfo,\n            id: this.invoiceInfo.id,\n            custId: this.invoiceInfo.custId,\n            deleted: false\n          },\n          customerAddrList: [...this.customerAddrList]\n        }\n        console.log(params)\n        uploadCustomerAndMallUser.call(this, params)\n      })\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      console.log(this.customerInfo.customer.id)\n    },\n    // 联系人数组\n    userNatureDtos(val) {\n      val.forEach((item, index) => {\n        this.mallUserNatureDtos[index] = {\n          ...item\n        }\n      })\n      console.log(this.mallUserNatureDtos)\n    },\n    // 地址信息\n    custAddrList(val) {\n      this.customerAddrList = val\n      console.log(this.customerAddrList)\n    },\n    // FormData\n    async getFormData() {\n      // 基本信息\n      this.$refs.custForm.custForm.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          // console.log(values.custLevel)\n          const custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5']\n\n          this.customer = {\n            ...values,\n            custProvince: values.custAddress ? values.custAddress[0] : '',\n            custCity: values.custAddress ? values.custAddress[1] : '',\n            custArea: values.custAddress ? values.custAddress[2] : '',\n            custLevel: custLevelArr.includes(values.custLevel)\n              ? custLevelArr.indexOf(values.custLevel) + 1\n              : values.custLevel\n          }\n          delete this.customer.custAddress\n        }\n      })\n      // 发票信息\n      this.$refs.invoiceForm.invoiceForm.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          this.custInvoiceInfo = values\n        }\n      })\n    },\n    // Form详情\n    setFormData() {\n      // 客户信息\n      console.log(this.getCustLevel)\n      this.$refs.custForm.custForm.setFieldsValue({\n        custName: this.custFormInfo.custName,\n        custIndustry: this.custFormInfo.custIndustry,\n        custShortName: this.custFormInfo.custShortName,\n        custManagerId: {\n          key: this.custFormInfo.custManagerId || '',\n          label: this.custFormInfo.custManager\n        },\n        custLevel: this.getCustLevel,\n        custAddress: [\n          this.custFormInfo.custProvince,\n          this.custFormInfo.custCity,\n          this.custFormInfo.custArea\n        ],\n        custDetailAddr: this.custFormInfo.custDetailAddr,\n        custFax: this.custFormInfo.custFax,\n        custWebsite: this.custFormInfo.custWebsite,\n        custFrom: this.custFormInfo.custFrom === 0 ? '线上注册' : '线下注册'\n      })\n      // 发票信息\n      this.$refs.invoiceForm.invoiceForm.setFieldsValue({\n        iiCompanyName: this.invoiceInfo.iiCompanyName,\n        iiTaxpayerId: this.invoiceInfo.iiTaxpayerId,\n        iiBank: this.invoiceInfo.iiBank,\n        iiAccountName: this.invoiceInfo.iiAccountName,\n        iiTaxContent: this.invoiceInfo.iiTaxContent,\n        iiTaxContent: this.invoiceInfo.iiTaxContent,\n        iiContact: this.invoiceInfo.iiContact,\n        iiAddress: this.invoiceInfo.iiAddress\n      })\n    }\n  },\n  watch: {\n    customerInfo: {\n      handler(val) {\n        console.log(Object.keys(val).length)\n        if (Object.keys(val).length) {\n          this.custFormInfo = val.customer\n          this.invoiceInfo = val.custInvoiceInfo\n          this.mallUsersInfo = val.mallUsers\n          this.addressInfo = val.customerAddrList\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getCustLevel() {\n      const custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5']\n      // console.log(this.custFormInfo.custLevel)\n      return custLevelArr[this.custFormInfo.custLevel - 1]\n    },\n    getDetailPermission() {\n      return this.$store.state.detailPermission\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'cust-form': CustForm,\n    'concat-form': ConcatForm,\n    'invoice-form': InvoiceForm,\n    'address-form': AddressForm\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.customer-info {\n  .customer-title {\n    margin: 10px 0;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n  .label-box {\n    margin-bottom: 0;\n    .create-label {\n      background: #1890ff;\n      color: #fff;\n      border-radius: 4px;\n      display: inline-block;\n      height: 24px;\n      line-height: 12px;\n      padding: 6px;\n      margin: 0 4px;\n      i {\n        font-size: 10px;\n        margin-left: 4px;\n      }\n    }\n  }\n}\n</style>"],"sourceRoot":"src/views/cust/child_info"}]}