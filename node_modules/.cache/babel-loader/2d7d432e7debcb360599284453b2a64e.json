{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/thread-loader/dist/cjs.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/sale/orderList/child_lib/orderInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/sale/orderList/child_lib/orderInfo.vue","mtime":1560776825618},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\nimport _parseFloat from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/@babel/runtime-corejs2/core-js/parse-float\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport EditableCell from '../basic_lib/EditableCell';\nimport addAddress from '../basic_lib/addAddress';\nimport { areas } from 'utils/area.js';\nimport { postJson, get, put, deleted } from '@/api/axios.js';\nimport api from '@/api/index.js';\nimport GoodsInfo from '@/views/product/pdm/goods/child_info/GoodsInfo';\nimport { columnsOrderInfo, orderStatus } from '../basic_lib/menu.js';\nimport { mixinUpload, mixinCurrentPage, getListCompanyCusts } from '@/views/sale/mixin/minxinSale';\nimport moment from 'moment';\nimport Bus from '@/Bus';\nexport default {\n  props: {\n    editInfo: {\n      type: Boolean\n    },\n    detialList: {\n      type: String\n    },\n    approval: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mixins: [mixinUpload, mixinCurrentPage, getListCompanyCusts],\n  components: {\n    GoodsInfo: GoodsInfo,\n    EditableCell: EditableCell,\n    addAddress: addAddress\n  },\n  data: function data() {\n    return {\n      dateFormat: 'YYYY/MM/DD',\n      labelCol: {\n        span: 6\n      },\n      wrapperCol: {\n        span: 18\n      },\n      columns: columnsOrderInfo,\n      orderStatus: orderStatus,\n      mallOrderIntactDto: {\n        oorderNumber: '自动生成',\n        ocustName: '',\n        otype: '0',\n        addrId: '',\n        // 地址ID\n        opurchaseOrderno: '',\n        // 客户单号\n        custId: '',\n        // 商城客户id\n        ocustShortName: '',\n        // 客户简称\n        ototalSum: '',\n        // 总金额，订单总计（销售总计）\n        oattachment: '',\n        // 上传附件 1\n        oprePayment: '',\n        // 预收款\n        oremarks: '',\n        // 备注\n        ostatus: ''\n      },\n      areas: areas,\n      dataSource: [],\n      isAddContactInfo: false,\n      visible: false,\n      // 添加地址\n      addressList: [],\n      // 订单详情\n      towVisible: false,\n      editDetial: false,\n      submitLoading: false\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    if (this.editInfo) {\n      this.getOrderDetail(this.detialList);\n    }\n\n    Bus.$on('isDisabled', function (val) {\n      _this.editDetial = !val;\n\n      if (val) {\n        var newData = _toConsumableArray(_this.dataSource);\n\n        newData.forEach(function (item) {\n          delete item.editable;\n        });\n      }\n    });\n    Bus.$on('isDelete', function (val) {\n      if (!val) {\n        var idStr = _this.mallOrderIntactDto.id;\n        deleted(api.deletedBatch + \"?idStr=\".concat(idStr)).then(function (res) {\n          if (res.data.code === 0) {\n            _this.$message.success('删除成功');\n\n            _this.$emit('isVisible', true);\n          }\n        });\n      }\n    });\n    Bus.$on('submitOrder', function (val) {\n      _this.orderSubmit(val);\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    Bus.$off('isDisabled');\n    Bus.$off('isDelete');\n    Bus.$off('submitOrder');\n  },\n  methods: {\n    moment: moment,\n    // 总价计算\n    setOtotalSum: function setOtotalSum(data) {\n      var ototalSum = 0;\n\n      for (var i in data) {\n        ototalSum += _parseFloat(data[i].odAmount);\n      }\n\n      this.mallOrderIntactDto.ototalSum = ototalSum;\n    },\n    // 选择框的下拉加载\n    currentPageChange: function currentPageChange(e) {\n      var result = this.getCurrentPageChange(e);\n\n      if (result) {\n        this.getListCompanyCusts(this.customerPage);\n      }\n    },\n    // 添加产品\n    onAddContact: function onAddContact() {\n      if (this.mallOrderIntactDto.ocustName !== '') {\n        this.isAddContactInfo = true;\n      } else {\n        this.$message.warning('请先选择客户名称');\n      }\n    },\n    // 关闭商品添加弹框\n    handleOkContact: function handleOkContact(e) {\n      var _this2 = this;\n\n      setTimeout(function () {\n        _this2.isAddContactInfo = false;\n      }, 2000);\n    },\n    handleCancelContact: function handleCancelContact(e) {\n      this.isAddContactInfo = false;\n    },\n    // 添加产品 && 计算总价\n    showAddContactInfo: function showAddContactInfo(data) {\n      this.isAddContactInfo = data.isAddContactInfo;\n      var dataSource = this.dataSource;\n\n      if (data.sku) {\n        data.sku.key = dataSource.length;\n        dataSource.push(data.sku);\n        this.setOtotalSum(dataSource);\n        this.dataSource = dataSource;\n      }\n    },\n    // input变化 赋值\n    inputChange: function inputChange(val, type) {\n      if (type === 'ocustName') {\n        this.mallOrderIntactDto.ocustShortName = this.listCompanyCusts[val].custShortName;\n        this.mallOrderIntactDto.ocustName = this.listCompanyCusts[val].custName;\n        var custId = this.listCompanyCusts[val].id;\n        this.mallOrderIntactDto.custId = custId;\n        this.getAddressList(custId);\n      }\n    },\n    // 订单提交\n    orderSubmit: function orderSubmit(val) {\n      var _this3 = this;\n\n      if (this.dataSource.length === 0) {\n        this.$message.warning('请添加购买商品');\n        return;\n      }\n\n      this.submitLoading = true;\n      this.mallOrderIntactDto.oattachment = this.uploadFile.join(',');\n\n      if (!val) {\n        // 订单添加\n        this.mallOrderIntactDto.skuList = this.dataSource;\n        delete this.mallOrderIntactDto.ostatus;\n        delete this.mallOrderIntactDto.oorderNumber;\n        postJson(api.orderSave, this.mallOrderIntactDto).then(function (res) {\n          if (res.data.code === 0) {\n            _this3.$message.success('订单添加成功');\n\n            _this3.$emit('isVisible', true);\n          } else {\n            _this3.$message.error(res.data.msg);\n          }\n        });\n      } else {\n        // 订单修改\n        this.dataSource.forEach(function (item) {\n          delete item.sku;\n        });\n        this.mallOrderIntactDto.orderDetails = this.dataSource;\n        this.mallOrderIntactDto.oattachment = this.uploadFile.join(',');\n        delete this.mallOrderIntactDto.skuList;\n        put(api.updateOrder, this.mallOrderIntactDto).then(function (res) {\n          if (res.data.code === 0) {\n            _this3.$message.success('订单修改成功');\n\n            _this3.$emit('isVisible', true);\n          } else {\n            _this3.$message.error(res.data.msg);\n          }\n\n          _this3.submitLoading = false;\n        });\n      }\n    },\n    // 地址添加\n    addAddress: function addAddress() {\n      if (this.mallOrderIntactDto.ocustName !== '') {\n        this.visible = true;\n      } else {\n        this.$message.warning('请先选择客户名称');\n      }\n    },\n    // 关闭地址新增\n    addressCancel: function addressCancel(data) {\n      if (data) {\n        this.getAddressList(this.mallOrderIntactDto.custId);\n      }\n\n      this.visible = false;\n    },\n    // 通过客户Id查询地址列表\n    getAddressList: function getAddressList(id) {\n      var _this4 = this;\n\n      get(api.getAddressList + \"/\".concat(id)).then(function (res) {\n        var data = res.data.data;\n        data.forEach(function (item) {\n          if (item.defaultGoodsAddr === 1) {\n            _this4.mallOrderIntactDto.addrId = item.id;\n          }\n        });\n        _this4.addressList = data;\n      });\n    },\n    // 选择地址\n    choseAddress: function choseAddress(index, id) {\n      if (this.editInfo && !this.editDetial) {\n        return;\n      }\n\n      var addressList = this.addressList;\n      addressList.forEach(function (item) {\n        item.defaultGoodsAddr = 0;\n      });\n      addressList[index].defaultGoodsAddr = 1;\n      this.mallOrderIntactDto.addrId = id;\n    },\n    // 产品编辑\n    edit: function edit(key) {\n      var newData = _toConsumableArray(this.dataSource);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.editable = true;\n        this.dataSource = newData;\n      }\n    },\n    // 产品列表数据修改\n    editCell: function editCell(value, key, column) {\n      var newData = _toConsumableArray(this.dataSource);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target[column] = value;\n\n        if (column === 'odNumber' || column === 'odSkuCustPrice') {\n          target['odAmount'] = Number(target['odNumber']) * Number(target['odSkuCustPrice']);\n        }\n\n        this.dataSource = newData;\n        this.setOtotalSum(newData);\n      }\n    },\n    // 保存修改\n    save: function save(key) {\n      var newData = _toConsumableArray(this.dataSource);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        delete target.editable;\n        this.dataSource = newData;\n        this.setOtotalSum(newData);\n      }\n    },\n    // 删除当前行\n    cancel: function cancel(key) {\n      var newData = _toConsumableArray(this.dataSource);\n\n      var target = newData.filter(function (item) {\n        return key !== item.key;\n      });\n      this.dataSource = target;\n      this.setOtotalSum(this.dataSource);\n    },\n    // 获取订单详情\n    getOrderDetail: function getOrderDetail(id) {\n      var _this5 = this;\n\n      get(api.getOrderDetail + \"\".concat(id)).then(function (res) {\n        _this5.mallOrderIntactDto = res.data.data;\n        var skuList = res.data.data.skuList;\n        var oattachment = res.data.data.oattachment;\n\n        for (var i in skuList) {\n          skuList[i].key = i;\n        }\n\n        _this5.dataSource = skuList;\n\n        if (oattachment) {\n          var oattachmentObj = [];\n          var oattachmentList = oattachment.split(',');\n\n          for (var _i in oattachmentList) {\n            oattachmentObj.push({\n              uid: _i,\n              name: \"\".concat(_i),\n              status: 'done',\n              url: oattachmentList[_i]\n            });\n          }\n\n          _this5.fileList = oattachmentObj;\n        }\n\n        _this5.getAddressList(res.data.data.custId);\n      });\n    },\n    // 获取产品详情\n    getGoodsViews: function getGoodsViews(skuId, catId) {\n      this.towVisible = true;\n      this.$store.commit('setPromptTitle', {\n        title: '产品信息详情',\n        isEdit: true\n      });\n    },\n    isDrawer: function isDrawer() {\n      this.towVisible = false;\n    }\n  }\n};",{"version":3,"sources":["orderInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div class=\"add-order-list\">\n      <a-row>\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">订单详情</h3>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"订单编码\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input class=\"inputWidth\" :value=\"mallOrderIntactDto.oorderNumber\" disabled/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"客户名称\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-select\n              :disabled=\"editInfo\"\n              class=\"inputWidth\"\n              showSearch\n              v-model=\"mallOrderIntactDto.ocustName\"\n              @change=\"(val)=>{inputChange(val,'ocustName')}\"\n              @popupScroll=\"e=>currentPageChange(e)\"\n              :getPopupContainer=\"triggerNode => triggerNode.parentNode\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" style=\"display:none\" v-if=\"editInfo\"/>\n              <a-select-option\n                v-for=\"(item,index) in listCompanyCusts\"\n                :key=\"index\"\n              >{{item.custName}}</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"客户单号\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input\n              class=\"inputWidth\"\n              v-model=\"mallOrderIntactDto.opurchaseOrderno\"\n              :disabled=\"editInfo && !editDetial\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"订单类型\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-select\n              :disabled=\"editInfo\"\n              v-model=\"mallOrderIntactDto.otype\"\n              class=\"inputWidth\"\n              placeholder=\"请选择订单类型\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" style=\"display:none\" v-if=\"editInfo\"/>\n              <a-select-option value=\"0\">正式</a-select-option>\n              <a-select-option value=\"1\">样品</a-select-option>\n              <a-select-option value=\"2\">季度返点</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"总价\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input\n              class=\"inputWidth\"\n              v-model=\"mallOrderIntactDto.ototalSum\"\n              :disabled=\"editInfo && !editDetial\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"预收款\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input\n              class=\"inputWidth\"\n              v-model=\"mallOrderIntactDto.oprePayment\"\n              :disabled=\"editInfo && !editDetial\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\" v-if=\"editInfo\">\n          <a-form-item label=\"状态\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-select disabled :value=\"mallOrderIntactDto.ostatus\">\n              <a-icon slot=\"suffixIcon\" type=\"down\" style=\"display:none\"/>\n              <template v-for=\"(item,index) in orderStatus\">\n                <a-select-option :value=\"item.value\" :key=\"index\">{{item.label}}</a-select-option>\n              </template>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"备注\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input\n              class=\"inputWidth\"\n              v-model=\"mallOrderIntactDto.oremarks\"\n              :disabled=\"editInfo && !editDetial\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n      <!-- <a-row class=\"mt\">\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">订单分配</h3>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"计划员：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input class=\"inputWidth\" placeholder=\"请输入订单编号\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"工厂厂长：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-input class=\"inputWidth\" placeholder=\"请输入净价总价\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item label=\"生产基地：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n            <a-cascader\n              :options=\"areas\"\n              placeholder=\"请选择生产基地\"\n              class=\"inputWidth\"\n              :fieldNames=\"{label:'name',value:'id',children:'childrens'}\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>-->\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">产品详情</h3>\n        </a-col>\n        <a-table :columns=\"columns\" :dataSource=\"dataSource\" :pagination=\"false\">\n          <template slot=\"name\" slot-scope=\"text,record\">\n            <a\n              href=\"javascript:;\"\n              @click=\"getGoodsViews(record.skuId,record.odCustId)\"\n            >{{record.odSkuName}}-{{record.code || record.odSkuCode}}</a>\n          </template>\n          <template\n            v-for=\"col in ['odSkuCustPrice', 'odNumber', 'odAmount','odPurchaseOrderno','odRequireDueDate','odPromiseDueDate']\"\n            :slot=\"col\"\n            slot-scope=\"text, record\"\n          >\n            <div :key=\"col\">\n              <a-input\n                v-if=\"record.editable && col!=='odRequireDueDate' && col !== 'odPromiseDueDate'\"\n                style=\"width:60px;\"\n                :value=\"text\"\n                @change=\"e => editCell(e.target.value, record.key, col)\"\n              />\n              <a-date-picker\n                v-else-if=\"record.editable && (col ==='odRequireDueDate' || col === 'odPromiseDueDate')\"\n                style=\"width:100px;\"\n                :defaultValue=\"moment(text||new Date())\"\n                @change=\"(value,dateString) => editCell(dateString, record.key, col)\"\n              />\n              <template v-else>\n                <span\n                  v-if=\"col ==='odRequireDueDate' || col === 'odPromiseDueDate'\"\n                >{{text?moment(text).format('YYYY-MM-DD'):''}}</span>\n                <span v-else>{{text}}</span>\n              </template>\n            </div>\n          </template>\n          <template slot=\"operation\" slot-scope=\"text, record\">\n            <div class=\"editable-row-operations\" v-show=\"!editInfo || editDetial\">\n              <span v-if=\"record.editable\">\n                <a @click=\"() => save(record.key)\">\n                  <a-button type=\"primary\" shape=\"circle\" icon=\"edit\" class=\"edit-btn\"></a-button>\n                </a>\n                <a-popconfirm title=\"确认删除吗?\" @confirm=\"() => cancel(record.key)\">\n                  <a-button type=\"danger\" shape=\"circle\" icon=\"delete\" class=\"edit-btn\"></a-button>\n                </a-popconfirm>\n              </span>\n              <span v-else>\n                <a @click=\"() => edit(record.key)\">编辑</a>\n              </span>\n            </div>\n          </template>\n        </a-table>\n        <span class=\"editable-add-btn\" @click=\"onAddContact\" v-show=\"!editInfo || editDetial\">+添加产品</span>\n        <a-modal\n          title=\"添加\"\n          :maskClosable=\"false\"\n          :closable=\"false\"\n          :footer=\"null\"\n          :visible=\"isAddContactInfo\"\n          @ok=\"handleOkContact\"\n          @cancel=\"handleCancelContact\"\n        >\n          <EditableCell\n            @showAddContactInfo=\"showAddContactInfo\"\n            :custId=\"mallOrderIntactDto.custId\"\n          ></EditableCell>\n        </a-modal>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">收货地址</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <div\n            class=\"address-list\"\n            v-for=\"(item,index) in addressList\"\n            :key=\"item.id\"\n            @click=\"choseAddress(index,item.id)\"\n          >\n            <div\n              class=\"address-list-item\"\n              :class=\"{'item-active':item.id ==mallOrderIntactDto.addrId}\"\n              v-if=\"editInfo && item.id ==mallOrderIntactDto.addrId && !editDetial\"\n            >\n              <div class=\"address-list-item-desc\">\n                {{mallOrderIntactDto.ocustName}}\n                <ul>\n                  <li>收件人：{{item.receiver}}</li>\n                  <li>联系方式：{{item.phone}}</li>\n                  <li>地址：{{item.cityStr}}{{item.provinceStr}}{{item.areaStr}}{{item.detailAddr}}</li>\n                </ul>\n              </div>\n            </div>\n            <div\n              class=\"address-list-item\"\n              :class=\"{'item-active':item.id ==mallOrderIntactDto.addrId}\"\n              v-else-if=\"!editInfo || editDetial\"\n            >\n              <div class=\"address-list-item-desc\">\n                {{mallOrderIntactDto.ocustName}}\n                <ul>\n                  <li>收件人：{{item.receiver}}</li>\n                  <li>联系方式：{{item.phone}}</li>\n                  <li>地址：{{item.cityStr}}{{item.provinceStr}}{{item.areaStr}}{{item.detailAddr}}</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n          <span\n            class=\"editable-add-btn\"\n            style=\"margin:10px;\"\n            @click=\"addAddress\"\n            v-show=\"!editInfo || editDetial\"\n          >+添加地址</span>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">附件</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <a-upload\n            :action=\"url\"\n            :data=\"{'bizType': 'ORDER'}\"\n            :headers=\"headers\"\n            listType=\"picture-card\"\n            :fileList=\"fileList\"\n            @preview=\"handlePreview\"\n            @change=\"handleChange\"\n            :disabled=\"editInfo && !editDetial\"\n          >\n            <div>\n              <a-icon type=\"plus\"/>\n              <div class=\"ant-upload-text\">Upload</div>\n            </div>\n            <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"handleCancel\">\n              <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\">\n            </a-modal>\n          </a-upload>\n        </a-col>\n      </a-row>\n      <!-- <a-row v-if=\"editInfo && !approval\">\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">审批流程</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <a-steps progressDot :current=\"1\">\n            <a-step title=\"Finished\" description=\"This is a description.\"/>\n            <a-step title=\"In Progress\" description=\"This is a description.\"/>\n            <a-step title=\"Waiting\" description=\"This is a description.\"/>\n          </a-steps>\n        </a-col>\n      </a-row>-->\n    </div>\n    <a-modal v-model=\"visible\" title=\"添加地址\" :footer=\"null\">\n      <addAddress :custId=\"mallOrderIntactDto.custId\" @addressCancel=\"addressCancel\"></addAddress>\n    </a-modal>\n    <!-- 查看商品详情 -->\n    <a-drawer\n      placement=\"right\"\n      :closable=\"false\"\n      @close=\"isDrawer\"\n      :visible=\"towVisible\"\n      :wrapStyle=\"{overflow: 'auto',paddingBottom: '108px'}\"\n      :width=\"1080\"\n    >\n      <GoodsInfo @isDrawer=\"isDrawer\"></GoodsInfo>\n    </a-drawer>\n  </div>\n</template>\n\n<script>\nimport EditableCell from '../basic_lib/EditableCell'\nimport addAddress from '../basic_lib/addAddress'\nimport { areas } from 'utils/area.js'\nimport { postJson, get, put, deleted } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport GoodsInfo from '@/views/product/pdm/goods/child_info/GoodsInfo'\nimport { columnsOrderInfo, orderStatus } from '../basic_lib/menu.js'\nimport { mixinUpload, mixinCurrentPage, getListCompanyCusts } from '@/views/sale/mixin/minxinSale'\nimport moment from 'moment'\nimport Bus from '@/Bus'\nexport default {\n  props: {\n    editInfo: {\n      type: Boolean\n    },\n    detialList: {\n      type: String\n    },\n    approval: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mixins: [mixinUpload, mixinCurrentPage, getListCompanyCusts],\n  components: {\n    GoodsInfo,\n    EditableCell,\n    addAddress\n  },\n  data() {\n    return {\n      dateFormat: 'YYYY/MM/DD',\n      labelCol: { span: 6 },\n      wrapperCol: { span: 18 },\n      columns: columnsOrderInfo,\n      orderStatus: orderStatus,\n      mallOrderIntactDto: {\n        oorderNumber: '自动生成',\n        ocustName: '',\n        otype: '0',\n        addrId: '', // 地址ID\n        opurchaseOrderno: '', // 客户单号\n        custId: '', // 商城客户id\n        ocustShortName: '', // 客户简称\n        ototalSum: '', // 总金额，订单总计（销售总计）\n        oattachment: '', // 上传附件 1\n        oprePayment: '', // 预收款\n        oremarks: '', // 备注\n        ostatus: ''\n      },\n      areas,\n      dataSource: [],\n      isAddContactInfo: false,\n      visible: false, // 添加地址\n      addressList: [],\n      // 订单详情\n      towVisible: false,\n      editDetial: false,\n      submitLoading: false\n    }\n  },\n  created() {\n    if (this.editInfo) {\n      this.getOrderDetail(this.detialList)\n    }\n    Bus.$on('isDisabled', val => {\n      this.editDetial = !val\n      if (val) {\n        const newData = [...this.dataSource]\n        newData.forEach(item => {\n          delete item.editable\n        })\n      }\n    })\n    Bus.$on('isDelete', val => {\n      if (!val) {\n        const idStr = this.mallOrderIntactDto.id\n        deleted(api.deletedBatch + `?idStr=${idStr}`).then(res => {\n          if (res.data.code === 0) {\n            this.$message.success('删除成功')\n            this.$emit('isVisible', true)\n          }\n        })\n      }\n    })\n    Bus.$on('submitOrder', val => {\n      this.orderSubmit(val)\n    })\n  },\n  beforeDestroy() {\n    Bus.$off('isDisabled')\n    Bus.$off('isDelete')\n    Bus.$off('submitOrder')\n  },\n  methods: {\n    moment,\n    // 总价计算\n    setOtotalSum(data) {\n      let ototalSum = 0\n      for (const i in data) {\n        ototalSum += parseFloat(data[i].odAmount)\n      }\n      this.mallOrderIntactDto.ototalSum = ototalSum\n    },\n    // 选择框的下拉加载\n    currentPageChange(e) {\n      const result = this.getCurrentPageChange(e)\n      if (result) {\n        this.getListCompanyCusts(this.customerPage)\n      }\n    },\n    // 添加产品\n    onAddContact() {\n      if (this.mallOrderIntactDto.ocustName !== '') {\n        this.isAddContactInfo = true\n      } else {\n        this.$message.warning('请先选择客户名称')\n      }\n    },\n    // 关闭商品添加弹框\n    handleOkContact(e) {\n      setTimeout(() => {\n        this.isAddContactInfo = false\n      }, 2000)\n    },\n    handleCancelContact(e) {\n      this.isAddContactInfo = false\n    },\n    // 添加产品 && 计算总价\n    showAddContactInfo(data) {\n      this.isAddContactInfo = data.isAddContactInfo\n      const dataSource = this.dataSource\n      if (data.sku) {\n        data.sku.key = dataSource.length\n        dataSource.push(data.sku)\n        this.setOtotalSum(dataSource)\n        this.dataSource = dataSource\n      }\n    },\n    // input变化 赋值\n    inputChange(val, type) {\n      if (type === 'ocustName') {\n        this.mallOrderIntactDto.ocustShortName = this.listCompanyCusts[val].custShortName\n        this.mallOrderIntactDto.ocustName = this.listCompanyCusts[val].custName\n        const custId = this.listCompanyCusts[val].id\n        this.mallOrderIntactDto.custId = custId\n        this.getAddressList(custId)\n      }\n    },\n    // 订单提交\n    orderSubmit(val) {\n      if (this.dataSource.length === 0) {\n        this.$message.warning('请添加购买商品')\n        return\n      }\n      this.submitLoading = true\n      this.mallOrderIntactDto.oattachment = this.uploadFile.join(',')\n      if (!val) {\n        // 订单添加\n        this.mallOrderIntactDto.skuList = this.dataSource\n        delete this.mallOrderIntactDto.ostatus\n        delete this.mallOrderIntactDto.oorderNumber\n        postJson(api.orderSave, this.mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            this.$message.success('订单添加成功')\n            this.$emit('isVisible', true)\n          } else {\n            this.$message.error(res.data.msg)\n          }\n        })\n      } else {\n        // 订单修改\n        this.dataSource.forEach(item => {\n          delete item.sku\n        })\n        this.mallOrderIntactDto.orderDetails = this.dataSource\n        this.mallOrderIntactDto.oattachment = this.uploadFile.join(',')\n        delete this.mallOrderIntactDto.skuList\n        put(api.updateOrder, this.mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            this.$message.success('订单修改成功')\n            this.$emit('isVisible', true)\n          } else {\n            this.$message.error(res.data.msg)\n          }\n          this.submitLoading = false\n        })\n      }\n    },\n    // 地址添加\n    addAddress() {\n      if (this.mallOrderIntactDto.ocustName !== '') {\n        this.visible = true\n      } else {\n        this.$message.warning('请先选择客户名称')\n      }\n    },\n    // 关闭地址新增\n    addressCancel(data) {\n      if (data) {\n        this.getAddressList(this.mallOrderIntactDto.custId)\n      }\n      this.visible = false\n    },\n    // 通过客户Id查询地址列表\n    getAddressList(id) {\n      get(api.getAddressList + `/${id}`).then(res => {\n        var data = res.data.data\n        data.forEach(item => {\n          if (item.defaultGoodsAddr === 1) {\n            this.mallOrderIntactDto.addrId = item.id\n          }\n        })\n        this.addressList = data\n      })\n    },\n    // 选择地址\n    choseAddress(index, id) {\n      if (this.editInfo && !this.editDetial) {\n        return\n      }\n      const addressList = this.addressList\n      addressList.forEach(item => {\n        item.defaultGoodsAddr = 0\n      })\n      addressList[index].defaultGoodsAddr = 1\n      this.mallOrderIntactDto.addrId = id\n    },\n    // 产品编辑\n    edit(key) {\n      const newData = [...this.dataSource]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.dataSource = newData\n      }\n    },\n    // 产品列表数据修改\n    editCell(value, key, column) {\n      const newData = [...this.dataSource]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target[column] = value\n        if (column === 'odNumber' || column === 'odSkuCustPrice') {\n          target['odAmount'] =\n            Number(target['odNumber']) * Number(target['odSkuCustPrice'])\n        }\n\n        this.dataSource = newData\n        this.setOtotalSum(newData)\n      }\n    },\n    // 保存修改\n    save(key) {\n      const newData = [...this.dataSource]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        delete target.editable\n        this.dataSource = newData\n        this.setOtotalSum(newData)\n      }\n    },\n    // 删除当前行\n    cancel(key) {\n      const newData = [...this.dataSource]\n      const target = newData.filter(item => key !== item.key)\n      this.dataSource = target\n      this.setOtotalSum(this.dataSource)\n    },\n    // 获取订单详情\n    getOrderDetail(id) {\n      get(api.getOrderDetail + `${id}`).then(res => {\n        this.mallOrderIntactDto = res.data.data\n        const skuList = res.data.data.skuList\n        const oattachment = res.data.data.oattachment\n        for (const i in skuList) {\n          skuList[i].key = i\n        }\n        this.dataSource = skuList\n        if (oattachment) {\n          const oattachmentObj = []\n          const oattachmentList = oattachment.split(',')\n          for (const i in oattachmentList) {\n            oattachmentObj.push({\n              uid: i,\n              name: `${i}`,\n              status: 'done',\n              url: oattachmentList[i]\n            })\n          }\n          this.fileList = oattachmentObj\n        }\n        this.getAddressList(res.data.data.custId)\n      })\n    },\n    // 获取产品详情\n    getGoodsViews(skuId, catId) {\n      this.towVisible = true\n      this.$store.commit('setPromptTitle', {\n        title: '产品信息详情',\n        isEdit: true\n      })\n    },\n    isDrawer() {\n      this.towVisible = false\n    }\n  }\n}\n</script>\n\n<style lang='less' scoped>\n@import \"~styles/variable.less\";\n.inputWidth {\n  .inputWidth();\n}\n.mt {\n  margin: 10px 0;\n}\n\n.prompt-title {\n  border-bottom: 1px solid #ebedf0;\n  min-height: 40px;\n  margin-bottom: 10px;\n  .prompt-wrapper {\n    display: flex;\n    justify-content: flex-end;\n    .prompt-edit {\n      margin: 0 10px;\n      cursor: pointer;\n    }\n    .prompt-delete {\n      cursor: pointer;\n      margin-right: 10px;\n    }\n    .prompt-close {\n      cursor: pointer;\n      padding: 0 10px;\n      border-left: 1px solid #d8d8d8;\n    }\n  }\n}\n.addCustomer-title {\n  border-left: 4px solid #1890ff;\n  padding-left: 6px;\n}\n.ant-upload-select-picture-card i {\n  font-size: 32px;\n  color: #999;\n}\n.ant-upload-select-picture-card .ant-upload-text {\n  margin-top: 8px;\n  color: #666;\n}\n.editable-add-btn {\n  cursor: pointer;\n  margin: 10px 20px;\n  display: block;\n  line-height: 30px;\n  text-align: center;\n  border: 1px dashed #ccc;\n}\n.add-order-list {\n  position: relative;\n  .edit {\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    & > span {\n      margin-right: 5px;\n      cursor: pointer;\n    }\n  }\n}\n.address-list-item {\n  cursor: pointer;\n  margin-bottom: 10px;\n  &-desc {\n    font-size: 14px;\n    color: #333333;\n    padding: 15px 20px;\n    border-radius: 4px;\n    background: #fafafa;\n    border: 1px solid #d8d8d8;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    ul {\n      display: flex;\n      margin-bottom: 0;\n    }\n    li {\n      &:not(:last-child)::after {\n        content: \"/\";\n        margin: 0 10px;\n      }\n    }\n  }\n}\n.item-active {\n  .address-list-item-desc {\n    position: relative;\n    background-color: #fdfffa;\n    border: 1px solid #69b412;\n    &::after {\n      content: \"\";\n      border-top-right-radius: 3px;\n      border-width: 15px;\n      border-style: solid;\n      border-color: #69b412 #69b412 transparent transparent;\n      position: absolute;\n      right: 0px;\n      top: 0px;\n    }\n    &::before {\n      content: \"\";\n      position: absolute;\n      width: 7px;\n      height: 14px;\n      border-right: 2px solid #fff;\n      border-bottom: 2px solid #fff;\n      transform: rotate(40deg);\n      top: 0px;\n      right: 5px;\n      color: #fff;\n      font-size: 10px;\n      z-index: 999;\n      font-size: 16px;\n    }\n  }\n}\n.edit-btn {\n  width: 22px;\n  height: 22px;\n  font-size: 12px;\n  &:first-child {\n    margin-right: 2px;\n  }\n}\n/deep/.ant-alert-with-description.ant-alert-no-icon {\n  padding: 8px 15px;\n}\n/deep/ .ant-input-disabled {\n  border: none !important;\n}\n</style>\n"],"sourceRoot":"src/views/sale/orderList/child_lib"}]}