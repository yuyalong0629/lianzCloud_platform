{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue","mtime":1565252860549},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { get } from '@/api/axios.js';\nimport api from '@/api/index.js';\nimport { mixinCurrentPage } from '@/views/sale/mixin/minxinSale';\nimport moment from 'moment';\nexport default {\n  mixins: [mixinCurrentPage],\n  props: {\n    custId: {\n      type: String\n    }\n  },\n  data: function data() {\n    return {\n      form: this.$form.createForm(this),\n      customerGoodsPages: 0,\n      currentPage: 1,\n      labelCol: {\n        span: 6,\n        offset: 0\n      },\n      wrapperCol: {\n        span: 16\n      },\n      sku: {\n        skuId: '',\n        code: undefined,\n        odSkuName: '',\n        odSpec: '',\n        taxRate: 0,\n        odSkuCustPrice: '',\n        odAmount: '',\n        odSkuCustCode: '',\n        // 客户产品编码\n        unit: ''\n      },\n      value: '',\n      codeKey: '',\n      timer: '',\n      listCustomerGoods: [] // 商品信息\n\n    };\n  },\n  created: function created() {\n    this.getListCompanyCustomGoods();\n  },\n  methods: {\n    moment: moment,\n    inputChange: function inputChange(val) {\n      var _this = this;\n\n      var listCustomerGoods = this.listCustomerGoods[val];\n      this.value = \"\".concat(listCustomerGoods.code, \"-\").concat(listCustomerGoods.name);\n      this.form.resetFields('sku.odNumber');\n      this.sku.odAmount = '';\n      this.sku.odSkuCustPrice = '';\n      get(api.getSkuPrice + \"/\".concat(listCustomerGoods.id, \"/\").concat(this.custId)).then(function (res) {\n        if (res.data.code === 0) {\n          var data = res.data.data;\n          var skuCustPrice = data.skuCustPrice;\n          _this.sku.odSkuName = data.name;\n          _this.sku.odSpec = data.spec;\n          _this.sku.taxRate = data.taxRate;\n          _this.sku.odSkuCustPrice = skuCustPrice.length ? skuCustPrice[0].price : data.price;\n          _this.sku.code = data.code;\n          _this.sku.odSkuCustCode = data.skuCustInfo ? data.skuCustInfo.custSkuCode : '';\n          _this.sku.skuId = data.id;\n          _this.sku.unit = data.unit;\n        }\n      });\n    },\n    // 订单数量变化\n    inputnumChange: function inputnumChange(val) {\n      var price = this.form.getFieldValue('sku.odSkuCustPrice');\n      var total = 0;\n      total = Number((Number(price) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/));\n      this.sku.odAmount = total;\n    },\n    // 产品价格变化\n    inputPriceChange: function inputPriceChange(val) {\n      var num = this.form.getFieldValue('sku.odNumber');\n      var total = 0;\n      total = Number((Number(num) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/));\n      this.sku.odAmount = total;\n    },\n    handleEditableInfo: function handleEditableInfo(e) {\n      var _this2 = this;\n\n      e.preventDefault();\n\n      if (!this.value) {\n        this.$message.warning('请选择产品');\n        return;\n      }\n\n      this.form.validateFields(function (err, values) {\n        if (!err) {\n          var val = {\n            'odRequireDueDate': values.sku.odRequireDueDate ? values.sku.odRequireDueDate.format('YYYY-MM-DD') : '',\n            'odPromiseDueDate': values.sku.odPromiseDueDate ? values.sku.odPromiseDueDate.format('YYYY-MM-DD') : '',\n            'odAmount': values.sku.odAmount,\n            'odNumber': values.sku.odNumber,\n            'odSkuCustPrice': values.sku.odSkuCustPrice,\n            'odPurchaseOrderno': values.sku.odPurchaseOrderno\n          };\n          var data = {};\n\n          var backData = _objectSpread({}, _this2.sku, val);\n\n          data.isAddContactInfo = false;\n          data.sku = backData;\n\n          _this2.$emit('showAddContactInfo', data);\n\n          for (var i in _this2.sku) {\n            _this2.sku[i] = '';\n          }\n\n          _this2.form.resetFields();\n        }\n      });\n    },\n    handleReset: function handleReset() {\n      var data = {};\n      data.isAddContactInfo = false;\n\n      for (var i in this.sku) {\n        this.sku[i] = '';\n      }\n\n      this.form.resetFields();\n      this.$emit('showAddContactInfo', data);\n    },\n    currentPageChange: function currentPageChange(e) {\n      var resut = this.getCurrentPageChange(e);\n\n      if (resut) {\n        this.getListCompanyCustomGoods(this.currentPage);\n      }\n    },\n    handleSelect: function handleSelect(value) {\n      var _this3 = this;\n\n      if (this.timer !== '') {\n        clearTimeout(this.timer);\n      }\n\n      this.timer = setTimeout(function () {\n        _this3.customerGoodsPages = 0;\n        _this3.currentPage = 1;\n        _this3.listCustomerGoods = [];\n        _this3.codeKey = value;\n\n        _this3.getListCompanyCustomGoods();\n      }, 500);\n    },\n\n    /**\n     * @description 列表商家对客户的定制商品基本信息\n     * @description 客户已经有的商品排在前面 先获取列表商家对客户的定制商品基本信息 如果数据少于预定的pagesize数量则再获取商家的所有产品\n     */\n    getListCompanyCustomGoods: function getListCompanyCustomGoods() {\n      var _this4 = this;\n\n      var currentPage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n      var pageSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 20;\n\n      if (currentPage >= this.customerGoodsPages && this.customerGoodsPages !== 0) {\n        return;\n      }\n\n      get(api.getListCompanyCustomGoods, {\n        key: this.codeKey,\n        skuType: 'SPRING',\n        currentPage: currentPage,\n        pageSize: pageSize,\n        custId: this.custId\n      }).then(function (res) {\n        var listCustomerGoods = res.data.data.records;\n        _this4.listCustomerGoods = _this4.listCustomerGoods.concat(listCustomerGoods);\n        _this4.currentPage += 1;\n        _this4.customerGoodsPages = Number(res.data.data.pages);\n      });\n    },\n    odNumberRegx: function odNumberRegx(rule, value, callback) {\n      if (value && value <= 0) {\n        callback('购买数量不能为0');\n      } else {\n        callback();\n      }\n    }\n  }\n};",{"version":3,"sources":["EditableCell.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <a-form :form=\"form\">\n    <a-form-item label=\"产品编码\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-select\n        style=\"width:280px\"\n        showSearch\n        :value=\"value\"\n        :showArrow=\"false\"\n        :filterOption=\"false\"\n        :defaultActiveFirstOption=\"false\"\n        :dropdownMatchSelectWidth=\"false\"\n        @search=\"handleSelect\"\n        @change=\"(val)=>{inputChange(val)}\"\n        @popupScroll=\"e=>currentPageChange(e)\"\n      >\n        <a-select-option v-for=\"(item,index) in listCustomerGoods\" :key=\"index\">\n          <div class=\"product-list\">\n            <div class=\"product-list-left\">\n              <img :src=\"item.skuPic\" />\n            </div>\n            <div class=\"product-list-right\">\n              <div class=\"product-list-right-name\">{{item.name}}</div>\n              <div>{{item.code}}</div>\n              <div>{{item.spec}} - {{item.cz}} - {{item.drawNum}}</div>\n            </div>\n          </div>\n        </a-select-option>\n      </a-select>\n    </a-form-item>\n    <a-form-item label=\"订单数量\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odNumber',{rules: [{ required: true, message: '请输入订单数量' }, {validator: odNumberRegx}],initialValue:sku.odNumber}]\"\n        @change=\"(e)=>{inputnumChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">{{sku.unit}}</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"产品单价\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odSkuCustPrice',{initialValue:sku.odSkuCustPrice}]\"\n        @change=\"(e)=>{inputPriceChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"订单总计\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odAmount',{initialValue:sku.odAmount}]\">\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"采购单号：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odPurchaseOrderno']\" />\n    </a-form-item>\n    <a-form-item label=\"要求交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odRequireDueDate']\" />\n    </a-form-item>\n    <a-form-item label=\"承诺交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odPromiseDueDate']\" />\n    </a-form-item>\n    <a-form-item :style=\"{ textAlign: 'center' }\">\n      <a-button :style=\"{ marginRight: '8px' }\" @click=\"handleReset\">取消</a-button>\n      <a-button type=\"primary\" @click=\"handleEditableInfo\">确认添加</a-button>\n    </a-form-item>\n  </a-form>\n</template>\n<script>\nimport { get } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { mixinCurrentPage } from '@/views/sale/mixin/minxinSale'\nimport moment from 'moment'\nexport default {\n  mixins: [mixinCurrentPage],\n  props: {\n    custId: {\n      type: String\n    }\n  },\n  data() {\n    return {\n      form: this.$form.createForm(this),\n      customerGoodsPages: 0,\n      currentPage: 1,\n      labelCol: { span: 6, offset: 0 },\n      wrapperCol: { span: 16 },\n      sku: {\n        skuId: '',\n        code: undefined,\n        odSkuName: '',\n        odSpec: '',\n        taxRate: 0,\n        odSkuCustPrice: '',\n        odAmount: '',\n        odSkuCustCode: '', // 客户产品编码\n        unit: ''\n      },\n      value: '',\n      codeKey: '',\n      timer: '',\n      listCustomerGoods: [] // 商品信息\n    }\n  },\n  created() {\n    this.getListCompanyCustomGoods()\n  },\n  methods: {\n    moment,\n    inputChange(val) {\n      const listCustomerGoods = this.listCustomerGoods[val]\n      this.value = `${listCustomerGoods.code}-${listCustomerGoods.name}`\n      this.form.resetFields('sku.odNumber')\n      this.sku.odAmount = ''\n      this.sku.odSkuCustPrice = ''\n      get(api.getSkuPrice + `/${listCustomerGoods.id}/${this.custId}`).then(res => {\n        if (res.data.code === 0) {\n          const data = res.data.data\n          const skuCustPrice = data.skuCustPrice\n          this.sku.odSkuName = data.name\n          this.sku.odSpec = data.spec\n          this.sku.taxRate = data.taxRate\n          this.sku.odSkuCustPrice = skuCustPrice.length ? skuCustPrice[0].price : data.price\n          this.sku.code = data.code\n          this.sku.odSkuCustCode = data.skuCustInfo ? data.skuCustInfo.custSkuCode : ''\n          this.sku.skuId = data.id\n          this.sku.unit = data.unit\n        }\n      })\n    },\n    // 订单数量变化\n    inputnumChange(val) {\n      const price = this.form.getFieldValue('sku.odSkuCustPrice')\n      let total = 0\n      total = Number((Number(price) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    // 产品价格变化\n    inputPriceChange(val) {\n      const num = this.form.getFieldValue('sku.odNumber')\n      let total = 0\n      total = Number((Number(num) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    handleEditableInfo(e) {\n      e.preventDefault()\n      if (!this.value) {\n        this.$message.warning('请选择产品')\n        return\n      }\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          const val = {\n            'odRequireDueDate': values.sku.odRequireDueDate ? values.sku.odRequireDueDate.format('YYYY-MM-DD') : '',\n            'odPromiseDueDate': values.sku.odPromiseDueDate ? values.sku.odPromiseDueDate.format('YYYY-MM-DD') : '',\n            'odAmount': values.sku.odAmount,\n            'odNumber': values.sku.odNumber,\n            'odSkuCustPrice': values.sku.odSkuCustPrice,\n            'odPurchaseOrderno': values.sku.odPurchaseOrderno\n          }\n          const data = {}\n          const backData = { ...this.sku, ...val }\n          data.isAddContactInfo = false\n          data.sku = backData\n          this.$emit('showAddContactInfo', data)\n          for (const i in this.sku) {\n            this.sku[i] = ''\n          }\n          this.form.resetFields()\n        }\n      })\n    },\n    handleReset() {\n      var data = {}\n      data.isAddContactInfo = false\n      for (const i in this.sku) {\n        this.sku[i] = ''\n      }\n      this.form.resetFields()\n      this.$emit('showAddContactInfo', data)\n    },\n    currentPageChange(e) {\n      const resut = this.getCurrentPageChange(e)\n      if (resut) {\n        this.getListCompanyCustomGoods(this.currentPage)\n      }\n    },\n    handleSelect(value) {\n      if (this.timer !== '') {\n        clearTimeout(this.timer)\n      }\n      this.timer = setTimeout(() => {\n        this.customerGoodsPages = 0\n        this.currentPage = 1\n        this.listCustomerGoods = []\n        this.codeKey = value\n        this.getListCompanyCustomGoods()\n      }, 500)\n    },\n    /**\n     * @description 列表商家对客户的定制商品基本信息\n     * @description 客户已经有的商品排在前面 先获取列表商家对客户的定制商品基本信息 如果数据少于预定的pagesize数量则再获取商家的所有产品\n     */\n    getListCompanyCustomGoods(currentPage = 1, pageSize = 20) {\n      if (currentPage >= this.customerGoodsPages && this.customerGoodsPages !== 0) {\n        return\n      }\n      get(api.getListCompanyCustomGoods, { key: this.codeKey, skuType: 'SPRING', currentPage, pageSize, custId: this.custId }).then(res => {\n        const listCustomerGoods = res.data.data.records\n        this.listCustomerGoods = this.listCustomerGoods.concat(listCustomerGoods)\n        this.currentPage += 1\n        this.customerGoodsPages = Number(res.data.data.pages)\n      })\n    },\n    odNumberRegx(rule, value, callback) {\n      if (value && value <= 0) {\n        callback('购买数量不能为0')\n      } else {\n        callback()\n      }\n    }\n  }\n}\n</script>\n\n<style lang='less' scoped>\n.product-list {\n  margin-bottom: 4px;\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  align-content: center;\n  font-size: 12px;\n  &-left {\n    img {\n      width: 50px;\n      height: 50px;\n      vertical-align: middle;\n    }\n  }\n  &-right {\n    text-align: left;\n    margin-left: 10px;\n    &-name {\n      font-size: 14px;\n      font-weight: 600;\n    }\n  }\n}\n.product-list::after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  bottom: -2px;\n  width: 100%;\n  height: 1px;\n  background-color: #ddd;\n}\n</style>\n"],"sourceRoot":"src/views/sale/orderList/basic_lib"}]}