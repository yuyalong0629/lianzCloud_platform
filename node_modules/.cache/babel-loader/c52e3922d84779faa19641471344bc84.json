{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/thread-loader/dist/cjs.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue","mtime":1564139090395},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { get } from '@/api/axios.js';\nimport api from '@/api/index.js';\nimport { mixinCurrentPage } from '@/views/sale/mixin/minxinSale';\nimport moment from 'moment';\nexport default {\n  mixins: [mixinCurrentPage],\n  props: {\n    custId: {\n      type: String\n    }\n  },\n  data: function data() {\n    return {\n      form: this.$form.createForm(this),\n      customerGoods: 1,\n      // 列表商家对客户的定制商品基本信息\n      customerGoodsPages: 0,\n      currentPage: 1,\n      currentTotal: null,\n      labelCol: {\n        span: 6,\n        offset: 0\n      },\n      wrapperCol: {\n        span: 16\n      },\n      sku: {\n        skuId: '',\n        code: undefined,\n        odSkuName: '',\n        odSpec: '',\n        taxRate: 0,\n        odSkuCustPrice: '',\n        odAmount: '',\n        odSkuCustCode: '',\n        // 客户产品编码\n        unit: ''\n      },\n      codeKey: '',\n      timer: '',\n      listCustomerGoods: [] // 商品信息\n\n    };\n  },\n  created: function created() {\n    this.getListCompanyCustomGoods();\n  },\n  methods: {\n    moment: moment,\n    inputChange: function inputChange(val) {\n      var _this = this;\n\n      var listCustomerGoods = this.listCustomerGoods[val];\n      this.form.resetFields('sku.odNumber');\n      this.sku.odAmount = '';\n      this.sku.odSkuCustPrice = '';\n      get(api.getSkuPrice + \"/\".concat(listCustomerGoods.id, \"/\").concat(this.custId)).then(function (res) {\n        if (res.data.code === 0) {\n          var data = res.data.data;\n          var skuCustPrice = data.skuCustPrice;\n          _this.sku.odSkuName = data.name;\n          _this.sku.odSpec = data.spec;\n          _this.sku.taxRate = data.taxRate;\n          _this.sku.odSkuCustPrice = skuCustPrice.length ? skuCustPrice[0].price : data.price;\n          _this.sku.code = data.code;\n          _this.sku.odSkuCustCode = data.skuCustInfo ? data.skuCustInfo.custSkuCode : '';\n          _this.sku.skuId = data.id;\n          _this.sku.unit = data.unit;\n        }\n      });\n    },\n    // 订单数量变化\n    inputnumChange: function inputnumChange(val) {\n      var price = this.form.getFieldValue('sku.odSkuCustPrice');\n      var total = 0;\n      total = Number((Number(price) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/));\n      this.sku.odAmount = total;\n    },\n    // 产品价格变化\n    inputPriceChange: function inputPriceChange(val) {\n      var num = this.form.getFieldValue('sku.odNumber');\n      var total = 0;\n      total = Number((Number(num) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/));\n      this.sku.odAmount = total;\n    },\n    handleEditableInfo: function handleEditableInfo(e) {\n      var _this2 = this;\n\n      e.preventDefault();\n      this.form.validateFields(function (err, values) {\n        if (!err) {\n          var val = {\n            'odRequireDueDate': values.sku.odRequireDueDate ? values.sku.odRequireDueDate.format('YYYY-MM-DD') : '',\n            'odPromiseDueDate': values.sku.odPromiseDueDate ? values.sku.odPromiseDueDate.format('YYYY-MM-DD') : '',\n            'odAmount': values.sku.odAmount,\n            'odNumber': values.sku.odNumber,\n            'odSkuCustPrice': values.sku.odSkuCustPrice,\n            'odPurchaseOrderno': values.sku.odPurchaseOrderno\n          };\n          var data = {};\n\n          var backData = _objectSpread({}, _this2.sku, val);\n\n          data.isAddContactInfo = false;\n          data.sku = backData;\n\n          _this2.$emit('showAddContactInfo', data);\n\n          for (var i in _this2.sku) {\n            _this2.sku[i] = '';\n          }\n\n          _this2.form.resetFields();\n        }\n      });\n    },\n    handleReset: function handleReset() {\n      var data = {};\n      data.isAddContactInfo = false;\n\n      for (var i in this.sku) {\n        this.sku[i] = '';\n      }\n\n      this.form.resetFields();\n      this.$emit('showAddContactInfo', data);\n    },\n    currentPageChange: function currentPageChange(e) {\n      var resut = this.getCurrentPageChange(e);\n\n      if (resut) {\n        if (this.listCustomerGoods.length >= this.currentTotal) {\n          this.getListCustomerGoods();\n        } else {\n          this.getListCustomerGoods(this.customerGoods);\n        }\n      }\n    },\n    handleSelect: function handleSelect(value) {\n      var _this3 = this;\n\n      if (this.timer !== '') {\n        clearTimeout(this.timer);\n      }\n\n      this.timer = setTimeout(function () {\n        _this3.listCustomerGoods = [];\n        _this3.codeKey = value;\n\n        _this3.getListCompanyCustomGoods();\n      }, 500);\n    },\n\n    /**\n     * @description 列表商家对客户的定制商品基本信息\n     * @description 客户已经有的商品排在前面 先获取列表商家对客户的定制商品基本信息 如果数据少于预定的pagesize数量则再获取商家的所有产品\n     */\n    getListCompanyCustomGoods: function getListCompanyCustomGoods() {\n      var _this4 = this;\n\n      var currentPage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n      var pageSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 20;\n      get(api.getListCompanyCustomGoods, {\n        key: this.codeKey,\n        skuType: 'SPRING',\n        currentPage: currentPage,\n        pageSize: pageSize,\n        custId: this.custId\n      }).then(function (res) {\n        var listCustomerGoods = res.data.data.records;\n        _this4.listCustomerGoods = _this4.listCustomerGoods.concat(listCustomerGoods);\n        _this4.currentPage += 1;\n        _this4.currentTotal = Number(res.data.data.total);\n\n        if (Number(res.data.data.total) < pageSize) {\n          _this4.getListCustomerGoods();\n        }\n      });\n    },\n    // 列表商家商品基本信息\n    getListCustomerGoods: function getListCustomerGoods() {\n      var _this5 = this;\n\n      var currentPage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n      var pageSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 20;\n\n      if (currentPage > this.customerGoodsPages && this.customerGoodsPages !== 0) {\n        return;\n      }\n\n      get(api.getListCompanyGoods, {\n        key: this.codeKey,\n        skuType: 'SPRING',\n        currentPage: currentPage,\n        pageSize: pageSize\n      }).then(function (res) {\n        var listCustomerGoods = res.data.data.records;\n        _this5.listCustomerGoods = _this5.listCustomerGoods.concat(listCustomerGoods);\n        _this5.customerGoodsPages = Number(res.data.data.pages);\n        _this5.customerGoods += 1;\n      });\n    },\n    odNumberRegx: function odNumberRegx(rule, value, callback) {\n      if (value && value <= 0) {\n        callback('购买数量不能为0');\n      } else {\n        callback();\n      }\n    }\n  }\n};",{"version":3,"sources":["EditableCell.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <a-form :form=\"form\">\n    <a-form-item label=\"产品编码\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-select\n        style=\"width:280px\"\n        showSearch\n        v-decorator=\"['sku.code',{rules: [{ required: true, message: '请选择产品编码' }],initialValue:sku.code}]\"\n        :showArrow=\"false\"\n        :filterOption=\"false\"\n        :defaultActiveFirstOption=\"false\"\n        @search=\"handleSelect\"\n        @change=\"(val)=>{inputChange(val)}\"\n        @popupScroll=\"e=>currentPageChange(e)\"\n      >\n        <a-select-option\n          v-for=\"(item,index) in listCustomerGoods\"\n          :key=\"index\"\n        >{{item.code}} - {{item.name}}</a-select-option>\n      </a-select>\n    </a-form-item>\n    <a-form-item label=\"订单数量\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odNumber',{rules: [{ required: true, message: '请输入订单数量' }, {validator: odNumberRegx}],initialValue:sku.odNumber}]\"\n        @change=\"(e)=>{inputnumChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">{{sku.unit}}</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"产品单价\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odSkuCustPrice',{initialValue:sku.odSkuCustPrice}]\"\n        @change=\"(e)=>{inputPriceChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"订单总计\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odAmount',{initialValue:sku.odAmount}]\">\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"采购单号：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odPurchaseOrderno']\" />\n    </a-form-item>\n    <a-form-item label=\"要求交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odRequireDueDate']\" />\n    </a-form-item>\n    <a-form-item label=\"承诺交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odPromiseDueDate']\" />\n    </a-form-item>\n    <a-form-item :style=\"{ textAlign: 'center' }\">\n      <a-button :style=\"{ marginRight: '8px' }\" @click=\"handleReset\">取消</a-button>\n      <a-button type=\"primary\" @click=\"handleEditableInfo\">确认添加</a-button>\n    </a-form-item>\n  </a-form>\n</template>\n<script>\nimport { get } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { mixinCurrentPage } from '@/views/sale/mixin/minxinSale'\nimport moment from 'moment'\nexport default {\n  mixins: [mixinCurrentPage],\n  props: {\n    custId: {\n      type: String\n    }\n  },\n  data() {\n    return {\n      form: this.$form.createForm(this),\n      customerGoods: 1, // 列表商家对客户的定制商品基本信息\n      customerGoodsPages: 0,\n      currentPage: 1,\n      currentTotal: null,\n      labelCol: { span: 6, offset: 0 },\n      wrapperCol: { span: 16 },\n      sku: {\n        skuId: '',\n        code: undefined,\n        odSkuName: '',\n        odSpec: '',\n        taxRate: 0,\n        odSkuCustPrice: '',\n        odAmount: '',\n        odSkuCustCode: '', // 客户产品编码\n        unit: ''\n      },\n      codeKey: '',\n      timer: '',\n      listCustomerGoods: [] // 商品信息\n    }\n  },\n  created() {\n    this.getListCompanyCustomGoods()\n  },\n  methods: {\n    moment,\n    inputChange(val) {\n      const listCustomerGoods = this.listCustomerGoods[val]\n      this.form.resetFields('sku.odNumber')\n      this.sku.odAmount = ''\n      this.sku.odSkuCustPrice = ''\n      get(api.getSkuPrice + `/${listCustomerGoods.id}/${this.custId}`).then(res => {\n        if (res.data.code === 0) {\n          const data = res.data.data\n          const skuCustPrice = data.skuCustPrice\n          this.sku.odSkuName = data.name\n          this.sku.odSpec = data.spec\n          this.sku.taxRate = data.taxRate\n          this.sku.odSkuCustPrice = skuCustPrice.length ? skuCustPrice[0].price : data.price\n          this.sku.code = data.code\n          this.sku.odSkuCustCode = data.skuCustInfo ? data.skuCustInfo.custSkuCode : ''\n          this.sku.skuId = data.id\n          this.sku.unit = data.unit\n        }\n      })\n    },\n    // 订单数量变化\n    inputnumChange(val) {\n      const price = this.form.getFieldValue('sku.odSkuCustPrice')\n      let total = 0\n      total = Number((Number(price) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    // 产品价格变化\n    inputPriceChange(val) {\n      const num = this.form.getFieldValue('sku.odNumber')\n      let total = 0\n      total = Number((Number(num) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    handleEditableInfo(e) {\n      e.preventDefault()\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          const val = {\n            'odRequireDueDate': values.sku.odRequireDueDate ? values.sku.odRequireDueDate.format('YYYY-MM-DD') : '',\n            'odPromiseDueDate': values.sku.odPromiseDueDate ? values.sku.odPromiseDueDate.format('YYYY-MM-DD') : '',\n            'odAmount': values.sku.odAmount,\n            'odNumber': values.sku.odNumber,\n            'odSkuCustPrice': values.sku.odSkuCustPrice,\n            'odPurchaseOrderno': values.sku.odPurchaseOrderno\n          }\n          const data = {}\n          const backData = { ...this.sku, ...val }\n          data.isAddContactInfo = false\n          data.sku = backData\n          this.$emit('showAddContactInfo', data)\n          for (const i in this.sku) {\n            this.sku[i] = ''\n          }\n          this.form.resetFields()\n        }\n      })\n    },\n    handleReset() {\n      var data = {}\n      data.isAddContactInfo = false\n      for (const i in this.sku) {\n        this.sku[i] = ''\n      }\n      this.form.resetFields()\n      this.$emit('showAddContactInfo', data)\n    },\n    currentPageChange(e) {\n      const resut = this.getCurrentPageChange(e)\n      if (resut) {\n        if (this.listCustomerGoods.length >= this.currentTotal) {\n          this.getListCustomerGoods()\n        } else {\n          this.getListCustomerGoods(this.customerGoods)\n        }\n      }\n    },\n    handleSelect(value) {\n      if (this.timer !== '') {\n        clearTimeout(this.timer)\n      }\n      this.timer = setTimeout(() => {\n        this.listCustomerGoods = []\n        this.codeKey = value\n        this.getListCompanyCustomGoods()\n      }, 500)\n    },\n    /**\n     * @description 列表商家对客户的定制商品基本信息\n     * @description 客户已经有的商品排在前面 先获取列表商家对客户的定制商品基本信息 如果数据少于预定的pagesize数量则再获取商家的所有产品\n     */\n    getListCompanyCustomGoods(currentPage = 1, pageSize = 20) {\n      get(api.getListCompanyCustomGoods, { key: this.codeKey, skuType: 'SPRING', currentPage, pageSize, custId: this.custId }).then(res => {\n        const listCustomerGoods = res.data.data.records\n        this.listCustomerGoods = this.listCustomerGoods.concat(listCustomerGoods)\n        this.currentPage += 1\n        this.currentTotal = Number(res.data.data.total)\n        if (Number(res.data.data.total) < pageSize) {\n          this.getListCustomerGoods()\n        }\n      })\n    },\n    // 列表商家商品基本信息\n    getListCustomerGoods(currentPage = 1, pageSize = 20) {\n      if (currentPage > this.customerGoodsPages && this.customerGoodsPages !== 0) {\n        return\n      }\n      get(api.getListCompanyGoods, { key: this.codeKey, skuType: 'SPRING', currentPage, pageSize }).then(res => {\n        const listCustomerGoods = res.data.data.records\n        this.listCustomerGoods = this.listCustomerGoods.concat(listCustomerGoods)\n        this.customerGoodsPages = Number(res.data.data.pages)\n        this.customerGoods += 1\n      })\n    },\n    odNumberRegx(rule, value, callback) {\n      if (value && value <= 0) {\n        callback('购买数量不能为0')\n      } else {\n        callback()\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/views/sale/orderList/basic_lib"}]}