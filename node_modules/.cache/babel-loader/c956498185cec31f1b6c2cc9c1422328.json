{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/craft_info/CraftInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/craft_info/CraftInfo.vue","mtime":1565252860546},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Bus from '@/Bus.js';\nimport { bomColumns } from 'goods/basic_lib/column';\nimport CraftDrawer from './CraftDrawer';\nimport { craftLineInfo } from './index';\nexport default {\n  name: 'CraftInfo',\n  data: function data() {\n    return {\n      count: 0,\n      bomColumns: bomColumns,\n      data: [],\n      childrenDrawer: false,\n      bomButton: false,\n      getList: [],\n      newData: [],\n      buttonShow: false,\n      type: undefined\n    };\n  },\n  props: {\n    craftsInfoData: {\n      type: Array,\n      default: [],\n      required: false\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    Bus.$on('setBomButton', function (val) {\n      _this.buttonShow = val;\n    });\n    Bus.$on('basicInfo', function (val) {\n      _this.type = val.type;\n    });\n  },\n  destroyed: function destroyed() {\n    Bus.$off('setBomButton');\n    Bus.$off('basicInfo');\n  },\n  methods: {\n    // Modal\n    handleAdd: function handleAdd() {\n      var count = this.count,\n          data = this.data;\n      var newData = {\n        key: count,\n        inputVal: \"\\u5DE5\\u827A\".concat(count + 1),\n        inputShow: true,\n        productCraftCode: '',\n        productCraftId: '',\n        defaultCraft: count === 0,\n        dataSource: []\n      };\n      this.data = [].concat(_toConsumableArray(data), [newData]);\n      this.count = count + 1; // console.log(this.data)\n\n      this.$emit('craftData', this.data);\n    },\n    // 选择BOM\n    onChangeCheckbox: function onChangeCheckbox(records) {\n      if (this.type === undefined && !this.childDisabled) {\n        return;\n      }\n\n      var newData = _toConsumableArray(this.data);\n\n      newData.forEach(function (item) {\n        if (records.key === item.key) {\n          item.defaultCraft = !item.defaultCraft;\n        } else {\n          item.defaultCraft = false;\n        }\n      });\n      this.data = _toConsumableArray(newData);\n      this.$emit('craftData', this.data);\n    },\n    // 删除\n    onDelete: function onDelete(key) {\n      var newData = _toConsumableArray(this.data);\n\n      this.data = newData.filter(function (item) {\n        return item.key !== key;\n      }); // console.log(this.data)\n\n      this.$emit('craftData', this.data);\n\n      if (!this.data.length) {\n        this.count = 0;\n      } // console.log(this.data)\n\n    },\n    // Input\n    onInput: function onInput(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0];\n\n      if (target) {\n        target.inputShow = false;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n      }\n    },\n    onChange: function onChange(value, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0];\n\n      if (target) {\n        target.inputVal = value;\n        this.data = _toConsumableArray(newData);\n        this.$emit('craftData', this.data);\n      }\n    },\n    // Save\n    onSave: function onSave(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0]; // console.log(target)\n\n      if (target) {\n        target.inputShow = true;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n\n        this.$emit('craftData', this.data);\n      }\n    },\n    // Table\n    onTabAdd: function () {\n      var _onTabAdd = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(key) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.$router.push({\n                  query: _objectSpread({}, this.$route.query, {\n                    craftIndex: key\n                  })\n                });\n                _context.next = 3;\n                return true;\n\n              case 3:\n                this.childrenDrawer = _context.sent;\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function onTabAdd(_x) {\n        return _onTabAdd.apply(this, arguments);\n      }\n\n      return onTabAdd;\n    }(),\n    // 关闭抽屉\n    onChildrenDrawerClose: function onChildrenDrawerClose() {\n      this.childrenDrawer = false;\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer: function acceptChildDrawer(val) {\n      this.childrenDrawer = val;\n    },\n    // Step 删除\n    onStepDelete: function onStepDelete(key, id) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.dataSource = target.dataSource.filter(function (item) {\n          return item.id !== id;\n        });\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n      }\n    },\n    // drawer data\n    craftDrawerData: function craftDrawerData(val) {\n      if (val.list.length) {\n        // console.log(val.name)\n        var newData = _toConsumableArray(this.data);\n\n        var craftIndex = this.$route.query.craftIndex;\n        var target = newData.filter(function (item) {\n          return item.key === craftIndex;\n        })[0];\n\n        if (target) {\n          target.dataSource = _toConsumableArray(val.list);\n          target.inputVal = val.record.name;\n          target.productCraftCode = val.record.code;\n          target.productCraftId = val.record.key;\n          this.data = _toConsumableArray(newData); // console.log(this.data)\n\n          this.$emit('craftData', this.data);\n        }\n      }\n    }\n  },\n  watch: {\n    craftsInfoData: {\n      handler: function handler(val) {\n        var _this2 = this;\n\n        if (val.length) {\n          var _loop = function _loop(i) {\n            craftLineInfo.call(_this2, val[i].productCraftId).then(function () {\n              var count = _this2.count,\n                  data = _this2.data;\n\n              var newData = _objectSpread({}, val[i], {\n                key: val[i].sort,\n                inputVal: val[i].productCraftName,\n                inputShow: true,\n                id: val[i].id,\n                productCraftCode: val[i].productCraftCode,\n                productCraftId: val[i].productCraftId,\n                defaultCraft: val[i].defaultCraft,\n                dataSource: _toConsumableArray(_this2.getList)\n              });\n\n              _this2.data = [].concat(_toConsumableArray(data), [newData]); // console.log(this.data)\n\n              _this2.count = val[i].sort + 1;\n            }).then(function () {\n              _this2.$emit('craftData', _this2.data);\n            });\n          };\n\n          // console.log(val)\n          for (var i = 0; i < val.length; i++) {\n            _loop(i);\n          }\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'craft-drawer': CraftDrawer\n  }\n};",{"version":3,"sources":["CraftInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"craft-info\">\n    <div\n      class=\"craft-table\"\n      :class=\"item.defaultCraft === true ? 'activeOk' : 'activeNo'\"\n      v-for=\"item of data\"\n      :key=\"item.key\"\n      @click=\"onChangeCheckbox(item)\"\n    >\n      <!-- checked -->\n      <div class=\"craft-icon-checked\" v-if=\"item.defaultCraft\">\n        <a-icon class=\"icon-right\" type=\"check\" />\n      </div>\n      <!-- default -->\n      <div class=\"craft-icon-default\">\n        <a-button\n          v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n          size=\"small\"\n          type=\"danger\"\n          @click.stop=\"onDelete(item.key)\"\n        >删除</a-button>\n      </div>\n      <!-- Input -->\n      <div class=\"craft-input\">\n        <h3 v-if=\"item.inputShow\" class=\"craft-title\">{{ item.inputVal }}</h3>\n        <a-icon\n          v-if=\"item.inputShow\"\n          v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n          type=\"form\"\n          @click.stop=\"onInput(item.key)\"\n        />\n        <a-input\n          v-if=\"!item.inputShow\"\n          :value=\"item.inputVal\"\n          size=\"small\"\n          :placeholder=\"`请输入${item.inputVal}`\"\n          style=\"width: 160px; margin-right: 5px;\"\n          @change=\"e => onChange(e.target.value, item.key)\"\n        />\n        <a-icon v-if=\"!item.inputShow\" type=\"file-add\" @click.stop=\"onSave(item.key)\" />\n      </div>\n      <!-- Steps -->\n      <a-steps :current=\"item.dataSource.length\" size=\"small\">\n        <a-step v-for=\"(cItem,index) in item.dataSource\" :key=\"index\" :title=\"cItem.name\">\n          <a-icon\n            class=\"step-icon\"\n            type=\"close-circle\"\n            slot=\"icon\"\n            v-show=\"childDisabled\"\n            @click=\"onStepDelete(item.key, cItem.id)\"\n          />\n        </a-step>\n      </a-steps>\n      <a-button\n        style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n        v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n        type=\"dashed\"\n        icon=\"plus\"\n        @click.stop=\"onTabAdd(item.key)\"\n      >选择工艺流程</a-button>\n    </div>\n    <!-- 抽屉 -->\n    <a-drawer\n      :destroyOnClose=\"true\"\n      :title=\"false\"\n      width=\"300\"\n      :closable=\"false\"\n      @close=\"onChildrenDrawerClose\"\n      :visible=\"childrenDrawer\"\n    >\n      <craft-drawer @acceptChildDrawer=\"acceptChildDrawer\" @craftDrawerData=\"craftDrawerData\" />\n    </a-drawer>\n    <a-button\n      style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n      v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n      type=\"dashed\"\n      icon=\"plus\"\n      @click=\"handleAdd\"\n    >添加工艺</a-button>\n  </div>\n</template>\n<script>\nimport Bus from '@/Bus.js'\nimport { bomColumns } from 'goods/basic_lib/column'\nimport CraftDrawer from './CraftDrawer'\nimport { craftLineInfo } from './index'\n\nexport default {\n  name: 'CraftInfo',\n  data() {\n    return {\n      count: 0,\n      bomColumns,\n      data: [],\n      childrenDrawer: false,\n      bomButton: false,\n      getList: [],\n      newData: [],\n      buttonShow: false,\n      type: undefined\n    }\n  },\n  props: {\n    craftsInfoData: {\n      type: Array,\n      default: [],\n      required: false\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mounted() {\n    Bus.$on('setBomButton', val => {\n      this.buttonShow = val\n    })\n    Bus.$on('basicInfo', val => {\n      this.type = val.type\n    })\n  },\n  destroyed() {\n    Bus.$off('setBomButton')\n    Bus.$off('basicInfo')\n  },\n  methods: {\n    // Modal\n    handleAdd() {\n      const { count, data } = this\n      const newData = {\n        key: count,\n        inputVal: `工艺${count + 1}`,\n        inputShow: true,\n        productCraftCode: '',\n        productCraftId: '',\n        defaultCraft: count === 0,\n        dataSource: []\n      }\n      this.data = [...data, newData]\n      this.count = count + 1\n      // console.log(this.data)\n      this.$emit('craftData', this.data)\n    },\n    // 选择BOM\n    onChangeCheckbox(records) {\n      if (this.type === undefined && !this.childDisabled) {\n        return\n      }\n      const newData = [...this.data]\n      newData.forEach(item => {\n        if (records.key === item.key) {\n          item.defaultCraft = !item.defaultCraft\n        } else {\n          item.defaultCraft = false\n        }\n      })\n      this.data = [...newData]\n      this.$emit('craftData', this.data)\n    },\n    // 删除\n    onDelete(key) {\n      const newData = [...this.data]\n      this.data = newData.filter(item => item.key !== key)\n      // console.log(this.data)\n      this.$emit('craftData', this.data)\n      if (!this.data.length) {\n        this.count = 0\n      }\n      // console.log(this.data)\n    },\n    // Input\n    onInput(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      if (target) {\n        target.inputShow = false\n        this.data = [...newData]\n        // console.log(this.data)\n      }\n    },\n    onChange(value, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      if (target) {\n        target.inputVal = value\n        this.data = [...newData]\n        this.$emit('craftData', this.data)\n      }\n    },\n    // Save\n    onSave(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      // console.log(target)\n      if (target) {\n        target.inputShow = true\n        this.data = [...newData]\n        // console.log(this.data)\n        this.$emit('craftData', this.data)\n      }\n    },\n    // Table\n    async onTabAdd(key) {\n      this.$router.push({\n        query: {\n          ...this.$route.query,\n          craftIndex: key\n        }\n      })\n      this.childrenDrawer = await true\n    },\n    // 关闭抽屉\n    onChildrenDrawerClose() {\n      this.childrenDrawer = false\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer(val) {\n      this.childrenDrawer = val\n    },\n    // Step 删除\n    onStepDelete(key, id) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.dataSource = target.dataSource.filter(item => item.id !== id)\n        this.data = [...newData]\n        // console.log(this.data)\n      }\n    },\n    // drawer data\n    craftDrawerData(val) {\n      if (val.list.length) {\n        // console.log(val.name)\n        const newData = [...this.data]\n        const craftIndex = this.$route.query.craftIndex\n        const target = newData.filter(item => item.key === craftIndex)[0]\n        if (target) {\n          target.dataSource = [...val.list]\n          target.inputVal = val.record.name\n          target.productCraftCode = val.record.code\n          target.productCraftId = val.record.key\n          this.data = [...newData]\n          // console.log(this.data)\n          this.$emit('craftData', this.data)\n        }\n      }\n    }\n  },\n  watch: {\n    craftsInfoData: {\n      handler(val) {\n        if (val.length) {\n          // console.log(val)\n          for (let i = 0; i < val.length; i++) {\n            craftLineInfo\n              .call(this, val[i].productCraftId)\n              .then(() => {\n                const { count, data } = this\n                const newData = {\n                  ...val[i],\n                  key: val[i].sort,\n                  inputVal: val[i].productCraftName,\n                  inputShow: true,\n                  id: val[i].id,\n                  productCraftCode: val[i].productCraftCode,\n                  productCraftId: val[i].productCraftId,\n                  defaultCraft: val[i].defaultCraft,\n                  dataSource: [...this.getList]\n                }\n                this.data = [...data, newData]\n                // console.log(this.data)\n                this.count = val[i].sort + 1\n              })\n              .then(() => {\n                this.$emit('craftData', this.data)\n              })\n          }\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'craft-drawer': CraftDrawer\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.craft-info {\n  .activeNo {\n    border: 1px solid #d9d9d9;\n  }\n  .activeOk {\n    border: 1px solid #69b412;\n  }\n  .craft-table {\n    // border: 1px solid #69b412;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 5px;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .ant-steps {\n      overflow-x: scroll;\n      /deep/ .ant-steps-item-icon {\n        .ant-steps-icon {\n          color: #f00;\n          font-size: 16px;\n        }\n      }\n      .ant-steps-item {\n        flex: none;\n        padding: 5px 10px 20px 10px;\n        &:last-child {\n          min-width: 30px;\n          padding-right: 0px;\n        }\n        /deep/ .ant-steps-item-content {\n          padding-right: 50px;\n        }\n      }\n    }\n    .craft-icon-checked {\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: 0;\n      height: 30px;\n      width: 30px;\n      border-left: 30px solid transparent;\n      border-top: 30px solid #69b412;\n      .icon-right {\n        color: #fff;\n        position: absolute;\n        right: 2px;\n        top: -28px;\n        z-index: 10;\n      }\n    }\n    .craft-icon-default {\n      position: absolute;\n      top: 8px;\n      right: 40px;\n      button {\n        font-size: 12px;\n      }\n    }\n    .craft-input {\n      margin-bottom: 10px;\n      .craft-title {\n        display: inline-block;\n        margin: 0 5px;\n      }\n    }\n    .editable-row-operations a {\n      margin-right: 8px;\n    }\n  }\n}\n.craft-modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 100px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n}\n</style>\n"],"sourceRoot":"src/views/product/pdm/goods/child_info/tab_goodsInfo/craft_info"}]}