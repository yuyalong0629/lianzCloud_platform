{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info/BomInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info/BomInfo.vue","mtime":1565252860545},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { bomColumns } from 'goods/basic_lib/column';\nimport BomDrawer from './BomDrawer';\nimport Bus from '@/Bus.js';\nexport default {\n  name: 'BomInfo',\n  data: function data() {\n    return {\n      count: 0,\n      bomColumns: bomColumns,\n      visible: false,\n      isModalActive: 0,\n      data: [],\n      childrenDrawer: false,\n      bomButton: false,\n      buttonShow: false,\n      type: undefined\n    };\n  },\n  props: {\n    materialsGroupInfoData: {\n      type: Array,\n      default: [],\n      required: false\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    Bus.$on('setBomButton', function (val) {\n      _this.buttonShow = val;\n    });\n    Bus.$on('basicInfo', function (val) {\n      _this.type = val.type;\n    });\n  },\n  destroyed: function destroyed() {\n    Bus.$off('basicInfo');\n    Bus.$off('setBomButton');\n  },\n  methods: {\n    // Modal\n    handleAdd: function handleAdd() {\n      this.visible = true;\n    },\n    // Modal Add\n    onModalOk: function () {\n      var _onModalOk = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(e) {\n        var count, data, isModalActive, newData;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return false;\n\n              case 2:\n                this.visible = _context.sent;\n                count = this.count, data = this.data, isModalActive = this.isModalActive;\n                newData = {\n                  key: count,\n                  inputVal: this.isModalActive === 0 ? \"\\u5DE5\\u827ABOM\" : \"\\u5236\\u9020BOM\",\n                  inputShow: true,\n                  bomType: isModalActive === 0 ? 'MAKE' : 'CRAFT',\n                  defaultMaterials: count === 0,\n                  dataSource: []\n                };\n                this.data = [].concat(_toConsumableArray(data), [newData]);\n                this.count = count + 1; // console.log(this.data)\n\n                this.$emit('bomData', this.data);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function onModalOk(_x) {\n        return _onModalOk.apply(this, arguments);\n      }\n\n      return onModalOk;\n    }(),\n    // Modal Cancel\n    onModalNo: function onModalNo(e) {\n      this.visible = false;\n    },\n    // Modal Tabs\n    onModalInfo: function onModalInfo(key) {\n      this.isModalActive = key;\n    },\n    // 选择BOM\n    onChangeCheckbox: function onChangeCheckbox(records) {\n      if (this.type === undefined && !this.childDisabled) {\n        return;\n      }\n\n      var newData = _toConsumableArray(this.data);\n\n      newData.forEach(function (item) {\n        if (records.key === item.key) {\n          item.defaultMaterials = !item.defaultMaterials;\n        } else {\n          item.defaultMaterials = false;\n        }\n      });\n      this.data = _toConsumableArray(newData);\n      console.log(this.data);\n      this.$emit('bomData', this.data);\n    },\n    // 删除\n    onDelete: function onDelete(key) {\n      var newData = _toConsumableArray(this.data);\n\n      this.data = newData.filter(function (item) {\n        return item.key !== key;\n      });\n\n      if (!this.data.length) {\n        this.count = 0;\n      } // console.log(this.data)\n\n\n      this.$emit('bomData', this.data);\n    },\n    // Input\n    onInput: function onInput(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0]; // console.log(target)\n\n      if (target) {\n        target.inputShow = false;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n      }\n    },\n    onChange: function onChange(value, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0];\n\n      if (target) {\n        target.inputVal = value;\n        this.data = _toConsumableArray(newData);\n        this.$emit('bomData', this.data);\n      }\n    },\n    // Save\n    onSave: function onSave(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === key;\n      })[0]; // console.log(target)\n\n      if (target) {\n        target.inputShow = true;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n\n        this.$emit('bomData', this.data);\n      }\n    },\n    // Table\n    onTabAdd: function () {\n      var _onTabAdd = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(key) {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.$router.push({\n                  query: _objectSpread({}, this.$route.query, {\n                    bomIndex: key\n                  })\n                });\n                _context2.next = 3;\n                return true;\n\n              case 3:\n                this.childrenDrawer = _context2.sent;\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function onTabAdd(_x2) {\n        return _onTabAdd.apply(this, arguments);\n      }\n\n      return onTabAdd;\n    }(),\n    onTabChange: function onTabChange(value, record, column, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      var targetData = target.dataSource.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n\n      if (targetData) {\n        targetData[column] = value;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n      }\n    },\n    onTabSave: function onTabSave(record, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      var targetData = target.dataSource.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n\n      if (targetData) {\n        targetData.editable = false;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n\n        this.$emit('bomData', this.data);\n      }\n    },\n    onTabDelete: function onTabDelete(record, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      target.dataSource = target.dataSource.filter(function (item) {\n        return record.key !== item.key;\n      });\n      this.data = _toConsumableArray(newData); // console.log(this.data)\n\n      this.$emit('bomData', this.data);\n    },\n    onTabEdit: function onTabEdit(record, key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      var targetData = target.dataSource.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n\n      if (targetData) {\n        targetData.editable = true;\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n      }\n    },\n    // 关闭抽屉\n    onChildrenDrawerClose: function onChildrenDrawerClose() {\n      this.childrenDrawer = false;\n    },\n    // BOM DATA\n    bomDrawerData: function bomDrawerData(val) {\n      // console.log(val)\n      var BomIndex = this.$route.query.bomIndex;\n\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return item.key === BomIndex;\n      })[0];\n\n      if (target) {\n        var newVal = {\n          // ...val,\n          code: val.code,\n          name: val.name,\n          spec: val.spec,\n          unit: val.unit,\n          key: val.id,\n          gateway: val.gateway === 'BUY' ? '外购' : '自制',\n          dosage: 1,\n          editable: true\n        };\n        var dataSource = target.dataSource.filter(function (item) {\n          return item.key !== newVal.key;\n        });\n        target.dataSource = [].concat(_toConsumableArray(dataSource), [newVal]);\n        this.data = _toConsumableArray(newData); // console.log(this.data)\n\n        this.$emit('bomData', this.data);\n      }\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer: function acceptChildDrawer(val) {\n      this.childrenDrawer = val;\n    }\n  },\n  watch: {\n    materialsGroupInfoData: {\n      handler: function handler(val) {\n        var _this2 = this;\n\n        if (val.length) {\n          // console.log(val)\n          val.forEach(function (item) {\n            var count = _this2.count,\n                data = _this2.data,\n                isModalActive = _this2.isModalActive;\n\n            var newData = _objectSpread({}, item, {\n              key: count,\n              inputVal: item.groupName,\n              inputShow: true,\n              bomType: item.bomType,\n              defaultMaterials: item.defaultMaterials,\n              id: item.id,\n              dataSource: item.skuMaterials.map(function (cItem) {\n                return {\n                  id: cItem.id,\n                  key: cItem.materialId,\n                  code: cItem.materialInfo.code,\n                  name: cItem.materialInfo.name,\n                  spec: cItem.materialInfo.spec,\n                  unit: cItem.materialInfo.unit,\n                  dosage: cItem.cost,\n                  editable: false,\n                  gateway: cItem.materialInfo && cItem.materialInfo.gateway === 'SELF' ? '自制' : '外购'\n                };\n              })\n            });\n\n            _this2.data = [].concat(_toConsumableArray(data), [newData]);\n            _this2.count = count + 1;\n            console.log(_this2.data);\n          });\n          this.$emit('bomData', this.data);\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    BomDrawer: BomDrawer\n  }\n};",{"version":3,"sources":["BomInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"bom-info\">\n    <div\n      class=\"bom-table\"\n      :class=\"item.defaultMaterials === true ? 'activeOk' : 'activeNo'\"\n      v-for=\"item of data\"\n      :key=\"item.key\"\n      @click=\"onChangeCheckbox(item)\"\n    >\n      <!-- checked -->\n      <div class=\"bom-icon-checked\" v-if=\"item.defaultMaterials\">\n        <a-icon class=\"icon-right\" type=\"check\" />\n      </div>\n      <!-- default -->\n      <div class=\"bom-icon-default\">\n        <a-button\n          v-show=\"!(childDisabled === false && buttonShow === false) &&type!==1\"\n          size=\"small\"\n          type=\"danger\"\n          @click.stop=\"onDelete(item.key)\"\n        >删除</a-button>\n      </div>\n      <!-- Input -->\n      <div class=\"bom-input\">\n        <h3 v-if=\"item.inputShow\" class=\"bom-title\">{{ item.inputVal }}</h3>\n        <a-icon\n          v-if=\"item.inputShow\"\n          v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n          type=\"form\"\n          @click.stop=\"onInput(item.key)\"\n        />\n        <a-input\n          v-if=\"!item.inputShow\"\n          :value=\"item.inputVal\"\n          size=\"small\"\n          :placeholder=\"`请输入${item.inputVal}`\"\n          style=\"width: 160px; margin-right: 5px;\"\n          @change=\"e => onChange(e.target.value, item.key)\"\n        />\n        <a-icon v-if=\"!item.inputShow\" type=\"file-add\" @click.stop=\"onSave(item.key)\" />\n      </div>\n      <!-- Table -->\n      <a-table :columns=\"bomColumns\" :dataSource=\"item.dataSource\" :pagination=\"false\">\n        <template v-for=\"col in ['dosage']\" :slot=\"col\" slot-scope=\"text, record, index\">\n          <div :key=\"col\">\n            <a-input\n              v-if=\"record.editable\"\n              style=\"margin: -5px 0\"\n              :value=\"text\"\n              @change=\"e => onTabChange(e.target.value, record, col, item.key)\"\n            />\n            <template v-else>{{ text }}</template>\n          </div>\n        </template>\n        <template slot=\"operation\" slot-scope=\"text, record, index\">\n          <div\n            class=\"editable-row-operations\"\n            v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n          >\n            <span v-if=\"!record.editable\">\n              <a @click.stop=\"() => onTabEdit(record, item.key)\">编辑</a>\n              <a-popconfirm title=\"确定要删除吗?\" @confirm=\"() => onTabDelete(record, item.key)\">\n                <a>删除</a>\n              </a-popconfirm>\n            </span>\n            <span v-else>\n              <a @click.stop=\"() => onTabSave(record, item.key)\">保存</a>\n            </span>\n          </div>\n        </template>\n      </a-table>\n      <a-button\n        style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n        v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n        type=\"dashed\"\n        icon=\"plus\"\n        @click.stop=\"onTabAdd(item.key)\"\n      >添加原材料</a-button>\n    </div>\n    <!-- Moadl -->\n    <a-modal title=\"选择BOM\" :visible=\"visible\" @ok=\"onModalOk\" @cancel=\"onModalNo\">\n      <ul class=\"bom-modal-list\">\n        <li :class=\"{modalActive: isModalActive === 0 ? true : false}\" @click=\"onModalInfo(0)\">工艺BOM</li>\n        <li :class=\"{modalActive: isModalActive === 1 ? true : false}\" @click=\"onModalInfo(1)\">制造BOM</li>\n      </ul>\n    </a-modal>\n    <!-- 抽屉 -->\n    <a-drawer\n      :destroyOnClose=\"true\"\n      :title=\"false\"\n      width=\"300\"\n      :closable=\"false\"\n      @close=\"onChildrenDrawerClose\"\n      :visible=\"childrenDrawer\"\n    >\n      <BomDrawer @acceptChildDrawer=\"acceptChildDrawer\" @bomDrawerData=\"bomDrawerData\" />\n    </a-drawer>\n    <a-button\n      style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n      v-show=\"!(childDisabled === false && buttonShow === false)&&type!==1\"\n      type=\"dashed\"\n      icon=\"plus\"\n      @click=\"handleAdd\"\n    >添加方案</a-button>\n  </div>\n</template>\n<script>\nimport { bomColumns } from 'goods/basic_lib/column'\nimport BomDrawer from './BomDrawer'\nimport Bus from '@/Bus.js'\n\nexport default {\n  name: 'BomInfo',\n  data() {\n    return {\n      count: 0,\n      bomColumns,\n      visible: false,\n      isModalActive: 0,\n      data: [],\n      childrenDrawer: false,\n      bomButton: false,\n      buttonShow: false,\n      type: undefined\n    }\n  },\n  props: {\n    materialsGroupInfoData: {\n      type: Array,\n      default: [],\n      required: false\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  mounted() {\n    Bus.$on('setBomButton', val => {\n      this.buttonShow = val\n    })\n    Bus.$on('basicInfo', val => {\n      this.type = val.type\n    })\n  },\n  destroyed() {\n    Bus.$off('basicInfo')\n    Bus.$off('setBomButton')\n  },\n  methods: {\n    // Modal\n    handleAdd() {\n      this.visible = true\n    },\n    // Modal Add\n    async onModalOk(e) {\n      this.visible = await false\n      const { count, data, isModalActive } = this\n      const newData = {\n        key: count,\n        inputVal: this.isModalActive === 0 ? `工艺BOM` : `制造BOM`,\n        inputShow: true,\n        bomType: isModalActive === 0 ? 'MAKE' : 'CRAFT',\n        defaultMaterials: count === 0,\n        dataSource: []\n      }\n      this.data = [...data, newData]\n      this.count = count + 1\n      // console.log(this.data)\n      this.$emit('bomData', this.data)\n    },\n    // Modal Cancel\n    onModalNo(e) {\n      this.visible = false\n    },\n    // Modal Tabs\n    onModalInfo(key) {\n      this.isModalActive = key\n    },\n    // 选择BOM\n    onChangeCheckbox(records) {\n      if (this.type === undefined && !this.childDisabled) {\n        return\n      }\n      const newData = [...this.data]\n      newData.forEach(item => {\n        if (records.key === item.key) {\n          item.defaultMaterials = !item.defaultMaterials\n        } else {\n          item.defaultMaterials = false\n        }\n      })\n      this.data = [...newData]\n      console.log(this.data)\n      this.$emit('bomData', this.data)\n    },\n    // 删除\n    onDelete(key) {\n      const newData = [...this.data]\n      this.data = newData.filter(item => item.key !== key)\n      if (!this.data.length) {\n        this.count = 0\n      }\n      // console.log(this.data)\n      this.$emit('bomData', this.data)\n    },\n    // Input\n    onInput(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      // console.log(target)\n      if (target) {\n        target.inputShow = false\n        this.data = [...newData]\n        // console.log(this.data)\n      }\n    },\n    onChange(value, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      if (target) {\n        target.inputVal = value\n        this.data = [...newData]\n        this.$emit('bomData', this.data)\n      }\n    },\n    // Save\n    onSave(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      // console.log(target)\n      if (target) {\n        target.inputShow = true\n        this.data = [...newData]\n        // console.log(this.data)\n        this.$emit('bomData', this.data)\n      }\n    },\n    // Table\n    async onTabAdd(key) {\n      this.$router.push({\n        query: {\n          ...this.$route.query,\n          bomIndex: key\n        }\n      })\n      this.childrenDrawer = await true\n    },\n    onTabChange(value, record, column, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData[column] = value\n        this.data = [...newData]\n        // console.log(this.data)\n      }\n    },\n    onTabSave(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData.editable = false\n        this.data = [...newData]\n        // console.log(this.data)\n        this.$emit('bomData', this.data)\n      }\n    },\n    onTabDelete(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      target.dataSource = target.dataSource.filter(\n        item => record.key !== item.key\n      )\n      this.data = [...newData]\n      // console.log(this.data)\n      this.$emit('bomData', this.data)\n    },\n    onTabEdit(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData.editable = true\n        this.data = [...newData]\n        // console.log(this.data)\n      }\n    },\n    // 关闭抽屉\n    onChildrenDrawerClose() {\n      this.childrenDrawer = false\n    },\n    // BOM DATA\n    bomDrawerData(val) {\n      // console.log(val)\n      const BomIndex = this.$route.query.bomIndex\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === BomIndex)[0]\n      if (target) {\n        const newVal = {\n          // ...val,\n          code: val.code,\n          name: val.name,\n          spec: val.spec,\n          unit: val.unit,\n          key: val.id,\n          gateway: val.gateway === 'BUY' ? '外购' : '自制',\n          dosage: 1,\n          editable: true\n        }\n        const dataSource = target.dataSource.filter(\n          item => item.key !== newVal.key\n        )\n        target.dataSource = [...dataSource, newVal]\n        this.data = [...newData]\n        // console.log(this.data)\n        this.$emit('bomData', this.data)\n      }\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer(val) {\n      this.childrenDrawer = val\n    }\n  },\n  watch: {\n    materialsGroupInfoData: {\n      handler(val) {\n        if (val.length) {\n          // console.log(val)\n          val.forEach(item => {\n            const { count, data, isModalActive } = this\n            const newData = {\n              ...item,\n              key: count,\n              inputVal: item.groupName,\n              inputShow: true,\n              bomType: item.bomType,\n              defaultMaterials: item.defaultMaterials,\n              id: item.id,\n              dataSource: item.skuMaterials.map(cItem => {\n                return {\n                  id: cItem.id,\n                  key: cItem.materialId,\n                  code: cItem.materialInfo.code,\n                  name: cItem.materialInfo.name,\n                  spec: cItem.materialInfo.spec,\n                  unit: cItem.materialInfo.unit,\n                  dosage: cItem.cost,\n                  editable: false,\n                  gateway:\n                    cItem.materialInfo && cItem.materialInfo.gateway === 'SELF'\n                      ? '自制'\n                      : '外购'\n                }\n              })\n            }\n            this.data = [...data, newData]\n            this.count = count + 1\n            console.log(this.data)\n          })\n          this.$emit('bomData', this.data)\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    BomDrawer\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.bom-info {\n  .activeNo {\n    border: 1px solid #d9d9d9;\n  }\n  .activeOk {\n    border: 1px solid #69b412;\n  }\n  .bom-table {\n    // border: 1px solid #69b412;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 5px;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .bom-icon-checked {\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: 0;\n      height: 30px;\n      width: 30px;\n      border-left: 30px solid transparent;\n      border-top: 30px solid #69b412;\n      .icon-right {\n        color: #fff;\n        position: absolute;\n        right: 2px;\n        top: -28px;\n        z-index: 10;\n      }\n    }\n    .bom-icon-default {\n      position: absolute;\n      top: 8px;\n      right: 40px;\n      button {\n        font-size: 12px;\n      }\n    }\n    .bom-input {\n      margin-bottom: 10px;\n      .bom-title {\n        display: inline-block;\n        margin: 0 5px;\n      }\n    }\n    .editable-row-operations a {\n      margin-right: 8px;\n    }\n  }\n}\n.bom-modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 100px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  .modalActive {\n    border: 1px solid #1890ff;\n  }\n}\n</style>\n"],"sourceRoot":"src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info"}]}