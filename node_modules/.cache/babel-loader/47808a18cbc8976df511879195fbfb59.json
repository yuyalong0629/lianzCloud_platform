{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/AddressForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/AddressForm.vue","mtime":1564040157658},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Object$assign from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/core-js/object/assign\";\nimport _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.function.name\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { columnAddress } from '../basic_lib/column';\nimport { areas } from 'utils/area.js';\nimport { findParentId } from '@/assets/utils/utils.js';\nexport default {\n  name: 'AddressForm',\n  data: function data() {\n    return {\n      data: [],\n      columnAddress: columnAddress,\n      count: 0,\n      cacheData: [],\n      options: areas,\n      addressId: [],\n      // 暂存\n      staging: []\n    };\n  },\n  props: {\n    addressInfo: {\n      type: Array,\n      default: []\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  methods: {\n    handleChangeArea: function handleChangeArea(value, selectedOptions, record, column) {\n      var newData = _toConsumableArray(this.data);\n\n      var addressName = selectedOptions ? selectedOptions.map(function (item) {\n        return item.name;\n      }) : [];\n      console.log(addressName);\n      var target = newData.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n\n      if (target) {\n        target[column] = addressName;\n        this.data = newData;\n        console.log(this.data);\n        this.staging[record.key] = selectedOptions ? selectedOptions.map(function (item) {\n          return item.id;\n        }) : [];\n        console.log(this.staging);\n        console.log(record.key);\n      }\n    },\n    handleChangeSwitch: function handleChangeSwitch(value, record, column) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.map(function (item) {\n        return _objectSpread({}, item, {\n          defaultGoodsAddr: item.key === record.key ? value : false\n        });\n      });\n      this.data = _toConsumableArray(target); // console.log(this.data)\n    },\n    handleChange: function handleChange(value, key, column) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target[column] = value;\n        this.data = newData;\n      }\n    },\n    handleAdd: function handleAdd() {\n      var count = this.count,\n          data = this.data; // this.staging[count] = []\n\n      console.log(this.staging);\n      var newData = {\n        key: count,\n        receiver: '',\n        phone: '',\n        address: [],\n        detailAddr: '',\n        deleted: false,\n        defaultGoodsAddr: false,\n        postCode: '',\n        editable: true\n      };\n      this.data = [].concat(_toConsumableArray(data), [newData]);\n      this.count = count + 1; // 保存初始化Obj\n      // this.cacheData = this.data.map(item => ({ ...item }))\n\n      console.log(this.data);\n    },\n    onDelete: function onDelete(key) {\n      var _this = this;\n\n      var newData = _toConsumableArray(this.data);\n\n      this.data = newData.filter(function (item) {\n        return item.key !== key;\n      });\n      var customerAddrList = [];\n      this.data.slice(0).forEach(function (item, index) {\n        customerAddrList[index] = _objectSpread({}, item, {\n          province: _this.staging[index][0],\n          city: _this.staging[index][1],\n          area: _this.staging[index][2]\n        });\n      });\n      console.log(customerAddrList);\n      this.$emit('custAddrList', customerAddrList);\n    },\n    edit: function edit(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n\n      if (target) {\n        target.editable = true;\n        this.addressId = this.staging[key];\n        this.data = newData;\n        console.log(this.data);\n        console.log(this.staging);\n      }\n    },\n    save: function save(key) {\n      var _this2 = this;\n\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0]; // if (target && target.address.length && target.receiver && target.phone) {\n\n      if (target) {\n        target.editable = false;\n        this.data = newData;\n        this.cacheData = newData.map(function (item) {\n          return _objectSpread({}, item);\n        });\n        console.log(this.data); // 阻止引用类型指向同一个堆内存\n\n        var customerAddrList = [];\n        console.log(this.staging);\n        this.data.concat([]).forEach(function (item, index) {\n          // if (item.staging[index].length) {\n          customerAddrList[index] = _objectSpread({}, item, {\n            province: _this2.staging[index] ? _this2.staging[index][0] : '',\n            city: _this2.staging[index] ? _this2.staging[index][1] : '',\n            area: _this2.staging[index] ? _this2.staging[index][2] : '' // }\n\n          });\n        });\n        console.log(customerAddrList);\n        this.$emit('custAddrList', customerAddrList);\n      } else {\n        this.$message.error('请先完善信息');\n      }\n    },\n    cancel: function cancel(key) {\n      var newData = _toConsumableArray(this.data);\n\n      var target = newData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      var targetData = this.cacheData.filter(function (item) {\n        return key === item.key;\n      })[0];\n      console.log(targetData);\n\n      if (target && target.address.length && target.receiver && target.phone && targetData) {\n        _Object$assign(target, this.cacheData.filter(function (item) {\n          return key === item.key;\n        })[0]);\n\n        target.editable = false;\n        this.data = newData;\n      } else {\n        this.data = newData.filter(function (item) {\n          return item.key !== key;\n        });\n      }\n    }\n  },\n  watch: {\n    addressInfo: {\n      handler: function handler(val) {\n        var _this3 = this;\n\n        if (val.length) {\n          console.log(val);\n          val.forEach(function (item, index) {\n            _this3.staging[index] = findParentId(item.area ? item.area : item.city ? item.city : item.province, _this3.options, 'id') || [];\n            console.log(_this3.staging);\n            _this3.data[index] = {\n              key: index,\n              receiver: item.receiver || '无',\n              phone: item.phone || '无',\n              address: findParentId(item.area ? item.area : item.city ? item.city : item.province, _this3.options, 'name') || undefined,\n              detailAddr: item.detailAddr || '无',\n              defaultGoodsAddr: item.defaultGoodsAddr,\n              postCode: item.postCode || '无',\n              id: item.id,\n              custId: item.custId,\n              deleted: false,\n              editable: false\n            };\n            _this3.count = index + 1;\n          });\n          console.log(this.data); // 保存初始化Obj\n\n          this.cacheData = this.data.map(function (item) {\n            return _objectSpread({}, item);\n          });\n          console.log(this.cacheData); // 阻止引用类型指向同一个堆内存\n\n          var customerAddrList = [];\n          this.data.concat([]).forEach(function (item, index) {\n            if (item.address) {\n              customerAddrList[index] = _objectSpread({}, item);\n            }\n          }); // console.log(customerAddrList)\n\n          this.$emit('custAddrList', customerAddrList);\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getAddress: function getAddress() {\n      return findParentId(this.custFormInfo.custArea, this.options, 'name');\n    }\n  }\n};",{"version":3,"sources":["AddressForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"address-form\">\n    <a-table :columns=\"columnAddress\" :dataSource=\"data\" :pagination=\"false\" :scroll=\"{ x: 1240 }\">\n      <template\n        v-for=\"col in ['receiver', 'phone', 'address', 'detailAddr', 'defaultGoodsAddr', 'postCode']\"\n        :slot=\"col\"\n        slot-scope=\"text, record, index\"\n      >\n        <div :key=\"col\">\n          <a-input\n            v-if=\"record.editable && col !== 'address' && col !== 'defaultGoodsAddr'\"\n            style=\"margin: -5px 0\"\n            :value=\"text\"\n            @change=\"e => handleChange(e.target.value, record.key, col)\"\n          />\n          <a-cascader\n            v-if=\"record.editable && col === 'address'\"\n            :defaultValue=\"staging[record.key]\"\n            changeOnSelect\n            placeholder=\"请选择地址\"\n            @change=\"(value, selectedOptions) => handleChangeArea(value, selectedOptions, record, col)\"\n            style=\"width: 200px;\"\n            :fieldNames=\"{ label: 'name', value: 'id', children: 'childrens' }\"\n            :options=\"options\"\n          ></a-cascader>\n          <a-switch\n            v-if=\"record.editable && col === 'defaultGoodsAddr'\"\n            checkedChildren=\"是\"\n            unCheckedChildren=\"否\"\n            :checked=\"record.defaultGoodsAddr\"\n            @change=\"(value) => handleChangeSwitch(value, record, col)\"\n          />\n          <template>\n            <span\n              v-if=\"!record.editable && col !== 'address' && col !== 'defaultGoodsAddr'\"\n            >{{ text }}</span>\n            <span v-if=\"!record.editable && col === 'address'\">{{ text ? text.join('/') : '' }}</span>\n            <span\n              v-if=\"!record.editable && col === 'defaultGoodsAddr'\"\n            >{{ text === true ? '是' : '否' }}</span>\n          </template>\n        </div>\n      </template>\n      <template v-if=\"childDisabled\" slot=\"operation\" slot-scope=\"text, record, index\">\n        <div class=\"editable-row-operations\">\n          <span v-if=\"record.editable\">\n            <a @click=\"() => save(record.key)\">保存</a>\n            <!-- <a @click=\"() => cancel(record.key)\">取消</a> -->\n          </span>\n          <span v-else>\n            <a @click=\"() => edit(record.key)\">编辑</a>\n            <a-popconfirm title=\"确定删除吗?\" @confirm=\"() => onDelete(record.key)\">\n              <a>删除</a>\n            </a-popconfirm>\n          </span>\n        </div>\n      </template>\n    </a-table>\n    <a-button\n      style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n      v-if=\"childDisabled\"\n      type=\"dashed\"\n      icon=\"plus\"\n      @click.stop=\"handleAdd\"\n    >添加联系人</a-button>\n  </div>\n</template>\n<script>\nimport { columnAddress } from '../basic_lib/column'\nimport { areas } from 'utils/area.js'\nimport { findParentId } from '@/assets/utils/utils.js'\n\nexport default {\n  name: 'AddressForm',\n  data() {\n    return {\n      data: [],\n      columnAddress,\n      count: 0,\n      cacheData: [],\n      options: areas,\n      addressId: [],\n      // 暂存\n      staging: []\n    }\n  },\n  props: {\n    addressInfo: {\n      type: Array,\n      default: []\n    },\n    childDisabled: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  methods: {\n    handleChangeArea(value, selectedOptions, record, column) {\n      const newData = [...this.data]\n      const addressName = selectedOptions\n        ? selectedOptions.map(item => item.name)\n        : []\n      console.log(addressName)\n      const target = newData.filter(item => record.key === item.key)[0]\n      if (target) {\n        target[column] = addressName\n        this.data = newData\n        console.log(this.data)\n        this.staging[record.key] = selectedOptions\n          ? selectedOptions.map(item => item.id)\n          : []\n        console.log(this.staging)\n        console.log(record.key)\n      }\n    },\n    handleChangeSwitch(value, record, column) {\n      const newData = [...this.data]\n      const target = newData.map(item => {\n        return {\n          ...item,\n          defaultGoodsAddr: item.key === record.key ? value : false\n        }\n      })\n      this.data = [...target]\n      // console.log(this.data)\n    },\n    handleChange(value, key, column) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target[column] = value\n        this.data = newData\n      }\n    },\n    handleAdd() {\n      const { count, data } = this\n      // this.staging[count] = []\n      console.log(this.staging)\n      const newData = {\n        key: count,\n        receiver: '',\n        phone: '',\n        address: [],\n        detailAddr: '',\n        deleted: false,\n        defaultGoodsAddr: false,\n        postCode: '',\n        editable: true\n      }\n      this.data = [...data, newData]\n      this.count = count + 1\n      // 保存初始化Obj\n      // this.cacheData = this.data.map(item => ({ ...item }))\n      console.log(this.data)\n    },\n    onDelete(key) {\n      const newData = [...this.data]\n      this.data = newData.filter(item => item.key !== key)\n      const customerAddrList = []\n      this.data.slice(0).forEach((item, index) => {\n        customerAddrList[index] = {\n          ...item,\n          province: this.staging[index][0],\n          city: this.staging[index][1],\n          area: this.staging[index][2]\n        }\n      })\n      console.log(customerAddrList)\n      this.$emit('custAddrList', customerAddrList)\n    },\n    edit(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.addressId = this.staging[key]\n        this.data = newData\n        console.log(this.data)\n        console.log(this.staging)\n      }\n    },\n    save(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      // if (target && target.address.length && target.receiver && target.phone) {\n      if (target) {\n        target.editable = false\n        this.data = newData\n        this.cacheData = newData.map(item => ({ ...item }))\n        console.log(this.data)\n        // 阻止引用类型指向同一个堆内存\n        const customerAddrList = []\n        console.log(this.staging)\n        this.data.concat([]).forEach((item, index) => {\n          // if (item.staging[index].length) {\n          customerAddrList[index] = {\n            ...item,\n            province: this.staging[index] ? this.staging[index][0] : '',\n            city: this.staging[index] ? this.staging[index][1] : '',\n            area: this.staging[index] ? this.staging[index][2] : ''\n          }\n          // }\n        })\n        console.log(customerAddrList)\n        this.$emit('custAddrList', customerAddrList)\n      } else {\n        this.$message.error('请先完善信息')\n      }\n    },\n    cancel(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = this.cacheData.filter(item => key === item.key)[0]\n      console.log(targetData)\n      if (\n        target &&\n        target.address.length &&\n        target.receiver &&\n        target.phone &&\n        targetData\n      ) {\n        Object.assign(\n          target,\n          this.cacheData.filter(item => key === item.key)[0]\n        )\n        target.editable = false\n        this.data = newData\n      } else {\n        this.data = newData.filter(item => item.key !== key)\n      }\n    }\n  },\n  watch: {\n    addressInfo: {\n      handler(val) {\n        if (val.length) {\n          console.log(val)\n          val.forEach((item, index) => {\n            this.staging[index] =\n              findParentId(\n                item.area ? item.area : item.city ? item.city : item.province,\n                this.options,\n                'id'\n              ) || []\n            console.log(this.staging)\n            this.data[index] = {\n              key: index,\n              receiver: item.receiver || '无',\n              phone: item.phone || '无',\n              address:\n                findParentId(\n                  item.area ? item.area : item.city ? item.city : item.province,\n                  this.options,\n                  'name'\n                ) || undefined,\n              detailAddr: item.detailAddr || '无',\n              defaultGoodsAddr: item.defaultGoodsAddr,\n              postCode: item.postCode || '无',\n              id: item.id,\n              custId: item.custId,\n              deleted: false,\n              editable: false\n            }\n            this.count = index + 1\n          })\n          console.log(this.data)\n          // 保存初始化Obj\n          this.cacheData = this.data.map(item => ({ ...item }))\n          console.log(this.cacheData)\n          // 阻止引用类型指向同一个堆内存\n          const customerAddrList = []\n          this.data.concat([]).forEach((item, index) => {\n            if (item.address) {\n              customerAddrList[index] = {\n                ...item\n              }\n            }\n          })\n          // console.log(customerAddrList)\n          this.$emit('custAddrList', customerAddrList)\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getAddress() {\n      return findParentId(this.custFormInfo.custArea, this.options, 'name')\n    }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.editable-row-operations a {\n  margin-right: 8px;\n}\n</style>\n"],"sourceRoot":"src/views/cust/child_info"}]}