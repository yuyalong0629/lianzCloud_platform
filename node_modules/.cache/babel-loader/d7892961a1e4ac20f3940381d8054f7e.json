{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bomInfo/BomInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bomInfo/BomInfo.vue","mtime":1561378146495},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { bomColumns } from '@/views/product/pdm/goods/basic_lib/column';\nimport BomDrawer from './drawer/BomDrawer';\nexport default {\n  name: 'BomInfo',\n  data: function data() {\n    return {\n      childrenDrawer: false,\n      listData: [],\n      activeIndex: 0,\n      count: 1,\n      bomColumns: bomColumns,\n      keepKey: 0,\n      modal: false,\n      isModalActive: 0\n    };\n  },\n  props: {\n    materialsGroupInfoData: {\n      type: Array,\n      default: []\n    }\n  },\n  methods: {\n    // 关闭抽屉\n    onChildrenDrawerClose: function onChildrenDrawerClose() {\n      this.childrenDrawer = false;\n    },\n    // 子组件$emit关闭抽屉\n    isChildrenDrawer: function isChildrenDrawer(val) {\n      this.childrenDrawer = val;\n    },\n    // PUSH\n    onClickAddList: function onClickAddList() {\n      this.modal = true;\n    },\n    // 选中BOM\n    onClickModal: function onClickModal(key) {\n      console.log(key);\n      this.isModalActive = key;\n    },\n    handleOk: function () {\n      var _handleOk = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(e) {\n        var count;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return false;\n\n              case 2:\n                this.modal = _context.sent;\n                count = this.count;\n                this.listData.push({\n                  id: count,\n                  select: true,\n                  inputShow: true,\n                  defaultCraft: false,\n                  isModalActive: this.isModalActive,\n                  inputVal: \"\\u65B9\\u6848\".concat(this.num),\n                  dataSource: []\n                });\n                this.count = count + 1;\n                this.listData[0].defaultCraft = true;\n                this.$emit('tabData', this.listData);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function handleOk(_x) {\n        return _handleOk.apply(this, arguments);\n      }\n\n      return handleOk;\n    }(),\n    handleCancel: function handleCancel(e) {\n      this.modal = false;\n    },\n    // Emit接受值\n    bomInfo: function bomInfo(val) {\n      var _this = this;\n\n      console.log(val);\n\n      if (this.listData[val.key].dataSource.length !== 0) {\n        var BOOL = true;\n        this.listData[val.key].dataSource.forEach(function (item) {\n          if (item.key === val.bomInfo.id) {\n            _this.$message.error('请勿重复添加');\n\n            BOOL = false;\n            return;\n          }\n        });\n\n        if (BOOL) {\n          this.listData[val.key].dataSource.push({\n            key: val.bomInfo.id,\n            index: val.key,\n            code: val.bomInfo.code,\n            name: val.bomInfo.name,\n            specification: val.bomInfo.spec,\n            unit: val.bomInfo.unit,\n            dosage: '1',\n            gateway: val.bomInfo.gateway\n          });\n        }\n\n        console.log(this.listData);\n        this.$emit('tabData', this.listData);\n        return;\n      }\n\n      this.listData[val.key].dataSource.push({\n        key: val.bomInfo.id,\n        index: val.key,\n        code: val.bomInfo.code,\n        name: val.bomInfo.name,\n        spec: val.bomInfo.spec,\n        unit: val.bomInfo.unit,\n        dosage: '1',\n        way: val.bomInfo.gateway\n      });\n      console.log(this.listData);\n      this.$emit('tabData', this.listData);\n    },\n    // Select\n    selectList: function selectList(key) {\n      console.log(key); // this.listData[key].select = !this.listData[key].select\n      // this.listData[key].right = !this.listData[key].right\n\n      console.log(this.listData[key].select);\n\n      if (this.listData[key].select) {\n        console.log(this.listData);\n      }\n    },\n    // default\n    onClickDefault: function onClickDefault(key) {\n      console.log(key);\n\n      if (this.activeIndex === key) {\n        this.activeIndex = -1;\n      } else {\n        this.activeIndex = key;\n      }\n\n      this.listData.forEach(function (item) {\n        item.defaultCraft = false;\n      });\n      this.listData[key].defaultCraft = true;\n      this.$emit('tabData', this.listData);\n    },\n    // remove\n    onClickDelete: function onClickDelete(key) {\n      this.listData.splice(key, 1);\n      this.$emit('tabData', this.listData);\n    },\n    // Input框change事件\n    handleChange: function handleChange(value, record, column) {\n      console.log(value);\n      var reg = /^[0-9]*$/;\n\n      if (reg.test(value)) {\n        var newData = _toConsumableArray(this.listData[record.index].dataSource);\n\n        console.log(newData);\n        var target = newData.filter(function (item) {\n          return record.key === item.key;\n        })[0];\n        console.log(target);\n\n        if (target) {\n          target[column] = value; // this.listData[record.index].dataSource = newData\n        }\n      } else {\n        this.$message.error('请输入数字');\n      }\n    },\n    edit: function edit(record) {\n      var newData = _toConsumableArray(this.listData[record.index].dataSource);\n\n      var target = newData.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n      console.log(target);\n\n      if (target) {\n        target.editable = false;\n        this.listData[record.index].dataSource = newData;\n      }\n    },\n    save: function save(record) {\n      var newData = _toConsumableArray(this.listData[record.index].dataSource);\n\n      var target = newData.filter(function (item) {\n        return record.key === item.key;\n      })[0];\n\n      if (target) {\n        delete target.editable;\n        target.editable = true;\n        this.listData[record.index].dataSource = newData; // this.cacheData = newData.map(item => ({ ...item }))\n        // console.log(this.listData)\n\n        this.$emit('tabData', this.listData);\n      }\n    },\n    onDelete: function onDelete(record) {\n      var newData = _toConsumableArray(this.listData[record.index].dataSource);\n\n      this.listData[record.index].dataSource = newData.filter(function (item) {\n        return item.key !== record.key;\n      });\n      this.$emit('tabData', this.listData);\n    },\n    // Input\n    onClickInput: function onClickInput(key) {\n      this.listData[key].inputShow = false;\n    },\n    onClickSave: function onClickSave(key) {\n      this.listData[key].inputShow = true;\n      console.log(this.listData[key].inputVal);\n      this.$emit('tabData', this.listData);\n    },\n    // cancel(record) {\n    //   const newData = [...this.listData[record.index].dataSource]\n    //   const target = newData.filter(item => record.key === item.key)[0]\n    //   console.log(target)\n    //   if (target) {\n    //     Object.assign(\n    //       target,\n    //       this.listData[record.index].dataSource.filter(\n    //         item => record.key === item.key\n    //       )[0]\n    //     )\n    //     delete target.editable\n    //     target.editable = true\n    //     this.listData[record.index].dataSource = newData\n    //   }\n    // },\n    // 弹出抽屉\n    handleAdd: function handleAdd(key) {\n      this.keepKey = key;\n      this.childrenDrawer = true;\n    }\n  },\n  watch: {\n    materialsGroupInfoData: {\n      handler: function handler(val) {\n        var _this2 = this;\n\n        if (val.length) {\n          console.log(val);\n          var count = this.count;\n          val.forEach(function (item, index) {\n            _this2.listData.push({\n              id: index + 1,\n              select: true,\n              inputShow: true,\n              defaultCraft: item.defaultMaterials,\n              isModalActive: _this2.isModalActive,\n              inputVal: item.groupName,\n              dataSource: []\n            });\n\n            _this2.count = index + 2;\n            item.skuMaterials.forEach(function (cItem, cIndex) {\n              _this2.listData[index].dataSource.push(_objectSpread({\n                key: cItem.materialInfo.catId\n              }, cItem.materialInfo, {\n                dosage: cItem.cost,\n                gateway: cItem.gateway === 'SELF' ? '自制' : '外购'\n              }));\n            });\n          });\n          this.$emit('tabData', this.listData);\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'bom-drawer': BomDrawer\n  }\n};",{"version":3,"sources":["BomInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"craft-info\">\n    <div class=\"list-wrapper\" v-for=\"(item, key) in listData\" :key=\"key\">\n      <div\n        class=\"content\"\n        :class=\"{selectList: listData[key].select}\"\n        @click.stop=\"selectList(key)\"\n      >\n        <div class=\"icon-input\">\n          <h3 v-if=\"listData[key].inputShow\" class=\"title\">{{ listData[key].inputVal }}</h3>\n          <a-icon v-if=\"listData[key].inputShow\" type=\"form\" @click.stop=\"onClickInput(key)\"/>\n          <a-input\n            v-if=\"!listData[key].inputShow\"\n            v-model=\"listData[key].inputVal\"\n            size=\"small\"\n            placeholder=\"请输入\"\n            style=\"width: 160px; margin-right: 5px;\"\n          />\n          <a-icon v-if=\"!listData[key].inputShow\" type=\"file-add\" @click.stop=\"onClickSave(key)\"/>\n        </div>\n        <a-table :columns=\"bomColumns\" :dataSource=\"listData[key].dataSource\" :pagination=\"false\">\n          <template v-for=\"col in ['dosage']\" :slot=\"col\" slot-scope=\"text, record, index\">\n            <div :key=\"col\">\n              <a-input\n                v-if=\"!record.editable\"\n                style=\"margin: -5px 0\"\n                :value=\"text\"\n                @change=\"e => handleChange(e.target.value, record, col)\"\n              />\n              <template v-else>{{text}}</template>\n            </div>\n          </template>\n          <template slot=\"operation\" slot-scope=\"text, record, index\">\n            <div class=\"editable-row-operations\">\n              <span v-if=\"record.editable\">\n                <a @click.stop=\"() => edit(record)\">编辑</a>\n                <a-popconfirm title=\"确定要删除吗?\" @confirm=\"() => onDelete(record)\">\n                  <a>删除</a>\n                </a-popconfirm>\n              </span>\n              <span v-else=\"!record.editable\">\n                <a @click.stop=\"() => save(record)\">保存</a>\n                <!-- <a @click.stop=\"() => cancel(record)\">取消</a> -->\n              </span>\n            </div>\n          </template>\n        </a-table>\n        <a-button\n          style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n          type=\"dashed\"\n          icon=\"plus\"\n          @click.stop=\"handleAdd(key)\"\n        >添加编码</a-button>\n      </div>\n      <div class=\"icon-default\">\n        <a-button\n          size=\"small\"\n          v-if=\"activeIndex !== key\"\n          @click.stop=\"onClickDefault(key)\"\n          style=\"margin-right: 5px;\"\n        >设为默认</a-button>\n        <a-button size=\"small\" type=\"danger\" @click.stop=\"onClickDelete(key)\">删除</a-button>\n      </div>\n      <div class=\"icon-box\">\n        <div class=\"icon-select\" v-if=\"activeIndex === key\">\n          <a-icon class=\"icon-right\" type=\"check\"/>\n        </div>\n      </div>\n    </div>\n    <a-button\n      style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n      type=\"dashed\"\n      icon=\"plus\"\n      @click=\"onClickAddList\"\n    >添加方案</a-button>\n    <a-modal title=\"选择BOM\" :visible=\"modal\" @ok=\"handleOk\" @cancel=\"handleCancel\">\n      <ul class=\"modal-list\">\n        <li\n          :class=\"{modalActive: isModalActive === 0 ? true : false}\"\n          @click=\"onClickModal(0)\"\n        >工艺BOM</li>\n        <li\n          :class=\"{modalActive: isModalActive === 1 ? true : false}\"\n          @click=\"onClickModal(1)\"\n        >制造BOM</li>\n      </ul>\n    </a-modal>\n    <a-drawer\n      :destroyOnClose=\"true\"\n      :title=\"false\"\n      width=\"300\"\n      :closable=\"false\"\n      @close=\"onChildrenDrawerClose\"\n      :visible=\"childrenDrawer\"\n    >\n      <bom-drawer @isChildrenDrawer=\"isChildrenDrawer\" @bomInfo=\"bomInfo\" :keepKey=\"keepKey\"/>\n    </a-drawer>\n  </div>\n</template>\n<script>\nimport { bomColumns } from '@/views/product/pdm/goods/basic_lib/column'\nimport BomDrawer from './drawer/BomDrawer'\n\nexport default {\n  name: 'BomInfo',\n  data() {\n    return {\n      childrenDrawer: false,\n      listData: [],\n      activeIndex: 0,\n      count: 1,\n      bomColumns,\n      keepKey: 0,\n      modal: false,\n      isModalActive: 0\n    }\n  },\n  props: {\n    materialsGroupInfoData: {\n      type: Array,\n      default: []\n    }\n  },\n  methods: {\n    // 关闭抽屉\n    onChildrenDrawerClose() {\n      this.childrenDrawer = false\n    },\n    // 子组件$emit关闭抽屉\n    isChildrenDrawer(val) {\n      this.childrenDrawer = val\n    },\n    // PUSH\n    onClickAddList() {\n      this.modal = true\n    },\n    // 选中BOM\n    onClickModal(key) {\n      console.log(key)\n      this.isModalActive = key\n    },\n    async handleOk(e) {\n      this.modal = await false\n      const { count } = this\n      this.listData.push({\n        id: count,\n        select: true,\n        inputShow: true,\n        defaultCraft: false,\n        isModalActive: this.isModalActive,\n        inputVal: `方案${this.num}`,\n        dataSource: []\n      })\n      this.count = count + 1\n      this.listData[0].defaultCraft = true\n      this.$emit('tabData', this.listData)\n    },\n    handleCancel(e) {\n      this.modal = false\n    },\n    // Emit接受值\n    bomInfo(val) {\n      console.log(val)\n      if (this.listData[val.key].dataSource.length !== 0) {\n        let BOOL = true\n        this.listData[val.key].dataSource.forEach(item => {\n          if (item.key === val.bomInfo.id) {\n            this.$message.error('请勿重复添加')\n            BOOL = false\n            return\n          }\n        })\n        if (BOOL) {\n          this.listData[val.key].dataSource.push({\n            key: val.bomInfo.id,\n            index: val.key,\n            code: val.bomInfo.code,\n            name: val.bomInfo.name,\n            specification: val.bomInfo.spec,\n            unit: val.bomInfo.unit,\n            dosage: '1',\n            gateway: val.bomInfo.gateway\n          })\n        }\n        console.log(this.listData)\n        this.$emit('tabData', this.listData)\n        return\n      }\n      this.listData[val.key].dataSource.push({\n        key: val.bomInfo.id,\n        index: val.key,\n        code: val.bomInfo.code,\n        name: val.bomInfo.name,\n        spec: val.bomInfo.spec,\n        unit: val.bomInfo.unit,\n        dosage: '1',\n        way: val.bomInfo.gateway\n      })\n      console.log(this.listData)\n      this.$emit('tabData', this.listData)\n    },\n    // Select\n    selectList(key) {\n      console.log(key)\n      // this.listData[key].select = !this.listData[key].select\n      // this.listData[key].right = !this.listData[key].right\n      console.log(this.listData[key].select)\n      if (this.listData[key].select) {\n        console.log(this.listData)\n      }\n    },\n    // default\n    onClickDefault(key) {\n      console.log(key)\n      if (this.activeIndex === key) {\n        this.activeIndex = -1\n      } else {\n        this.activeIndex = key\n      }\n      this.listData.forEach(item => {\n        item.defaultCraft = false\n      })\n      this.listData[key].defaultCraft = true\n      this.$emit('tabData', this.listData)\n    },\n    // remove\n    onClickDelete(key) {\n      this.listData.splice(key, 1)\n      this.$emit('tabData', this.listData)\n    },\n    // Input框change事件\n    handleChange(value, record, column) {\n      console.log(value)\n      const reg = /^[0-9]*$/\n      if (reg.test(value)) {\n        const newData = [...this.listData[record.index].dataSource]\n        console.log(newData)\n        const target = newData.filter(item => record.key === item.key)[0]\n        console.log(target)\n        if (target) {\n          target[column] = value\n          // this.listData[record.index].dataSource = newData\n        }\n      } else {\n        this.$message.error('请输入数字')\n      }\n    },\n    edit(record) {\n      const newData = [...this.listData[record.index].dataSource]\n      const target = newData.filter(item => record.key === item.key)[0]\n      console.log(target)\n      if (target) {\n        target.editable = false\n        this.listData[record.index].dataSource = newData\n      }\n    },\n    save(record) {\n      const newData = [...this.listData[record.index].dataSource]\n      const target = newData.filter(item => record.key === item.key)[0]\n      if (target) {\n        delete target.editable\n        target.editable = true\n        this.listData[record.index].dataSource = newData\n        // this.cacheData = newData.map(item => ({ ...item }))\n        // console.log(this.listData)\n        this.$emit('tabData', this.listData)\n      }\n    },\n    onDelete(record) {\n      const newData = [...this.listData[record.index].dataSource]\n      this.listData[record.index].dataSource = newData.filter(\n        item => item.key !== record.key\n      )\n      this.$emit('tabData', this.listData)\n    },\n    // Input\n    onClickInput(key) {\n      this.listData[key].inputShow = false\n    },\n    onClickSave(key) {\n      this.listData[key].inputShow = true\n      console.log(this.listData[key].inputVal)\n      this.$emit('tabData', this.listData)\n    },\n    // cancel(record) {\n    //   const newData = [...this.listData[record.index].dataSource]\n    //   const target = newData.filter(item => record.key === item.key)[0]\n    //   console.log(target)\n    //   if (target) {\n    //     Object.assign(\n    //       target,\n    //       this.listData[record.index].dataSource.filter(\n    //         item => record.key === item.key\n    //       )[0]\n    //     )\n    //     delete target.editable\n    //     target.editable = true\n    //     this.listData[record.index].dataSource = newData\n    //   }\n    // },\n    // 弹出抽屉\n    handleAdd(key) {\n      this.keepKey = key\n      this.childrenDrawer = true\n    }\n  },\n  watch: {\n    materialsGroupInfoData: {\n      handler(val) {\n        if (val.length) {\n          console.log(val)\n          const { count } = this\n          val.forEach((item, index) => {\n            this.listData.push({\n              id: index + 1,\n              select: true,\n              inputShow: true,\n              defaultCraft: item.defaultMaterials,\n              isModalActive: this.isModalActive,\n              inputVal: item.groupName,\n              dataSource: []\n            })\n            this.count = index + 2\n            item.skuMaterials.forEach((cItem, cIndex) => {\n              this.listData[index].dataSource.push({\n                key: cItem.materialInfo.catId,\n                ...cItem.materialInfo,\n                dosage: cItem.cost,\n                gateway: cItem.gateway === 'SELF' ? '自制' : '外购'\n              })\n            })\n          })\n          this.$emit('tabData', this.listData)\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'bom-drawer': BomDrawer\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.craft-info {\n  .title {\n    height: 35px;\n    line-height: 35px;\n    padding: 0 15px;\n    display: inline-block;\n  }\n  .list-wrapper {\n    margin: 10px 0;\n    // min-height: 100px;\n    box-sizing: border-box;\n    border: 1px solid #d9d9d9;\n    border-radius: 4px;\n    position: relative;\n    .selectList {\n      border: 1px solid #69b412;\n    }\n    .content {\n      width: 100%;\n      border-radius: 4px;\n      // min-height: 100px;\n      .icon-input {\n        height: 40px;\n        line-height: 40px;\n        padding: 0 5px;\n      }\n      .editable-row-operations a {\n        margin-right: 8px;\n      }\n    }\n    .icon-default {\n      position: absolute;\n      top: 8px;\n      right: 40px;\n    }\n    .icon-box {\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: 0;\n      height: 40px;\n      width: 40px;\n      .icon-select {\n        border-left: 40px solid transparent;\n        border-top: 40px solid #69b412;\n        position: relative;\n        .icon-right {\n          position: absolute;\n          right: 5px;\n          top: -35px;\n          z-index: 10;\n          color: #fff;\n        }\n      }\n      .icon-delete {\n        border-left: 40px solid transparent;\n        border-top: 40px solid #f00;\n        position: relative;\n        .icon-remove {\n          position: absolute;\n          right: 5px;\n          top: -35px;\n          z-index: 10;\n          color: #fff;\n        }\n      }\n    }\n  }\n}\n.modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 100px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  .modalActive {\n    border: 1px solid #1890ff;\n  }\n}\n</style>\n"],"sourceRoot":"src/views/product/pdm/goods/child_info/tab_goodsInfo/bomInfo"}]}