{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/orderInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/orderInfo.vue","mtime":1564625928916},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Detail from './detail';\nimport Product from './product';\nimport Address from './address';\nimport Upload from './upload';\nimport Dispatch from './dispatch';\nimport api from '@/api/index.js';\nimport Bus from '@/Bus';\nimport { postJson, get, put, deleted } from '@/api/axios.js';\nexport default {\n  props: {\n    editInfo: {\n      type: Boolean\n    },\n    detialList: {\n      type: String\n    },\n    selectAddress: {\n      type: Boolean,\n      default: false\n    },\n    approval: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  components: {\n    Address: Address,\n    Dispatch: Dispatch,\n    Detail: Detail,\n    Product: Product,\n    Upload: Upload\n  },\n  data: function data() {\n    return {\n      mallOrderIntactDto: {\n        oorderNumber: '自动生成',\n        ocustName: '',\n        otype: 'FORMAL',\n        addrId: '',\n        // 地址ID\n        opurchaseOrderno: '',\n        // 客户单号\n        custId: '',\n        // 商城客户id\n        ocustShortName: '',\n        // 客户简称\n        ototalSum: '',\n        // 总金额，订单总计（销售总计）\n        oattachment: '',\n        // 上传附件 1\n        oprePayment: '',\n        // 预收款\n        oremarks: '',\n        // 备注\n        ostatus: ''\n      },\n      dataSource: [],\n      editDetial: false,\n      custId: '',\n      ocustName: '',\n      addrId: '',\n      fileList: [],\n      timer: ''\n    };\n  },\n  methods: {\n    setCustId: function setCustId(val) {\n      this.custId = val.custId;\n      this.ocustName = val.ocustName;\n    },\n    setAddressId: function setAddressId(val) {\n      this.addrId = val;\n    },\n    // 订单提交\n    orderSubmit: function orderSubmit(val) {\n      var _this = this;\n\n      if (this.custId === '') {\n        this.$message.warning('请先选择客户名称', 1);\n        return;\n      }\n\n      var skuList = this.$refs.product.data;\n\n      if (skuList.length === 0) {\n        this.$message.warning('请添加购买商品', 1);\n        return;\n      }\n\n      if (!this.addrId) {\n        this.$confirm({\n          title: '地址确认',\n          content: '没有设置收件地址，确认提交订单吗？',\n          okText: '确定',\n          cancelText: '取消',\n          onOk: function onOk() {\n            _this.submit(val);\n          }\n        });\n      } else {\n        _this.submit(val);\n      }\n    },\n    submit: function submit(val) {\n      var _this = this;\n\n      var oattachment = this.$refs.upload.uploadFile.join(',');\n      var mallOrderIntactDto = this.$refs.detail.mallOrderIntactDto;\n      var skuList = this.$refs.product.data;\n      mallOrderIntactDto.addrId = this.addrId;\n      mallOrderIntactDto.ocustAddrId = this.addrId;\n      mallOrderIntactDto.oattachment = oattachment;\n\n      _this.$emit('subLoading', true);\n\n      if (!val) {\n        // 订单添加\n        mallOrderIntactDto.skuList = skuList;\n        delete mallOrderIntactDto.ostatus;\n        delete mallOrderIntactDto.oorderNumber;\n        postJson(api.orderSave, mallOrderIntactDto).then(function (res) {\n          if (res.data.code === 0) {\n            _this.$message.success('订单添加成功', 1).then(function () {\n              _this.$emit('isVisible', true);\n            });\n          } else {\n            _this.$message.error(res.data.msg, 1);\n\n            _this.$emit('subLoading', false);\n          }\n        }).catch(function () {\n          _this.$message.error('服务出错', 1);\n\n          _this.$emit('subLoading', false);\n        });\n      } else {\n        // 订单修改\n        skuList.forEach(function (item) {\n          delete item.sku;\n        });\n        mallOrderIntactDto.orderDetails = skuList;\n        delete mallOrderIntactDto.skuList;\n        put(api.updateOrder, mallOrderIntactDto).then(function (res) {\n          if (res.data.code === 0) {\n            _this.$message.success('订单修改成功', 1).then(function () {\n              _this.$emit('isVisible', true);\n            });\n          } else {\n            _this.$message.error(res.data.msg, 1);\n\n            _this.$emit('subLoading', false);\n          }\n        }).catch(function () {\n          _this.$message.error('服务出错', 1);\n\n          _this.$emit('subLoading', false);\n        });\n      }\n    },\n    // 获取订单详情\n    getOrderDetail: function getOrderDetail(id) {\n      var _this2 = this;\n\n      get(api.getOrderDetail + \"\".concat(id)).then(function (res) {\n        _this2.mallOrderIntactDto = res.data.data;\n        _this2.custId = res.data.data.custId;\n        _this2.addrId = res.data.data.addrId;\n        _this2.ocustName = res.data.data.ocustName;\n        var skuList = res.data.data.skuList;\n        var oattachment = res.data.data.oattachment;\n\n        for (var i in skuList) {\n          skuList[i].key = i;\n        }\n\n        _this2.dataSource = skuList;\n\n        if (oattachment) {\n          var oattachmentObj = [];\n          var oattachmentList = oattachment.split(',');\n\n          for (var _i in oattachmentList) {\n            var name = oattachmentList[_i].split('/');\n\n            name = name[name.length - 1].split('.');\n            var type = name[1];\n\n            if (type === 'jpeg' || type === 'png' || type === 'svg' || type === 'gif' || type === 'jpg') {\n              type = 'img';\n            }\n\n            oattachmentObj.push({\n              uid: _i,\n              name: name[0],\n              type: type,\n              status: 'done',\n              url: oattachmentList[_i]\n            });\n          }\n\n          _this2.fileList = oattachmentObj;\n        }\n      }).catch(function () {\n        _this2.$message.error('系统错误');\n      });\n    }\n  },\n  created: function created() {\n    var _this3 = this;\n\n    if (this.editInfo) {\n      this.getOrderDetail(this.detialList);\n    }\n\n    Bus.$on('isDisabled', function (val) {\n      _this3.editDetial = !val;\n\n      if (val) {\n        var newData = _toConsumableArray(_this3.dataSource);\n\n        newData.forEach(function (item) {\n          delete item.editable;\n        });\n      }\n    });\n    Bus.$on('isDelete', function (val) {\n      if (!val) {\n        var idStr = _this3.mallOrderIntactDto.id;\n        deleted(api.deletedBatch + \"?idStr=\".concat(idStr)).then(function (res) {\n          if (res.data.code === 0) {\n            _this3.$message.success('删除成功');\n\n            _this3.$emit('isVisible', true);\n          } else {\n            _this3.$message.error(res.data.msg);\n          }\n        });\n      }\n    });\n    Bus.$on('submitOrder', function (val) {\n      _this3.orderSubmit(val);\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    Bus.$off('isDisabled');\n    Bus.$off('isDelete');\n    Bus.$off('submitOrder');\n  }\n};",{"version":3,"sources":["orderInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div class=\"add-order-list\">\n      <a-row>\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">订单详情</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <Detail\n            ref=\"detail\"\n            :mallOrderIntactDto=\"mallOrderIntactDto\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :selectAddress=\"selectAddress\"\n            @setCustId=\"setCustId\"\n          ></Detail>\n        </a-col>\n      </a-row>\n      <!-- <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">订单分配</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <Dispatch></Dispatch>\n        </a-col>\n      </a-row>-->\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">产品详情</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Product\n            ref=\"product\"\n            :custId=\"custId\"\n            :dataSource=\"dataSource\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :approval=\"approval\"\n            :selectAddress=\"selectAddress\"\n          ></Product>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">收货地址</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Address\n            :ocustName=\"ocustName\"\n            :custId=\"custId\"\n            :addrId=\"addrId\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            @setAddressId=\"setAddressId\"\n          ></Address>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">附件</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Upload\n            ref=\"upload\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :file=\"fileList\"\n            :selectAddress=\"selectAddress\"\n          ></Upload>\n        </a-col>\n      </a-row>\n      <!-- <a-row v-if=\"editInfo && !approval\">\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">审批流程</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <a-steps progressDot :current=\"1\">\n            <a-step title=\"Finished\" description=\"This is a description.\"/>\n            <a-step title=\"In Progress\" description=\"This is a description.\"/>\n            <a-step title=\"Waiting\" description=\"This is a description.\"/>\n          </a-steps>\n        </a-col>\n      </a-row>-->\n    </div>\n  </div>\n</template>\n\n<script>\nimport Detail from './detail'\nimport Product from './product'\nimport Address from './address'\nimport Upload from './upload'\nimport Dispatch from './dispatch'\nimport api from '@/api/index.js'\nimport Bus from '@/Bus'\nimport { postJson, get, put, deleted } from '@/api/axios.js'\nexport default {\n  props: {\n    editInfo: {\n      type: Boolean\n    },\n    detialList: {\n      type: String\n    },\n    selectAddress: {\n      type: Boolean,\n      default: false\n    },\n    approval: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  components: {\n    Address,\n    Dispatch,\n    Detail,\n    Product,\n    Upload\n  },\n  data() {\n    return {\n      mallOrderIntactDto: {\n        oorderNumber: '自动生成',\n        ocustName: '',\n        otype: 'FORMAL',\n        addrId: '', // 地址ID\n        opurchaseOrderno: '', // 客户单号\n        custId: '', // 商城客户id\n        ocustShortName: '', // 客户简称\n        ototalSum: '', // 总金额，订单总计（销售总计）\n        oattachment: '', // 上传附件 1\n        oprePayment: '', // 预收款\n        oremarks: '', // 备注\n        ostatus: ''\n      },\n      dataSource: [],\n      editDetial: false,\n      custId: '',\n      ocustName: '',\n      addrId: '',\n      fileList: [],\n      timer: ''\n    }\n  },\n  methods: {\n    setCustId(val) {\n      this.custId = val.custId\n      this.ocustName = val.ocustName\n    },\n    setAddressId(val) {\n      this.addrId = val\n    },\n    // 订单提交\n    orderSubmit(val) {\n      const _this = this\n      if (this.custId === '') {\n        this.$message.warning('请先选择客户名称', 1)\n        return\n      }\n      const skuList = this.$refs.product.data\n      if (skuList.length === 0) {\n        this.$message.warning('请添加购买商品', 1)\n        return\n      }\n      if (!this.addrId) {\n        this.$confirm({\n          title: '地址确认',\n          content: '没有设置收件地址，确认提交订单吗？',\n          okText: '确定',\n          cancelText: '取消',\n          onOk() {\n            _this.submit(val)\n          }\n        })\n      } else {\n        _this.submit(val)\n      }\n    },\n    submit(val) {\n      const _this = this\n      const oattachment = this.$refs.upload.uploadFile.join(',')\n      const mallOrderIntactDto = this.$refs.detail.mallOrderIntactDto\n      const skuList = this.$refs.product.data\n      mallOrderIntactDto.addrId = this.addrId\n      mallOrderIntactDto.ocustAddrId = this.addrId\n      mallOrderIntactDto.oattachment = oattachment\n      _this.$emit('subLoading', true)\n      if (!val) {\n        // 订单添加\n        mallOrderIntactDto.skuList = skuList\n        delete mallOrderIntactDto.ostatus\n        delete mallOrderIntactDto.oorderNumber\n        postJson(api.orderSave, mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            _this.$message.success('订单添加成功', 1).then(() => {\n              _this.$emit('isVisible', true)\n            })\n          } else {\n            _this.$message.error(res.data.msg, 1)\n            _this.$emit('subLoading', false)\n          }\n        }).catch(() => {\n          _this.$message.error('服务出错', 1)\n          _this.$emit('subLoading', false)\n        })\n      } else {\n        // 订单修改\n        skuList.forEach(item => {\n          delete item.sku\n        })\n        mallOrderIntactDto.orderDetails = skuList\n        delete mallOrderIntactDto.skuList\n        put(api.updateOrder, mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            _this.$message.success('订单修改成功', 1).then(() => {\n              _this.$emit('isVisible', true)\n            })\n          } else {\n            _this.$message.error(res.data.msg, 1)\n            _this.$emit('subLoading', false)\n          }\n        }).catch(() => {\n          _this.$message.error('服务出错', 1)\n          _this.$emit('subLoading', false)\n        })\n      }\n    },\n    // 获取订单详情\n    getOrderDetail(id) {\n      get(api.getOrderDetail + `${id}`).then(res => {\n        this.mallOrderIntactDto = res.data.data\n        this.custId = res.data.data.custId\n        this.addrId = res.data.data.addrId\n        this.ocustName = res.data.data.ocustName\n        const skuList = res.data.data.skuList\n        const oattachment = res.data.data.oattachment\n        for (const i in skuList) {\n          skuList[i].key = i\n        }\n        this.dataSource = skuList\n        if (oattachment) {\n          const oattachmentObj = []\n          const oattachmentList = oattachment.split(',')\n          for (const i in oattachmentList) {\n            var name = oattachmentList[i].split('/')\n            name = name[name.length - 1].split('.')\n            var type = name[1]\n            if (type === 'jpeg' || type === 'png' || type === 'svg' || type === 'gif' || type === 'jpg') {\n              type = 'img'\n            }\n            oattachmentObj.push({\n              uid: i,\n              name: name[0],\n              type: type,\n              status: 'done',\n              url: oattachmentList[i]\n            })\n          }\n          this.fileList = oattachmentObj\n        }\n      }).catch(() => {\n        this.$message.error('系统错误')\n      })\n    }\n  },\n  created() {\n    if (this.editInfo) {\n      this.getOrderDetail(this.detialList)\n    }\n    Bus.$on('isDisabled', val => {\n      this.editDetial = !val\n      if (val) {\n        const newData = [...this.dataSource]\n        newData.forEach(item => {\n          delete item.editable\n        })\n      }\n    })\n    Bus.$on('isDelete', val => {\n      if (!val) {\n        const idStr = this.mallOrderIntactDto.id\n        deleted(api.deletedBatch + `?idStr=${idStr}`).then(res => {\n          if (res.data.code === 0) {\n            this.$message.success('删除成功')\n            this.$emit('isVisible', true)\n          } else {\n            this.$message.error(res.data.msg)\n          }\n        })\n      }\n    })\n    Bus.$on('submitOrder', val => {\n      this.orderSubmit(val)\n    })\n  },\n  beforeDestroy() {\n    Bus.$off('isDisabled')\n    Bus.$off('isDelete')\n    Bus.$off('submitOrder')\n  }\n}\n</script>\n\n<style lang='less' scoped>\n@import \"~styles/variable.less\";\n.inputWidth {\n  .inputWidth();\n}\n.mt {\n  margin: 10px 0;\n}\n.addCustomer-title {\n  border-left: 4px solid #1890ff;\n  padding-left: 6px;\n}\n.ant-upload-select-picture-card i {\n  font-size: 32px;\n  color: #999;\n}\n.ant-upload-select-picture-card .ant-upload-text {\n  margin-top: 8px;\n  color: #666;\n}\n</style>\n"],"sourceRoot":"src/views/sale/orderList/child_lib"}]}