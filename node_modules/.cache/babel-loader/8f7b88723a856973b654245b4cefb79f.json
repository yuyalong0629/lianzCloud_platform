{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/factorySale/dispatchOrder/dispatch.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/factorySale/dispatchOrder/dispatch.vue","mtime":1565252860534},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _JSON$stringify from \"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/@babel/runtime-corejs2/core-js/json/stringify\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Bus from '@/Bus.js';\nimport infiniteScroll from 'vue-infinite-scroll';\nimport { postJson, get } from '@/api/axios.js';\nimport api from '@/api/index.js';\nimport moment from 'moment';\nimport dispatchInfo from '@/views/product/pdm/goods/child_info/GoodsInfo';\nimport inputSearch from './other/inputSearch';\nimport { mixinBasic, mixinDrawer } from '@/components/tools/mixin/mixin';\nexport default {\n  directives: {\n    infiniteScroll: infiniteScroll\n  },\n  mixins: [mixinBasic, mixinDrawer],\n  components: {\n    dispatchInfo: dispatchInfo,\n    inputSearch: inputSearch\n  },\n  data: function data() {\n    return {\n      dateFormat: 'YYYY-MM-DD',\n      busy: false,\n      loadingCompony: false,\n      dataCompanySize: 0,\n      dataCompany: [],\n      orderMerge: [],\n      currentPage: 1,\n      pageSize: 15,\n      searchTerm: {},\n      updateList: {\n        num: 0,\n        date: ''\n      },\n      companyList: [],\n      submitLoading: false,\n      goodsViewInfo: {},\n      visibleModal: false,\n      selectIndex: '',\n      isModalActive: 0,\n      channelSkuId: '',\n      disabledUp: false\n    };\n  },\n  computed: {\n    getMenuPermission: function getMenuPermission() {\n      return this.$store.state.menuPermission;\n    }\n  },\n  methods: {\n    moment: moment,\n    // 按条件搜索渠道商订单列表\n    changeInput: function changeInput(val, type) {\n      this.dataCompany = [];\n      this.searchTerm = val;\n      this.currentPage = 1;\n      this.getFactoryOrder();\n    },\n    // 滚动滑动条加载订单\n    handleInfiniteOnLoad: function handleInfiniteOnLoad() {\n      var data = this.dataCompany;\n      this.loadingCompony = true;\n      this.busy = true;\n\n      if (data.length >= this.dataCompanySize && this.dataCompanySize !== 0 || this.disabledUp) {\n        this.busy = true;\n        this.loadingCompony = false;\n      } else {\n        this.getFactoryOrder(this.currentPage);\n        this.busy = false;\n        this.loadingCompony = false;\n      }\n    },\n    // 移除订单\n    removeItem: function removeItem(id, index) {\n      var _this = this;\n\n      this.$confirm({\n        title: '移除订单信息',\n        content: '您确定要移除这条订单消息吗?',\n        zIndex: 99999,\n        onOk: function onOk() {\n          postJson(api.delFactoryPolicyOrder, {\n            id: id\n          }).then(function (res) {\n            if (res.data.code === 0) {\n              _this.$message.success('订单移除成功');\n\n              _this.dataCompany.splice(index, 1);\n\n              _this.dataCompanySize--;\n            } else {\n              _this.$message.error(res.data.msg);\n            }\n          });\n        },\n        onCancel: function onCancel() {}\n      });\n    },\n    addCompany: function addCompany(channelSkuId, index, num, date) {\n      this.dispatchAction(channelSkuId, index, num, date);\n    },\n    addLittle: function addLittle(channelSkuId, index) {\n      var updateList = this.updateList;\n      this.dispatchAction(channelSkuId, index, updateList.num, updateList.date);\n    },\n\n    /**\n    * @description 订单分派\n    * @param channelSkuId 产品SkuID 查询产品详情\n    * @param index 当前点击的索引\n    * @description 先判断是否设置制造工艺和BOM\n    * 一、设置。判断是否已经添加过产品。已经有添加的产品则在进行判断规格、材质、制造工艺、BOM是否一致，一致则添加不一致则警告；如果没有添加过产品则直接将 产品添加过去。\n    * 二、未设置。提示用户先设置制造工艺和BOM，确定设置则直接右侧抽屉展开\n    */\n    dispatchAction: function dispatchAction(channelSkuId, index, num, date) {\n      this.selectIndex = index;\n      this.channelSkuId = channelSkuId;\n      var dataCompany = this.dataCompany;\n      var companyList = this.companyList;\n      var item = dataCompany[index];\n      var target = JSON.parse(_JSON$stringify(item));\n      var tar = companyList.filter(function (itm) {\n        return itm.odRequireDueDate === date;\n      })[0];\n      dataCompany[index].clickedVisible = false;\n\n      if (item.bom === null || item.craft === null) {\n        this.visibleModal = true;\n        this.channelSkuId = channelSkuId;\n        return;\n      }\n\n      if (companyList.length !== 0) {\n        if (item.channelSkuId !== companyList[0].channelSkuId) {\n          this.$message.warning('不同产品不能合并生成工单。', 1);\n          return;\n        }\n\n        if (item.bomGroupId !== companyList[0].bomGroupId && item.craftGroupId !== companyList[0].craftGroupId) {\n          this.$message.warning('不同制造工艺和BOM不能合并生成工单。', 1);\n          return;\n        }\n\n        if (!tar) {\n          this.$message.warning('不同的交期不能合并生成工单', 1);\n          return;\n        }\n\n        var tarList = companyList.filter(function (itm) {\n          return itm.id === item.id;\n        })[0];\n\n        if (!tarList) {\n          target.odRequireDueDate = date;\n          target.number = num;\n          companyList.push(target);\n        } else {\n          tarList.number += num;\n        }\n\n        if (num >= item.number) {\n          dataCompany.splice(index, 1);\n        } else {\n          item.number -= num;\n        }\n      } else {\n        target.odRequireDueDate = date;\n        target.number = num;\n\n        if (num >= item.number) {\n          dataCompany.splice(index, 1);\n        } else {\n          item.number -= num;\n        }\n\n        companyList.push(target);\n      }\n    },\n    uploadBom: function uploadBom(item, index) {\n      this.selectIndex = index;\n      this.dataCompany[index].clickedVisible = false;\n      this.channelSkuId = item.channelSkuId;\n      this.isModalActive = 1;\n      this.onModalOk();\n    },\n    // MOdal\n    onModalOk: function onModalOk() {\n      this.visibleModal = false;\n      this.getViewInfo(this.channelSkuId);\n      this.$store.commit('setPromptTitle', {\n        title: '产品信息',\n        isEdit: true\n      });\n    },\n    onModalNo: function onModalNo() {\n      this.visibleModal = false;\n    },\n    setDispatchInfo: function setDispatchInfo(val) {\n      var _this2 = this;\n\n      var dataCompany = this.dataCompany;\n      var index = this.selectIndex;\n      var data = {\n        id: dataCompany[index].id,\n        bomGroupId: dataCompany[index].bomGroupId,\n        craftGroupId: dataCompany[index].craftGroupId\n      };\n      val.forEach(function (item) {\n        if (item.defaultMaterials) {\n          dataCompany[index].bom = item.groupName;\n          dataCompany[index].bomGroupId = item.id;\n          data.bomGroupId = item.id;\n        }\n\n        if (item.defaultCraft) {\n          dataCompany[index].craft = item.inputVal;\n          dataCompany[index].craftGroupId = item.id;\n          data.craftGroupId = item.id;\n        }\n      });\n      data.id = dataCompany[index].id;\n      postJson(api.updateBomCraft, data).then(function (res) {\n        if (res.data.code === 0) {\n          _this2.visible = false;\n        } else {\n          _this2.$message.error(res.data.msg);\n        }\n      });\n    },\n    // Modal Tabs\n    onModalInfo: function onModalInfo(key) {\n      this.isModalActive = key;\n    },\n    // 删除工厂中的订单\n    minusCompany: function minusCompany(index) {\n      if (index >= 0) {\n        var companyList = this.companyList;\n        var dataCompany = this.dataCompany;\n        var item = companyList[index];\n        var target = dataCompany.filter(function (itm) {\n          return itm.id === item.id;\n        })[0];\n\n        if (target) {\n          target.number += item.number;\n        } else {\n          dataCompany.push(item);\n          this.dataCompanySize += 1;\n        }\n\n        companyList.splice(index, 1);\n      } else {\n        this.companyList = [];\n        this.dataCompany = [];\n        this.currentPage = 1;\n        this.getFactoryOrder();\n      }\n    },\n    // 获取工厂订单列表\n    getFactoryOrder: function getFactoryOrder() {\n      var _this3 = this;\n\n      var currentPage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n      var pageSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 15;\n      this.disabledUp = true;\n      var data = this.searchTerm;\n      data.currentPage = currentPage;\n      data.pageSize = pageSize;\n      postJson(api.getFactoryPolicyOrder, data).then(function (res) {\n        if (res.data.code === 0) {\n          var _data = res.data.data.records;\n          _this3.dataCompanySize = Number(res.data.data.total);\n\n          if (_data.length) {\n            _data.forEach(function (item) {\n              item.clickedVisible = false;\n            });\n\n            _this3.dataCompany = _this3.dataCompany.concat(_data);\n          }\n\n          _this3.disabledUp = false;\n          _this3.currentPage += 1;\n        }\n      }).catch(function () {\n        _this3.$message.error('系统错误');\n      });\n    },\n    updataDes: function updataDes(e, num, data, index) {\n      window.event ? window.event.cancelBubble = true : e.stopPropagation();\n      var updateList = this.updateList;\n      updateList.num = num;\n      updateList.date = data;\n      this.dataCompany[index].clickedVisible = true;\n    },\n    updateTime: function updateTime(dates, dateStrings) {\n      this.updateList.date = dateStrings;\n    },\n    // 订单分派提交\n    submit: function submit() {\n      var _this4 = this;\n\n      if (this.companyList.length === 0) {\n        return;\n      }\n\n      this.submitLoading = true;\n      var list = [];\n      var totalNumber = null;\n      var odRequireDueDate = null;\n      this.companyList.forEach(function (item) {\n        list.push({\n          id: item.id,\n          number: item.number\n        });\n        totalNumber += item.number;\n        odRequireDueDate = item.odRequireDueDate;\n      });\n      postJson(api.putFactoryPolicyOrderAdd, {\n        list: list,\n        totalNumber: totalNumber,\n        odRequireDueDate: odRequireDueDate,\n        remarks: ''\n      }).then(function (res) {\n        if (res.data.code === 0) {\n          _this4.$message.success('分单成功');\n\n          _this4.currentPage = 1;\n          _this4.companyList = [];\n          _this4.orderMerge = {};\n          _this4.dataCompany = [];\n\n          _this4.getFactoryOrder();\n        } else {\n          _this4.$message.error(res.data.msg);\n        }\n\n        _this4.submitLoading = false;\n      }).catch(function () {\n        _this4.submitLoading = false;\n\n        _this4.$message.error('系统错误');\n      });\n    },\n    // 关闭抽屉\n    isDrawer: function isDrawer(val) {\n      this.visible = val;\n    },\n    // 查看产品详情\n    infoView: function infoView(e, id, index) {\n      window.event ? window.event.cancelBubble = true : e.stopPropagation();\n      this.channelSkuId = id;\n      this.selectIndex = index;\n      this.visibleModal = true;\n    },\n    getViewInfo: function getViewInfo(params) {\n      var _this5 = this;\n\n      get(api.goodsView + \"?skuId=\".concat(params)).then(function (res) {\n        if (res.data.code === 0) {\n          _this5.goodsViewInfo = res.data.data;\n          _this5.visible = true;\n        }\n      }).then(function () {\n        Bus.$emit('setBomButton', true);\n        Bus.$emit('basicInfo', {\n          skuId: _this5.goodsViewInfo.sku.id,\n          type: _this5.isModalActive\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    handleCancel: function handleCancel() {\n      this.selectBom = false;\n    }\n  }\n};",{"version":3,"sources":["dispatch.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"dispatch\">\n    <a-row>\n      <a-col :span=\"12\" class=\"dispatch-left\">\n        <inputSearch @changeInput=\"changeInput\"></inputSearch>\n        <div class=\"order-list\">\n          <div\n            class=\"order-list-item demo-infinite-container\"\n            v-infinite-scroll=\"handleInfiniteOnLoad\"\n            :infinite-scroll-disabled=\"busy\"\n            :infinite-scroll-distance=\"10\"\n          >\n            <a-list :dataSource=\"dataCompany\">\n              <a-list-item slot=\"renderItem\" slot-scope=\"item, index\">\n                <div\n                  class=\"list-item\"\n                  @click=\"addCompany(item.channelSkuId,index,item.number,item.odRequireDueDate)\"\n                >\n                  <div class=\"item-left\">\n                    <div class=\"item-left-top\">\n                      <a\n                        href=\"javascript:;\"\n                        @click=\"e=>infoView(e,item.channelSkuId,index)\"\n                      >{{item.name}}</a>\n                      <span>{{item.bom}} {{item.craft}}</span>\n                    </div>\n                    <ul class=\"item-left-desc\">\n                      <li>{{item.spec}}</li>\n                      <li>{{item.cz}}</li>\n                      <li>{{item.odRequireDueDate?moment(item.odRequireDueDate).format(dateFormat):''}}</li>\n                      <li>{{item.number}}{{item.unit}}</li>\n                    </ul>\n                  </div>\n                  <div class=\"item-right\">\n                    <a-popover trigger=\"click\" v-model=\"item.clickedVisible\">\n                      <template slot=\"content\">\n                        <a-form-item\n                          label=\"交期\"\n                          :label-col=\"{ span: 5,offset:0 }\"\n                          :wrapper-col=\"{span:12}\"\n                          class=\"mb\"\n                        >\n                          <a-date-picker\n                            v-if=\"updateList.date\"\n                            format=\"YYYY-MM-DD\"\n                            :value=\"moment(updateList.date, 'YYYY-MM-DD')\"\n                            style=\"width:170px;\"\n                            @change=\"updateTime\"\n                          />\n                          <a-date-picker\n                            v-else\n                            format=\"YYYY-MM-DD\"\n                            style=\"width:170px;\"\n                            @change=\"updateTime\"\n                          />\n                        </a-form-item>\n                        <a-form-item\n                          label=\"数量\"\n                          :label-col=\"{ span: 5,offset:0 }\"\n                          :wrapper-col=\"{span:12}\"\n                          class=\"mb\"\n                        >\n                          <a-input-number\n                            :min=\"1\"\n                            :max=\"item.number\"\n                            v-model=\"updateList.num\"\n                            style=\"width:170px;\"\n                          />\n                        </a-form-item>\n                        <a-form-item class=\"mb\">\n                          <a-button @click=\"uploadBom(item,index)\">修改BOM/工艺</a-button>\n                        </a-form-item>\n                        <a-form-item class=\"mb\" v-show=\"getMenuPermission.includes('DELETE')\">\n                          <a-button type=\"danger\" @click=\"removeItem(item.id,index)\">移除</a-button>\n                        </a-form-item>\n                        <a-form-item class=\"mb\">\n                          <a-button type=\"primary\" @click=\"addLittle(item.channelSkuId,index)\">确定</a-button>\n                        </a-form-item>\n                      </template>\n                      <a-icon\n                        type=\"ellipsis\"\n                        class=\"item-right-edit\"\n                        @click=\"e=>updataDes(e,item.number,item.odRequireDueDate, index)\"\n                      />\n                    </a-popover>\n                    <a-button type=\"primary\" shape=\"circle\" icon=\"plus\"></a-button>\n                  </div>\n                </div>\n              </a-list-item>\n              <div v-if=\"loadingCompony && !busy\" class=\"demo-loading-container\">\n                <a-spin />\n              </div>\n            </a-list>\n          </div>\n        </div>\n      </a-col>\n      <a-col :span=\"12\" class=\"dispatch-right\">\n        <div class=\"order-list demo-infinite-container\">\n          <a-list :dataSource=\"companyList\">\n            <a-list-item slot=\"renderItem\" slot-scope=\"item, index\">\n              <div class=\"list-item\">\n                <div class=\"item-left\">\n                  <div class=\"item-left-top\">\n                    <a href=\"javascript:;\">{{item.name}}</a>\n                    <span>{{item.bom}} {{item.craft}}</span>\n                  </div>\n                  <ul class=\"item-left-desc\">\n                    <li>{{item.spec}}</li>\n                    <li>{{item.cz}}</li>\n                    <li>{{item.odRequireDueDate?moment(item.odRequireDueDate).format(dateFormat):''}}</li>\n                    <li>{{item.number}}{{item.unit}}</li>\n                  </ul>\n                </div>\n                <div class=\"item-right\">\n                  <a-button\n                    type=\"danger\"\n                    shape=\"circle\"\n                    icon=\"minus\"\n                    style=\"background:#f5222d;color:#fff;\"\n                    @click=\"minusCompany(index)\"\n                  ></a-button>\n                </div>\n              </div>\n            </a-list-item>\n          </a-list>\n          <div style=\"height:40px\"></div>\n          <div class=\"dispatch-right-bottom\">\n            <a-button @click=\"minusCompany\">取消</a-button>\n            <a-button\n              type=\"primary\"\n              @click=\"submit\"\n              :loading=\"submitLoading\"\n              v-show=\"getMenuPermission.includes('ADD')\"\n            >生成工单</a-button>\n          </div>\n        </div>\n      </a-col>\n    </a-row>\n    <!-- Moadl -->\n    <a-modal title=\"选择工艺\" :visible=\"visibleModal\" @ok=\"onModalOk\" @cancel=\"onModalNo\">\n      <ul class=\"bom-modal-list\">\n        <li\n          :class=\"{modalActive: isModalActive === 0 ? true : false}\"\n          @click=\"onModalInfo(0)\"\n        >设置工艺和BOM</li>\n        <li\n          :class=\"{modalActive: isModalActive === 1 ? true : false}\"\n          @click=\"onModalInfo(1)\"\n        >选择工艺和BOM</li>\n      </ul>\n    </a-modal>\n    <!-- 产品信息抽屉 -->\n    <a-drawer\n      destroyOnClose\n      placement=\"right\"\n      :closable=\"false\"\n      @close=\"closeDrawer\"\n      :visible=\"visible\"\n      :width=\"1040\"\n      :wrapStyle=\"{height: '100%',overflow: 'auto',paddingBottom: '108px'}\"\n    >\n      <dispatchInfo\n        @isDrawer=\"isDrawer\"\n        @setDispatchInfo=\"setDispatchInfo\"\n        :goodsViewInfo=\"goodsViewInfo\"\n      ></dispatchInfo>\n    </a-drawer>\n  </div>\n</template>\n\n<script>\nimport Bus from '@/Bus.js'\nimport infiniteScroll from 'vue-infinite-scroll'\nimport { postJson, get } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport moment from 'moment'\nimport dispatchInfo from '@/views/product/pdm/goods/child_info/GoodsInfo'\nimport inputSearch from './other/inputSearch'\nimport { mixinBasic, mixinDrawer } from '@/components/tools/mixin/mixin'\nexport default {\n  directives: { infiniteScroll },\n  mixins: [mixinBasic, mixinDrawer],\n  components: {\n    dispatchInfo,\n    inputSearch\n  },\n  data() {\n    return {\n      dateFormat: 'YYYY-MM-DD',\n      busy: false,\n      loadingCompony: false,\n      dataCompanySize: 0,\n      dataCompany: [],\n      orderMerge: [],\n      currentPage: 1,\n      pageSize: 15,\n      searchTerm: {},\n      updateList: {\n        num: 0,\n        date: ''\n      },\n      companyList: [],\n      submitLoading: false,\n      goodsViewInfo: {},\n      visibleModal: false,\n      selectIndex: '',\n      isModalActive: 0,\n      channelSkuId: '',\n      disabledUp: false\n    }\n  },\n  computed: {\n    getMenuPermission() {\n      return this.$store.state.menuPermission\n    }\n  },\n  methods: {\n    moment,\n    // 按条件搜索渠道商订单列表\n    changeInput(val, type) {\n      this.dataCompany = []\n      this.searchTerm = val\n      this.currentPage = 1\n      this.getFactoryOrder()\n    },\n    // 滚动滑动条加载订单\n    handleInfiniteOnLoad() {\n      const data = this.dataCompany\n      this.loadingCompony = true\n      this.busy = true\n      if (data.length >= this.dataCompanySize && this.dataCompanySize !== 0 || this.disabledUp) {\n        this.busy = true\n        this.loadingCompony = false\n      } else {\n        this.getFactoryOrder(this.currentPage)\n        this.busy = false\n        this.loadingCompony = false\n      }\n    },\n    // 移除订单\n    removeItem(id, index) {\n      const _this = this\n      this.$confirm({\n        title: '移除订单信息',\n        content: '您确定要移除这条订单消息吗?',\n        zIndex: 99999,\n        onOk() {\n          postJson(api.delFactoryPolicyOrder, { id }).then(res => {\n            if (res.data.code === 0) {\n              _this.$message.success('订单移除成功')\n              _this.dataCompany.splice(index, 1)\n              _this.dataCompanySize--\n            } else {\n              _this.$message.error(res.data.msg)\n            }\n          })\n        },\n        onCancel() { }\n      })\n    },\n    addCompany(channelSkuId, index, num, date) {\n      this.dispatchAction(channelSkuId, index, num, date)\n    },\n    addLittle(channelSkuId, index) {\n      const updateList = this.updateList\n      this.dispatchAction(channelSkuId, index, updateList.num, updateList.date)\n    },\n    /**\n    * @description 订单分派\n    * @param channelSkuId 产品SkuID 查询产品详情\n    * @param index 当前点击的索引\n    * @description 先判断是否设置制造工艺和BOM\n    * 一、设置。判断是否已经添加过产品。已经有添加的产品则在进行判断规格、材质、制造工艺、BOM是否一致，一致则添加不一致则警告；如果没有添加过产品则直接将 产品添加过去。\n    * 二、未设置。提示用户先设置制造工艺和BOM，确定设置则直接右侧抽屉展开\n    */\n    dispatchAction(channelSkuId, index, num, date) {\n      this.selectIndex = index\n      this.channelSkuId = channelSkuId\n      const dataCompany = this.dataCompany\n      const companyList = this.companyList\n      const item = dataCompany[index]\n      const target = JSON.parse(JSON.stringify(item))\n      const tar = companyList.filter(itm => itm.odRequireDueDate === date)[0]\n      dataCompany[index].clickedVisible = false\n      if (item.bom === null || item.craft === null) {\n        this.visibleModal = true\n        this.channelSkuId = channelSkuId\n        return\n      }\n      if (companyList.length !== 0) {\n        if (item.channelSkuId !== companyList[0].channelSkuId) {\n          this.$message.warning('不同产品不能合并生成工单。', 1)\n          return\n        }\n        if (item.bomGroupId !== companyList[0].bomGroupId && item.craftGroupId !== companyList[0].craftGroupId) {\n          this.$message.warning('不同制造工艺和BOM不能合并生成工单。', 1)\n          return\n        }\n        if (!tar) {\n          this.$message.warning('不同的交期不能合并生成工单', 1)\n          return\n        }\n        const tarList = companyList.filter(itm => itm.id === item.id)[0]\n        if (!tarList) {\n          target.odRequireDueDate = date\n          target.number = num\n          companyList.push(target)\n        } else {\n          tarList.number += num\n        }\n        if (num >= item.number) {\n          dataCompany.splice(index, 1)\n        } else {\n          item.number -= num\n        }\n      } else {\n        target.odRequireDueDate = date\n        target.number = num\n        if (num >= item.number) {\n          dataCompany.splice(index, 1)\n        } else {\n          item.number -= num\n        }\n        companyList.push(target)\n      }\n    },\n    uploadBom(item, index) {\n      this.selectIndex = index\n      this.dataCompany[index].clickedVisible = false\n      this.channelSkuId = item.channelSkuId\n      this.isModalActive = 1\n      this.onModalOk()\n    },\n    // MOdal\n    onModalOk() {\n      this.visibleModal = false\n      this.getViewInfo(this.channelSkuId)\n      this.$store.commit('setPromptTitle', {\n        title: '产品信息',\n        isEdit: true\n      })\n    },\n    onModalNo() {\n      this.visibleModal = false\n    },\n    setDispatchInfo(val) {\n      const dataCompany = this.dataCompany\n      const index = this.selectIndex\n      const data = {\n        id: dataCompany[index].id,\n        bomGroupId: dataCompany[index].bomGroupId,\n        craftGroupId: dataCompany[index].craftGroupId\n      }\n      val.forEach(item => {\n        if (item.defaultMaterials) {\n          dataCompany[index].bom = item.groupName\n          dataCompany[index].bomGroupId = item.id\n          data.bomGroupId = item.id\n        }\n        if (item.defaultCraft) {\n          dataCompany[index].craft = item.inputVal\n          dataCompany[index].craftGroupId = item.id\n          data.craftGroupId = item.id\n        }\n      })\n      data.id = dataCompany[index].id\n      postJson(api.updateBomCraft, data).then(res => {\n        if (res.data.code === 0) {\n          this.visible = false\n        } else {\n          this.$message.error(res.data.msg)\n        }\n      })\n    },\n    // Modal Tabs\n    onModalInfo(key) {\n      this.isModalActive = key\n    },\n    // 删除工厂中的订单\n    minusCompany(index) {\n      if (index >= 0) {\n        const companyList = this.companyList\n        const dataCompany = this.dataCompany\n        const item = companyList[index]\n        const target = dataCompany.filter(itm => itm.id === item.id)[0]\n        if (target) {\n          target.number += item.number\n        } else {\n          dataCompany.push(item)\n          this.dataCompanySize += 1\n        }\n        companyList.splice(index, 1)\n      } else {\n        this.companyList = []\n        this.dataCompany = []\n        this.currentPage = 1\n        this.getFactoryOrder()\n      }\n    },\n    // 获取工厂订单列表\n    getFactoryOrder(currentPage = 1, pageSize = 15) {\n      this.disabledUp = true\n      const data = this.searchTerm\n      data.currentPage = currentPage\n      data.pageSize = pageSize\n      postJson(api.getFactoryPolicyOrder, data).then(res => {\n        if (res.data.code === 0) {\n          const data = res.data.data.records\n          this.dataCompanySize = Number(res.data.data.total)\n          if (data.length) {\n            data.forEach(item => {\n              item.clickedVisible = false\n            })\n            this.dataCompany = this.dataCompany.concat(data)\n          }\n          this.disabledUp = false\n          this.currentPage += 1\n        }\n      }).catch(() => {\n        this.$message.error('系统错误')\n      })\n    },\n    updataDes(e, num, data, index) {\n      window.event ? window.event.cancelBubble = true : e.stopPropagation()\n      const updateList = this.updateList\n      updateList.num = num\n      updateList.date = data\n      this.dataCompany[index].clickedVisible = true\n    },\n    updateTime(dates, dateStrings) {\n      this.updateList.date = dateStrings\n    },\n    // 订单分派提交\n    submit() {\n      if (this.companyList.length === 0) {\n        return\n      }\n      this.submitLoading = true\n      const list = []\n      var totalNumber = null\n      var odRequireDueDate = null\n      this.companyList.forEach(item => {\n        list.push({\n          id: item.id,\n          number: item.number\n        })\n        totalNumber += item.number\n        odRequireDueDate = item.odRequireDueDate\n      })\n      postJson(api.putFactoryPolicyOrderAdd, {\n        list,\n        totalNumber: totalNumber,\n        odRequireDueDate: odRequireDueDate,\n        remarks: ''\n      }).then(res => {\n        if (res.data.code === 0) {\n          this.$message.success('分单成功')\n          this.currentPage = 1\n          this.companyList = []\n          this.orderMerge = {}\n          this.dataCompany = []\n          this.getFactoryOrder()\n        } else {\n          this.$message.error(res.data.msg)\n        }\n        this.submitLoading = false\n      }).catch(() => {\n        this.submitLoading = false\n        this.$message.error('系统错误')\n      })\n    },\n    // 关闭抽屉\n    isDrawer(val) {\n      this.visible = val\n    },\n    // 查看产品详情\n    infoView(e, id, index) {\n      window.event ? window.event.cancelBubble = true : e.stopPropagation()\n      this.channelSkuId = id\n      this.selectIndex = index\n      this.visibleModal = true\n    },\n    getViewInfo(params) {\n      get(api.goodsView + `?skuId=${params}`)\n        .then(res => {\n          if (res.data.code === 0) {\n            this.goodsViewInfo = res.data.data\n            this.visible = true\n          }\n        })\n        .then(() => {\n          Bus.$emit('setBomButton', true)\n          Bus.$emit('basicInfo', {\n            skuId: this.goodsViewInfo.sku.id,\n            type: this.isModalActive\n          })\n        })\n        .catch(err => {\n          console.log(err)\n        })\n    },\n    handleCancel() {\n      this.selectBom = false\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n@import \"~styles/dispach.less\";\n.item-left-desc li {\n  width: 140px;\n}\n.bom-modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 140px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  .modalActive {\n    border: 1px solid #1890ff;\n  }\n}\n</style>\n"],"sourceRoot":"src/views/factorySale/dispatchOrder"}]}