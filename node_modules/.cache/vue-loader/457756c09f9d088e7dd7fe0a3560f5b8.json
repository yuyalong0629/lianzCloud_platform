{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_price/PriceTab.vue?vue&type=style&index=0&id=5797bda1&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/goods/child_info/tab_price/PriceTab.vue","mtime":1564126501553},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import '~styles/variable.less';\n\n.categoryInfo-title {\n  margin: 15px 0;\n  .h3_title();\n}\n",{"version":3,"sources":["PriceTab.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+NA;;AAEA;AACA;AACA;AACA","file":"PriceTab.vue","sourceRoot":"src/views/product/pdm/goods/child_info/tab_price","sourcesContent":["<template>\n  <div>\n    <a-row :gutter=\"24\">\n      <a-col :span=\"24\">\n        <h3 class=\"categoryInfo-title\">价目表</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <!-- {{test}} -->\n        <a-table bordered :dataSource=\"dataSource\" :columns=\"columns\" :pagination=\"false\">\n          <template v-for=\"(value, col) in dataObj\" :slot=\"col\" slot-scope=\"text, record, index\">\n            <div :key=\"col\">\n              <a-input\n                style=\"margin: -5px 5px; width: 80%;\"\n                :value=\"text\"\n                placeholder=\"请输入价格\"\n                @change=\"e => handleChangeInput(e.target.value, record.key, col)\"\n              />\n            </div>\n          </template>\n        </a-table>\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"categoryInfo-title\">基础报价</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <a-form-item>\n          <a-input\n            :value=\"basicSprice\"\n            @change=\"e => handleChangeBasic(e.target.value)\"\n            placeholder=\"基础报价\"\n          />\n        </a-form-item>\n      </a-col>\n    </a-row>\n  </div>\n</template>\n<script>\nimport Bus from '@/Bus.js'\nimport { getBomAndCraftPrices } from '../../basic_lib/index'\nimport { setTimeout } from 'timers'\n\nexport default {\n  name: 'PriceTab',\n  data() {\n    return {\n      dataSource: [],\n      columns: [\n        {\n          title: '',\n          dataIndex: 'bom'\n        }\n      ],\n      dataObj: {},\n      spriceData: [],\n      basicSprice: undefined\n    }\n  },\n  props: {\n    skuId: {\n      type: String,\n      default: '',\n      required: false\n    }\n  },\n  methods: {\n    handleChangeInput(value, key, column) {\n      const reg = /^[0-9]*$/\n      if (reg.test(value)) {\n        const newData = [...this.dataSource]\n        const target = newData.filter(item => key === item.key)[0]\n        if (target) {\n          target[column] = value\n          this.dataSource = [...newData]\n          if (this.spriceData) {\n            console.log(this.spriceData)\n            console.log(this.dataSource)\n            this.spriceData.forEach(item => {\n              const targetData = this.dataSource.filter(\n                cItem => item.craftGroupId === cItem.craftGroupId\n              )[0]\n              // console.log(targetData)\n              if (targetData) {\n                item.price = targetData[`bom_${item.bomGroupId}`]\n              }\n            })\n          } else {\n            this.setSpriceData().then(() => {\n              this.$emit('spriceData', this.spriceData)\n            })\n          }\n          console.log(this.spriceData)\n        }\n      } else {\n        this.$message.error('请输入数字')\n      }\n    },\n    handleChangeBasic(value) {\n      const reg = /^[0-9]*$/\n      if (reg.test(value)) {\n        this.basicSprice = value\n        this.$emit('basicSprice', this.basicSprice)\n      } else {\n        this.$message.error('请输入数字')\n      }\n    },\n    async setSpriceData() {\n      this.spriceData = []\n      this.dataSource.forEach(item => {\n        this.columns.slice(1, this.columns.length).forEach(cItem => {\n          this.spriceData.push({\n            bomGroupId: cItem.bomGroupId,\n            bomGroupName: cItem.title,\n            craftGroupId: item.craftGroupId,\n            craftName: item['bom'],\n            price: item[`bom_${cItem.bomGroupId}`]\n          })\n        })\n      })\n    }\n  },\n  watch: {\n    skuId: {\n      handler(val) {\n        if (val) {\n          console.log(val)\n          getBomAndCraftPrices(this.skuId).then(res => {\n            if (res.data.code === 0) {\n              if (res.data.data.boms) {\n                const firstColumns = [\n                  {\n                    title: '',\n                    dataIndex: 'bom'\n                  }\n                ]\n                const otherColumns = res.data.data.boms.map(item => {\n                  return {\n                    title: item.groupName,\n                    dataIndex: `bom_${item.id}`,\n                    id: item.sort,\n                    bomGroupId: item.id,\n                    align: 'center',\n                    scopedSlots: { customRender: `bom_${item.id}` }\n                  }\n                })\n                this.columns = [...firstColumns, ...otherColumns]\n              }\n\n              if (res.data.data.crafts) {\n                const newColumns = [...this.columns]\n                const newDataSource = [...this.dataSource]\n                res.data.data.crafts.forEach((item, index) => {\n                  newColumns.forEach((cItem, cIndex) => {\n                    if (cIndex === 0) {\n                      this.dataObj = {\n                        bom: item.productCraftName\n                      }\n                    } else {\n                      this.$set(this.dataObj, cItem.dataIndex, '0')\n                    }\n                  })\n                  this.dataSource[index] = {\n                    key: item.id,\n                    craftGroupId: item.id,\n                    ...this.dataObj\n                  }\n                })\n                this.columns = [...newColumns]\n\n                this.setSpriceData().then(() => {\n                  this.$emit('spriceData', this.spriceData)\n                })\n\n                console.log(this.columns)\n                console.log(this.dataObj)\n                console.log(this.dataSource)\n              }\n\n              if (res.data.data.prices) {\n                const newSpriceData = [...this.spriceData]\n                const newDataSource = [...this.dataSource]\n                res.data.data.prices.forEach((item, index) => {\n                  const targetPrice = newSpriceData.filter(\n                    cItem =>\n                      item.craftGroupId === cItem.craftGroupId &&\n                      item.bomGroupId === cItem.bomGroupId\n                  )[0]\n                  if (targetPrice) {\n                    targetPrice[`price`] = item.price + ''\n                    targetPrice[`id`] = item.id\n                    targetPrice[`storeCount`] = item.storeCount\n                  }\n\n                  const targetDataSource = newDataSource.filter(\n                    cItem => item.craftGroupId === cItem.craftGroupId\n                  )[0]\n                  if (targetDataSource) {\n                    targetDataSource[`bom_${item.bomGroupId}`] = item.price + ''\n                  }\n                })\n                this.spriceData = [...newSpriceData]\n                this.dataSource = [...newDataSource]\n                // console.log(this.spriceData)\n                console.log(this.dataSource)\n\n                this.$emit('spriceData', this.spriceData)\n                console.log(this.spriceData)\n              }\n\n              if (res.data.data.basePrice) {\n                this.basicSprice = res.data.data.basePrice\n                this.$emit('basicSprice', this.basicSprice)\n              }\n            }\n          })\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.categoryInfo-title {\n  margin: 15px 0;\n  .h3_title();\n}\n</style>\n"]}]}