{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/orderInfo.vue?vue&type=style&index=0&id=390c3f04&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/orderInfo.vue","mtime":1564625928916},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import \"~styles/variable.less\";\n.inputWidth {\n  .inputWidth();\n}\n.mt {\n  margin: 10px 0;\n}\n.addCustomer-title {\n  border-left: 4px solid #1890ff;\n  padding-left: 6px;\n}\n.ant-upload-select-picture-card i {\n  font-size: 32px;\n  color: #999;\n}\n.ant-upload-select-picture-card .ant-upload-text {\n  margin-top: 8px;\n  color: #666;\n}\n",{"version":3,"sources":["orderInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"orderInfo.vue","sourceRoot":"src/views/sale/orderList/child_lib","sourcesContent":["<template>\n  <div>\n    <div class=\"add-order-list\">\n      <a-row>\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">订单详情</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <Detail\n            ref=\"detail\"\n            :mallOrderIntactDto=\"mallOrderIntactDto\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :selectAddress=\"selectAddress\"\n            @setCustId=\"setCustId\"\n          ></Detail>\n        </a-col>\n      </a-row>\n      <!-- <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">订单分配</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <Dispatch></Dispatch>\n        </a-col>\n      </a-row>-->\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">产品详情</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Product\n            ref=\"product\"\n            :custId=\"custId\"\n            :dataSource=\"dataSource\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :approval=\"approval\"\n            :selectAddress=\"selectAddress\"\n          ></Product>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">收货地址</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Address\n            :ocustName=\"ocustName\"\n            :custId=\"custId\"\n            :addrId=\"addrId\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            @setAddressId=\"setAddressId\"\n          ></Address>\n        </a-col>\n      </a-row>\n      <a-row>\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">附件</h3>\n        </a-col>\n        <a-col :span=\"24\" v-if=\"custId\">\n          <Upload\n            ref=\"upload\"\n            :editInfo=\"editInfo\"\n            :editDetial=\"editDetial\"\n            :file=\"fileList\"\n            :selectAddress=\"selectAddress\"\n          ></Upload>\n        </a-col>\n      </a-row>\n      <!-- <a-row v-if=\"editInfo && !approval\">\n        <a-col :span=\"24\" class=\"mt\">\n          <h3 class=\"addCustomer-title\">审批流程</h3>\n        </a-col>\n        <a-col :span=\"24\">\n          <a-steps progressDot :current=\"1\">\n            <a-step title=\"Finished\" description=\"This is a description.\"/>\n            <a-step title=\"In Progress\" description=\"This is a description.\"/>\n            <a-step title=\"Waiting\" description=\"This is a description.\"/>\n          </a-steps>\n        </a-col>\n      </a-row>-->\n    </div>\n  </div>\n</template>\n\n<script>\nimport Detail from './detail'\nimport Product from './product'\nimport Address from './address'\nimport Upload from './upload'\nimport Dispatch from './dispatch'\nimport api from '@/api/index.js'\nimport Bus from '@/Bus'\nimport { postJson, get, put, deleted } from '@/api/axios.js'\nexport default {\n  props: {\n    editInfo: {\n      type: Boolean\n    },\n    detialList: {\n      type: String\n    },\n    selectAddress: {\n      type: Boolean,\n      default: false\n    },\n    approval: {\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  components: {\n    Address,\n    Dispatch,\n    Detail,\n    Product,\n    Upload\n  },\n  data() {\n    return {\n      mallOrderIntactDto: {\n        oorderNumber: '自动生成',\n        ocustName: '',\n        otype: 'FORMAL',\n        addrId: '', // 地址ID\n        opurchaseOrderno: '', // 客户单号\n        custId: '', // 商城客户id\n        ocustShortName: '', // 客户简称\n        ototalSum: '', // 总金额，订单总计（销售总计）\n        oattachment: '', // 上传附件 1\n        oprePayment: '', // 预收款\n        oremarks: '', // 备注\n        ostatus: ''\n      },\n      dataSource: [],\n      editDetial: false,\n      custId: '',\n      ocustName: '',\n      addrId: '',\n      fileList: [],\n      timer: ''\n    }\n  },\n  methods: {\n    setCustId(val) {\n      this.custId = val.custId\n      this.ocustName = val.ocustName\n    },\n    setAddressId(val) {\n      this.addrId = val\n    },\n    // 订单提交\n    orderSubmit(val) {\n      const _this = this\n      if (this.custId === '') {\n        this.$message.warning('请先选择客户名称', 1)\n        return\n      }\n      const skuList = this.$refs.product.data\n      if (skuList.length === 0) {\n        this.$message.warning('请添加购买商品', 1)\n        return\n      }\n      if (!this.addrId) {\n        this.$confirm({\n          title: '地址确认',\n          content: '没有设置收件地址，确认提交订单吗？',\n          okText: '确定',\n          cancelText: '取消',\n          onOk() {\n            _this.submit(val)\n          }\n        })\n      } else {\n        _this.submit(val)\n      }\n    },\n    submit(val) {\n      const _this = this\n      const oattachment = this.$refs.upload.uploadFile.join(',')\n      const mallOrderIntactDto = this.$refs.detail.mallOrderIntactDto\n      const skuList = this.$refs.product.data\n      mallOrderIntactDto.addrId = this.addrId\n      mallOrderIntactDto.ocustAddrId = this.addrId\n      mallOrderIntactDto.oattachment = oattachment\n      _this.$emit('subLoading', true)\n      if (!val) {\n        // 订单添加\n        mallOrderIntactDto.skuList = skuList\n        delete mallOrderIntactDto.ostatus\n        delete mallOrderIntactDto.oorderNumber\n        postJson(api.orderSave, mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            _this.$message.success('订单添加成功', 1).then(() => {\n              _this.$emit('isVisible', true)\n            })\n          } else {\n            _this.$message.error(res.data.msg, 1)\n            _this.$emit('subLoading', false)\n          }\n        }).catch(() => {\n          _this.$message.error('服务出错', 1)\n          _this.$emit('subLoading', false)\n        })\n      } else {\n        // 订单修改\n        skuList.forEach(item => {\n          delete item.sku\n        })\n        mallOrderIntactDto.orderDetails = skuList\n        delete mallOrderIntactDto.skuList\n        put(api.updateOrder, mallOrderIntactDto).then(res => {\n          if (res.data.code === 0) {\n            _this.$message.success('订单修改成功', 1).then(() => {\n              _this.$emit('isVisible', true)\n            })\n          } else {\n            _this.$message.error(res.data.msg, 1)\n            _this.$emit('subLoading', false)\n          }\n        }).catch(() => {\n          _this.$message.error('服务出错', 1)\n          _this.$emit('subLoading', false)\n        })\n      }\n    },\n    // 获取订单详情\n    getOrderDetail(id) {\n      get(api.getOrderDetail + `${id}`).then(res => {\n        this.mallOrderIntactDto = res.data.data\n        this.custId = res.data.data.custId\n        this.addrId = res.data.data.addrId\n        this.ocustName = res.data.data.ocustName\n        const skuList = res.data.data.skuList\n        const oattachment = res.data.data.oattachment\n        for (const i in skuList) {\n          skuList[i].key = i\n        }\n        this.dataSource = skuList\n        if (oattachment) {\n          const oattachmentObj = []\n          const oattachmentList = oattachment.split(',')\n          for (const i in oattachmentList) {\n            var name = oattachmentList[i].split('/')\n            name = name[name.length - 1].split('.')\n            var type = name[1]\n            if (type === 'jpeg' || type === 'png' || type === 'svg' || type === 'gif' || type === 'jpg') {\n              type = 'img'\n            }\n            oattachmentObj.push({\n              uid: i,\n              name: name[0],\n              type: type,\n              status: 'done',\n              url: oattachmentList[i]\n            })\n          }\n          this.fileList = oattachmentObj\n        }\n      }).catch(() => {\n        this.$message.error('系统错误')\n      })\n    }\n  },\n  created() {\n    if (this.editInfo) {\n      this.getOrderDetail(this.detialList)\n    }\n    Bus.$on('isDisabled', val => {\n      this.editDetial = !val\n      if (val) {\n        const newData = [...this.dataSource]\n        newData.forEach(item => {\n          delete item.editable\n        })\n      }\n    })\n    Bus.$on('isDelete', val => {\n      if (!val) {\n        const idStr = this.mallOrderIntactDto.id\n        deleted(api.deletedBatch + `?idStr=${idStr}`).then(res => {\n          if (res.data.code === 0) {\n            this.$message.success('删除成功')\n            this.$emit('isVisible', true)\n          } else {\n            this.$message.error(res.data.msg)\n          }\n        })\n      }\n    })\n    Bus.$on('submitOrder', val => {\n      this.orderSubmit(val)\n    })\n  },\n  beforeDestroy() {\n    Bus.$off('isDisabled')\n    Bus.$off('isDelete')\n    Bus.$off('submitOrder')\n  }\n}\n</script>\n\n<style lang='less' scoped>\n@import \"~styles/variable.less\";\n.inputWidth {\n  .inputWidth();\n}\n.mt {\n  margin: 10px 0;\n}\n.addCustomer-title {\n  border-left: 4px solid #1890ff;\n  padding-left: 6px;\n}\n.ant-upload-select-picture-card i {\n  font-size: 32px;\n  color: #999;\n}\n.ant-upload-select-picture-card .ant-upload-text {\n  margin-top: 8px;\n  color: #666;\n}\n</style>\n"]}]}