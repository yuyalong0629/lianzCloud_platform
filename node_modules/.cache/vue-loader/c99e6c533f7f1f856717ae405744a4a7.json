{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/CustomerInfo.vue?vue&type=style&index=0&id=73bd0307&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/cust/child_info/CustomerInfo.vue","mtime":1563248233194},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import '~styles/variable.less';\n\n.customer-info {\n  .customer-title {\n    margin: 10px 0;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n  .label-box {\n    margin-bottom: 0;\n    .create-label {\n      background: #1890ff;\n      color: #fff;\n      border-radius: 4px;\n      display: inline-block;\n      height: 24px;\n      line-height: 12px;\n      padding: 6px;\n      margin: 0 4px;\n      i {\n        font-size: 10px;\n        margin-left: 4px;\n      }\n    }\n  }\n}\n",{"version":3,"sources":["CustomerInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2SA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CustomerInfo.vue","sourceRoot":"src/views/cust/child_info","sourcesContent":["<template>\n  <div class=\"customer-info\">\n    <prompt-title @isDisabled=\"isDisabled\" @isDelete=\"isDelete\"></prompt-title>\n    <a-row>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">基本信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <cust-form ref=\"custForm\" :custFormInfo=\"custFormInfo\" :childDisabled=\"disabled\" />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">联系人信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <concat-form\n          @userNatureDtos=\"userNatureDtos\"\n          :childDisabled=\"disabled\"\n          :mallUsersInfo=\"mallUsersInfo\"\n        />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">发票信息</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <invoice-form ref=\"invoiceForm\" :childDisabled=\"disabled\" :invoiceInfo=\"invoiceInfo\" />\n      </a-col>\n      <a-col :span=\"24\">\n        <h3 class=\"customer-title\">收货地址</h3>\n      </a-col>\n      <a-col :span=\"24\" style=\"margin-bottom: 30px;\">\n        <address-form\n          @custAddrList=\"custAddrList\"\n          :addressInfo=\"addressInfo\"\n          :childDisabled=\"disabled\"\n        />\n      </a-col>\n    </a-row>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #E9E9E9',\n          padding: '10px 16px',\n          background: '#FFF',\n          zIndex: 10,\n          textAlign: 'right',\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" type=\"primary\" :loading=\"loading\" v-if=\"isEdit\">提交</a-button>\n      <a-button\n        @click=\"onSave\"\n        type=\"primary\"\n        :disabled=\"!disabled\"\n        :loading=\"loading\"\n        v-else=\"isEdit\"\n        v-show=\"getDetailPermission.includes('UPDATE')\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport CustForm from './CustForm'\nimport ConcatForm from './ContactForm'\nimport InvoiceForm from './InvoiceForm'\nimport AddressForm from './AddressForm'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport {\n  subAddCust,\n  uploadCustomerAndMallUser,\n  removeCustomer\n} from '../basic_lib/index'\nimport { findParentId } from 'utils/utils.js'\n\nexport default {\n  name: 'CustomerInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      customer: {}, // 客户信息\n      mallUserNatureDtos: [], // 联系人信息\n      custInvoiceInfo: {}, // 发票信息\n      customerAddrList: [], // 地址信息\n      custFormInfo: {},\n      invoiceInfo: {},\n      mallUsersInfo: [],\n      addressInfo: [],\n      custManager: undefined\n    }\n  },\n  props: {\n    customerInfo: {\n      type: Object,\n      default: {},\n      required: false\n    }\n  },\n  created() {},\n  methods: {\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData().then(() => {\n        console.log(\n          this.mallUserNatureDtos.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          })\n        )\n        const params = {\n          customer: {\n            ...this.customer,\n            custManager: this.customer.custManagerId.label,\n            custManagerId: this.customer.custManagerId.key\n          },\n          mallUsers: this.mallUserNatureDtos.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          }),\n          custInvoiceInfo: {\n            ...this.custInvoiceInfo\n          },\n          customerAddrList: this.customerAddrList.map(item => {\n            delete item.deleted\n            return {\n              ...item\n            }\n          })\n        }\n        delete params.custInvoiceInfo.deleted\n        console.log(params)\n        subAddCust.call(this, params)\n      })\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData().then(() => {\n        const params = {\n          customer: {\n            ...this.customer,\n            id: this.custFormInfo.id,\n            custFrom: this.customer.custFrom === '线上注册' ? 0 : 1,\n            custManager: this.customer.custManagerId.label,\n            custManagerId: this.customer.custManagerId.key\n          },\n          mallUsers: [...this.mallUserNatureDtos],\n          custInvoiceInfo: {\n            ...this.custInvoiceInfo,\n            id: this.invoiceInfo.id,\n            custId: this.invoiceInfo.custId,\n            deleted: false\n          },\n          customerAddrList: [...this.customerAddrList]\n        }\n        console.log(params)\n        uploadCustomerAndMallUser.call(this, params)\n      })\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      console.log(this.customerInfo.customer.id)\n    },\n    // 联系人数组\n    userNatureDtos(val) {\n      val.forEach((item, index) => {\n        this.mallUserNatureDtos[index] = {\n          ...item\n        }\n      })\n      console.log(this.mallUserNatureDtos)\n    },\n    // 地址信息\n    custAddrList(val) {\n      this.customerAddrList = val\n      console.log(this.customerAddrList)\n    },\n    // FormData\n    async getFormData() {\n      // 基本信息\n      this.$refs.custForm.custForm.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          // console.log(values.custLevel)\n          const custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5']\n\n          this.customer = {\n            ...values,\n            custProvince: values.custAddress ? values.custAddress[0] : '',\n            custCity: values.custAddress ? values.custAddress[1] : '',\n            custArea: values.custAddress ? values.custAddress[2] : '',\n            custLevel: custLevelArr.includes(values.custLevel)\n              ? custLevelArr.indexOf(values.custLevel) + 1\n              : values.custLevel\n          }\n          delete this.customer.custAddress\n        }\n      })\n      // 发票信息\n      this.$refs.invoiceForm.invoiceForm.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          this.custInvoiceInfo = values\n        }\n      })\n    },\n    // Form详情\n    setFormData() {\n      // 客户信息\n      console.log(this.getCustLevel)\n      this.$refs.custForm.custForm.setFieldsValue({\n        custName: this.custFormInfo.custName,\n        custIndustry: this.custFormInfo.custIndustry,\n        custShortName: this.custFormInfo.custShortName,\n        custManagerId: {\n          key: this.custFormInfo.custManagerId || '',\n          label: this.custFormInfo.custManager\n        },\n        custLevel: this.getCustLevel,\n        custAddress: [\n          this.custFormInfo.custProvince,\n          this.custFormInfo.custCity,\n          this.custFormInfo.custArea\n        ],\n        custDetailAddr: this.custFormInfo.custDetailAddr,\n        custFax: this.custFormInfo.custFax,\n        custWebsite: this.custFormInfo.custWebsite,\n        custFrom: this.custFormInfo.custFrom === 0 ? '线上注册' : '线下注册'\n      })\n      // 发票信息\n      this.$refs.invoiceForm.invoiceForm.setFieldsValue({\n        iiCompanyName: this.invoiceInfo.iiCompanyName,\n        iiTaxpayerId: this.invoiceInfo.iiTaxpayerId,\n        iiBank: this.invoiceInfo.iiBank,\n        iiAccountName: this.invoiceInfo.iiAccountName,\n        iiTaxContent: this.invoiceInfo.iiTaxContent,\n        iiTaxContent: this.invoiceInfo.iiTaxContent,\n        iiContact: this.invoiceInfo.iiContact,\n        iiAddress: this.invoiceInfo.iiAddress\n      })\n    }\n  },\n  watch: {\n    customerInfo: {\n      handler(val) {\n        console.log(Object.keys(val).length)\n        if (Object.keys(val).length) {\n          this.custFormInfo = val.customer\n          this.invoiceInfo = val.custInvoiceInfo\n          this.mallUsersInfo = val.mallUsers\n          this.addressInfo = val.customerAddrList\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getCustLevel() {\n      const custLevelArr = ['V1', 'V2', 'V3', 'V4', 'V5']\n      // console.log(this.custFormInfo.custLevel)\n      return custLevelArr[this.custFormInfo.custLevel - 1]\n    },\n    getDetailPermission() {\n      return this.$store.state.detailPermission\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'cust-form': CustForm,\n    'concat-form': ConcatForm,\n    'invoice-form': InvoiceForm,\n    'address-form': AddressForm\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.customer-info {\n  .customer-title {\n    margin: 10px 0;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n  .label-box {\n    margin-bottom: 0;\n    .create-label {\n      background: #1890ff;\n      color: #fff;\n      border-radius: 4px;\n      display: inline-block;\n      height: 24px;\n      line-height: 12px;\n      padding: 6px;\n      margin: 0 4px;\n      i {\n        font-size: 10px;\n        margin-left: 4px;\n      }\n    }\n  }\n}\n</style>"]}]}