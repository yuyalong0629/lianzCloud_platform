{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/product.vue?vue&type=style&index=0&id=957ca55e&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/child_lib/product.vue","mtime":1564625928917},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.editable-add-btn {\n  cursor: pointer;\n  margin: 10px;\n  display: block;\n  line-height: 30px;\n  text-align: center;\n  border: 1px dashed #ccc;\n}\n.text-hidden {\n  display: block;\n  width: 100px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n",{"version":3,"sources":["product.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"product.vue","sourceRoot":"src/views/sale/orderList/child_lib","sourcesContent":["<template>\n  <a-row>\n    <a-table :columns=\"columns\" :dataSource=\"data\" :pagination=\"false\" :scroll=\"{ x:1250 }\">\n      <template slot=\"name\" slot-scope=\"text,record\">\n        <a-tooltip placement=\"top\">\n          <template slot=\"title\">\n            <span>{{record.odSkuName}}-{{record.code || record.odSkuCode}}</span>\n          </template>\n          <a\n            class=\"text-hidden\"\n            href=\"javascript:;\"\n            @click=\"getGoodsViews(record.skuId)\"\n          >{{record.odSkuName}}-{{record.code || record.odSkuCode}}</a>\n        </a-tooltip>\n      </template>\n      <template\n        v-for=\"col in ['odSkuCustPrice', 'odNumber', 'odAmount','odPurchaseOrderno','odRequireDueDate','odPromiseDueDate']\"\n        :slot=\"col\"\n        slot-scope=\"text, record\"\n      >\n        <div :key=\"col\">\n          <a-input\n            v-if=\"record.editable && (col!=='odRequireDueDate' && col !== 'odPromiseDueDate')\"\n            style=\"width:80px;\"\n            :value=\"text\"\n            size=\"small\"\n            @change=\"e => editCell(e.target.value, record.key, col)\"\n          />\n          <template\n            v-else-if=\"record.editable && (col ==='odRequireDueDate' || col === 'odPromiseDueDate')\"\n          >\n            <a-date-picker\n              v-if=\"text\"\n              style=\"width:100px;\"\n              size=\"small\"\n              :defaultValue=\"moment(moment(text).format('YYYY-MM-DD'), 'YYYY-MM-DD')\"\n              :format=\"'YYYY-MM-DD'\"\n              @change=\"(value,dateString) => editCell(dateString, record.key, col)\"\n            >\n              <span slot=\"suffixIcon\" style=\"display:none\"></span>\n            </a-date-picker>\n            <a-date-picker\n              v-else\n              style=\"width:100px;\"\n              size=\"small\"\n              :format=\"'YYYY-MM-DD'\"\n              @change=\"(value,dateString) => editCell(dateString, record.key, col)\"\n            >\n              <span slot=\"suffixIcon\" style=\"display:none\"></span>\n            </a-date-picker>\n          </template>\n          <template v-else>\n            <span\n              v-if=\"col ==='odRequireDueDate' || col === 'odPromiseDueDate'\"\n            >{{text?moment(text).format('YYYY-MM-DD'):''}}</span>\n            <span v-else>{{text}}</span>\n          </template>\n        </div>\n      </template>\n      <template slot=\"operation\" slot-scope=\"text, record\">\n        <div class=\"editable-row-operations\">\n          <span v-if=\"record.editable\">\n            <a @click=\"() => save(record.key)\" style=\"margin-right:10px\">保存</a>\n            <a-popconfirm title=\"确认删除吗?\" @confirm=\"() => cancel(record.key)\">\n              <a href=\"javascript:;\">删除</a>\n            </a-popconfirm>\n          </span>\n          <span v-else>\n            <span v-if=\"selectAddress\"></span>\n            <a @click=\"() => edit(record.key)\" v-else-if=\"!approval && editDetial || !editInfo\">编辑</a>\n            <span v-else></span>\n          </span>\n        </div>\n      </template>\n    </a-table>\n    <span class=\"editable-add-btn\" @click=\"onAddContact\" v-show=\"!editInfo\">+添加产品</span>\n    <a-modal\n      title=\"添加\"\n      :maskClosable=\"false\"\n      :closable=\"false\"\n      :footer=\"null\"\n      :visible=\"isAddContactInfo\"\n      @ok=\"handleOkContact\"\n      @cancel=\"handleOkContact\"\n    >\n      <EditableCell\n        v-if=\"isAddContactInfo\"\n        @showAddContactInfo=\"showAddContactInfo\"\n        :custId=\"custId\"\n      ></EditableCell>\n    </a-modal>\n    <a-drawer\n      placement=\"right\"\n      :closable=\"false\"\n      @close=\"isDrawer\"\n      :visible=\"towVisible\"\n      :wrapStyle=\"{height: '100%',overflow: 'auto',paddingBottom: '108px'}\"\n      :width=\"1040\"\n    >\n      <GoodsInfo @isDrawer=\"isDrawer\" :goodsViewInfo=\"goodsViewInfo\"></GoodsInfo>\n    </a-drawer>\n  </a-row>\n</template>\n\n<script>\nimport EditableCell from '../basic_lib/EditableCell'\nimport GoodsInfo from '@/views/product/pdm/goods/child_info/GoodsInfo'\nimport Bus from '@/Bus'\nimport moment from 'moment'\nimport api from '@/api/index.js'\nimport { get } from '@/api/axios.js'\nimport { columnsOrderInfo } from '../basic_lib/menu.js'\nexport default {\n  props: {\n    dataSource: {\n      type: Array,\n      required: true,\n      default: function () {\n        return []\n      }\n    },\n    custId: {\n      type: String,\n      required: true\n    },\n    editInfo: {\n      type: Boolean,\n      required: true,\n      default: false\n    },\n    editDetial: {\n      type: Boolean,\n      required: true,\n      default: false\n    },\n    approval: {\n      type: Boolean\n    },\n    selectAddress: {\n      type: Boolean,\n      required: false,\n      default: false\n    }\n  },\n  components: {\n    EditableCell,\n    GoodsInfo\n  },\n  data() {\n    return {\n      columns: columnsOrderInfo,\n      towVisible: false,\n      isAddContactInfo: false,\n      goodsViewInfo: {},\n      data: this.dataSource\n    }\n  },\n  methods: {\n    moment,\n    // 添加产品\n    onAddContact() {\n      if (this.custId !== '') {\n        this.isAddContactInfo = true\n      } else {\n        this.$message.warning('请先选择客户名称')\n      }\n    },\n    // 总价计算\n    setOtotalSum(data) {\n      let ototalSum = 0\n      for (const i in data) {\n        ototalSum += parseFloat(data[i].odAmount)\n      }\n      Bus.$emit('setOtotalSum', ototalSum)\n    },\n    // 关闭商品添加弹框\n    handleOkContact(e) {\n      setTimeout(() => {\n        this.isAddContactInfo = false\n      }, 1000)\n    },\n    showAddContactInfo(data) {\n      this.isAddContactInfo = data.isAddContactInfo\n      const dataSource = this.data\n      if (data.sku) {\n        data.sku.key = dataSource.length\n        dataSource.push(data.sku)\n        this.setOtotalSum(dataSource)\n        this.data = dataSource\n      }\n    },\n    // 产品编辑\n    edit(key) {\n      if (this.editInfo && !this.editDetial) {\n        return\n      }\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target.editable = true\n        this.data = newData\n      }\n    },\n    // 产品列表数据修改\n    editCell(value, key, column) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        target[column] = value\n        if (column === 'odNumber' || column === 'odSkuCustPrice') {\n          target['odAmount'] = Number((Number(target['odNumber']) * Number(target['odSkuCustPrice'])).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n        }\n        this.data = newData\n        this.setOtotalSum(newData)\n      }\n    },\n    // 保存修改\n    save(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        delete target.editable\n        this.data = newData\n        this.setOtotalSum(newData)\n      }\n    },\n    // 删除当前行\n    cancel(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key !== item.key)\n      this.data = target\n      this.setOtotalSum(this.data)\n    },\n    // 获取产品详情\n    getGoodsViews(skuId) {\n      this.getViewInfo(skuId)\n      this.$store.commit('setPromptTitle', {\n        title: '产品信息详情',\n        isEdit: true\n      })\n    },\n    getViewInfo(params) {\n      get(api.goodsView + `?skuId=${params}`).then(res => {\n        if (res.data.code === 0) {\n          this.goodsViewInfo = res.data.data\n          this.towVisible = true\n        }\n      }).catch(err => {\n        console.log(err)\n      })\n    },\n    isDrawer() {\n      this.towVisible = false\n    }\n  }\n}\n</script>\n\n<style lang='less' scoped>\n.editable-add-btn {\n  cursor: pointer;\n  margin: 10px;\n  display: block;\n  line-height: 30px;\n  text-align: center;\n  border: 1px dashed #ccc;\n}\n.text-hidden {\n  display: block;\n  width: 100px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n</style>\n"]}]}