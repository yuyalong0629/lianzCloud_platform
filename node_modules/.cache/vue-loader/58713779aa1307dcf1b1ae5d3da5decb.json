{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/user/Register.vue?vue&type=style&index=0&id=607e8eb2&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/user/Register.vue","mtime":1557712885067},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.register {\n  border-radius: 4px;\n  position: fixed;\n  width: 400px;\n  min-height: 300px;\n  left: 50%;\n  top: 50%;\n  margin-left: -200px;\n  margin-top: -200px;\n  .bg-color {\n    position: fixed;\n    z-index: -100;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: url('../../assets/loginBg.jpg') no-repeat center;\n    background-size: cover;\n  }\n  .register-sendcode {\n    width: 100%;\n  }\n  .register-to-login {\n    float: right;\n    color: #8f939a;\n    font-size: 12px;\n  }\n  .register-to-haslogin {\n    color: #8f939a;\n    font-size: 12px;\n  }\n}\n#components-form-demo-normal-re g .login-form {\n  max-width: 300px;\n}\n#components-form-demo-normal-login .login-form-forgot {\n  float: right;\n}\n#components-form-demo-normal-login .login-form-button {\n  width: 100%;\n}\n",{"version":3,"sources":["Register.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Register.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div class=\"register\">\n    <div class=\"bg-color\"></div>\n    <div\n      class=\"register-wrapper\"\n      style=\"border: 1px solid #F5F5F5; box-shadow: #666 0px 0px 10px; margin-top: -50px; padding: 20px; border-radius: 4px;\"\n    >\n      <a-divider>账号注册</a-divider>\n      <a-form :form=\"registerInfo\" @submit=\"handleRegister\">\n        <a-form-item>\n          <a-row :gutter=\"14\">\n            <a-col :span=\"16\">\n              <a-input\n                placeholder=\"请输入手机号\"\n                v-decorator=\"['username', {rules: [{ validator: validateUsername }], validateTrigger: ['blur']}]\"\n              >\n                <a-icon slot=\"prefix\" type=\"user\" style=\"color:rgba(0,0,0,.25)\"/>\n              </a-input>\n            </a-col>\n            <a-col :span=\"8\">\n              <a-button\n                :type=\"btnType\"\n                :disabled=\"disabled\"\n                @click=\"sendCode\"\n                class=\"register-sendcode\"\n              >{{ btnText }}</a-button>\n            </a-col>\n          </a-row>\n        </a-form-item>\n\n        <a-form-item>\n          <a-row>\n            <a-col :span=\"24\">\n              <a-input\n                placeholder=\"请输入验证码\"\n                v-decorator=\"['verificationCode', {rules: [{ required: true, message: '请输入验证码' }], validateTrigger: ['change', 'blur']}]\"\n              >\n                <a-icon slot=\"prefix\" type=\"safety-certificate\" style=\"color:rgba(0,0,0,.25)\"/>\n              </a-input>\n            </a-col>\n          </a-row>\n        </a-form-item>\n\n        <a-form-item>\n          <a-row>\n            <a-col :span=\"24\">\n              <a-input\n                placeholder=\"请输入密码\"\n                type=\"password\"\n                v-decorator=\"[\n              'password',\n              {rules: [{ validator: validatePassword }], validateTrigger: ['blur']}\n            ]\"\n              >\n                <a-icon slot=\"prefix\" type=\"lock\" style=\"color:rgba(0,0,0,.25)\"/>\n              </a-input>\n            </a-col>\n          </a-row>\n        </a-form-item>\n\n        <a-form-item>\n          <a-row>\n            <a-col :span=\"24\">\n              <a-input\n                placeholder=\"请确认密码\"\n                type=\"password\"\n                v-decorator=\"[\n              'rePassword',\n              {rules: [{ required: true, message: '请再次输入密码' }, { validator: validateRePassword }], validateTrigger: ['blur']}\n            ]\"\n              >\n                <a-icon slot=\"prefix\" type=\"lock\" style=\"color:rgba(0,0,0,.25)\"/>\n              </a-input>\n            </a-col>\n          </a-row>\n        </a-form-item>\n\n        <a-form-item :wrapper-col=\"{ span: 24 }\">\n          <a-row :gutter=\"16\">\n            <a-col class=\"gutter-row\" :span=\"24\">\n              <a href=\"javascript:;\" class=\"register-to-haslogin\">已有账号？</a>\n              <router-link to=\"/login\" class=\"register-to-login\">去登录</router-link>\n            </a-col>\n            <a-col class=\"gutter-row\" :span=\"24\">\n              <a-checkbox :checked=\"checkAgree\" @change=\"changeCheck\">我已阅读并同意</a-checkbox>\n              <a href=\"javascript:;\">《我已阅读并同意阅读并同意》</a>\n            </a-col>\n          </a-row>\n        </a-form-item>\n\n        <a-form-item :wrapper-col=\"{ span: 12, offset: 5 }\">\n          <a-button type=\"primary\" html-type=\"submit\">注册</a-button>\n          <a-button :style=\"{ marginLeft: '8px' }\" @click=\"handleReset\">重置</a-button>\n        </a-form-item>\n      </a-form>\n    </div>\n  </div>\n</template>\n<script>\nimport { post, get } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { factorySendCode } from 'utils/utils.js'\n\nexport default {\n  name: 'Register',\n  data() {\n    return {\n      btnType: 'primary',\n      btnText: '发送验证码',\n      remaining: 5,\n      disabled: false,\n      registerInfo: this.$form.createForm(this),\n      checkAgree: false,\n      inviteCode: ''\n    }\n  },\n  beforeRouteEnter(to, from, next) {\n    // 在渲染该组件的对应路由被 confirm 前调用\n    // 不！能！获取组件实例 `this`\n    // 因为当守卫执行前，组件实例还没被创建\n    console.log(to)\n    next(vm => {\n      if (to.query.v) {\n        vm.inviteCode = to.query.v\n        console.log(vm.inviteCode)\n      }\n    })\n  },\n  methods: {\n    // 自定义手机号验证\n    validateUsername(rule, value, callback) {\n      const regex = /^1[34578]\\d{9}$/\n      if (!value) {\n        callback(new Error('手机号不能为空'))\n        return false\n      }\n      if (!regex.test(value)) {\n        callback(new Error('请输入正确的手机号'))\n        return false\n      }\n      get(api.existPhone, { phone: value })\n        .then(res => {\n          if (res.data.code === 0) {\n            if (res.data.data.exist === true) {\n              callback(new Error('手机号已经被注册'))\n              return false\n            }\n            callback()\n          }\n        })\n        .catch(err => {\n          console.log(err)\n        })\n    },\n    // 验证密码\n    validatePassword(rule, value, callback) {\n      const regex = /[^0-9a-zA-Z_]/\n      if (!value) {\n        callback(new Error('密码不能为空'))\n        return false\n      }\n      if (value.length < 6 || value.length > 18) {\n        callback(new Error('密码请在6～18位数之间'))\n        return false\n      }\n      if (regex.test(value)) {\n        callback(new Error('密码不能有特殊字符'))\n        return false\n      }\n      callback()\n    },\n    validateRePassword(rule, value, callback) {\n      const password = this.registerInfo.getFieldValue('password')\n      if (value === undefined) {\n        callback(new Error('请输入密码'))\n      }\n      if (value && password && value.trim() !== password.trim()) {\n        callback(new Error('两次密码不一致'))\n      }\n      callback()\n    },\n    // senCode\n    sendCode() {\n      this.registerInfo.validateFields(['username'], (err, value, callback) => {\n        if (!err) {\n          post(api.sendCode, { phone: value.username }).then(res => {\n            factorySendCode.call(this, 5)\n          })\n        } else {\n          callback(new Error('手机号验证不正确'))\n        }\n      })\n    },\n    // 复选框\n    changeCheck(e) {\n      this.checkAgree = e.target.checked\n    },\n    // 注册提交\n    handleRegister(e) {\n      e.preventDefault()\n      if (!this.checkAgree) {\n        this.$message.error('请先同意声明')\n        return false\n      }\n      this.registerInfo.validateFields((err, values) => {\n        if (!err) {\n          const registerObj = {\n            phone: values.username,\n            pwd: values.password,\n            inviteCode: this.inviteCode || '',\n            yzm: values.verificationCode\n          }\n          post(api.register, registerObj)\n            .then(res => {\n              if (res.data.code === 1) {\n                this.$message.error(res.data.msg)\n                return false\n              }\n              if (res.data.code === 0) {\n                this.success()\n                return false\n              }\n            })\n            .catch(err => {\n              console.log(err)\n            })\n          return false\n        }\n        this.$message.error('注册失败')\n      })\n    },\n    handleReset() {\n      this.registerInfo.resetFields()\n    },\n    // 注册成功回调\n    success() {\n      this.$message\n        .success('注册成功', 1)\n        .then(() => {\n          this.$message.loading('跳转登录页面', 1.5)\n        })\n        .then(() => {\n          this.$router.push('/login')\n        })\n    }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.register {\n  border-radius: 4px;\n  position: fixed;\n  width: 400px;\n  min-height: 300px;\n  left: 50%;\n  top: 50%;\n  margin-left: -200px;\n  margin-top: -200px;\n  .bg-color {\n    position: fixed;\n    z-index: -100;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: url('../../assets/loginBg.jpg') no-repeat center;\n    background-size: cover;\n  }\n  .register-sendcode {\n    width: 100%;\n  }\n  .register-to-login {\n    float: right;\n    color: #8f939a;\n    font-size: 12px;\n  }\n  .register-to-haslogin {\n    color: #8f939a;\n    font-size: 12px;\n  }\n}\n#components-form-demo-normal-re g .login-form {\n  max-width: 300px;\n}\n#components-form-demo-normal-login .login-form-forgot {\n  float: right;\n}\n#components-form-demo-normal-login .login-form-button {\n  width: 100%;\n}\n</style>\n"]}]}