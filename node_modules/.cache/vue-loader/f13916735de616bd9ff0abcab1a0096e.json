{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/user/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/user/Login.vue","mtime":1561357290280},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { post } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { setTimeout } from 'timers'\n\nexport default {\n  name: 'Login',\n  data() {\n    return {\n      remenberMe: false,\n      visible: false,\n      selectCompanyData: '',\n      loginBtn: false,\n      key: ''\n    }\n  },\n  beforeCreate() {\n    this.loginInfo = this.$form.createForm(this)\n  },\n  created() {\n    const key = this.$route.query.key\n    this.key = key\n    if (key) {\n      this.loginByAuthKey(key)\n    }\n  },\n  mounted() {\n    // this.setRemenberLoginInfo()\n  },\n  methods: {\n    // 记住密码\n    onRemenberMe(e) {\n      this.remenberMe = e.target.checked\n      const remenberLoginInfo = this.loginInfo.getFieldsValue([\n        'userName',\n        'password'\n      ])\n      if (this.remenberMe) {\n        console.log(remenberLoginInfo)\n        localStorage.setItem(\n          'remenberLoginInfo',\n          JSON.stringify(remenberLoginInfo)\n        )\n      }\n    },\n    setRemenberLoginInfo() {\n      const getRemenberLoginInfo = localStorage.getItem('remenberLoginInfo')\n      console.log(getRemenberLoginInfo)\n      this.loginInfo.setFieldsValue({\n        userName: getRemenberLoginInfo.userName,\n        password: getRemenberLoginInfo.password\n      })\n    },\n    // 登录提交\n    handleSubmit(e) {\n      e.preventDefault()\n      this.loginInfo.validateFields((err, values) => {\n        this.loginBtn = true\n        if (!err) {\n          const loginObj = {\n            phone: values.userName,\n            pwd: values.password\n          }\n          post(api.login, loginObj)\n            .then(res => {\n              if (res.data.code === 0 && res.data.data.companys.length !== 0) {\n                console.log(res.data)\n                localStorage.setItem('NICK', res.data.data.user.name)\n                // token\n                localStorage.setItem(\n                  'ACCESS_TOKEN',\n                  res.data.data['AUTH-TOKEN']\n                )\n                if (res.data.data.companys.length > 1) {\n                  this.success()\n                  // 获取公司信息\n                  this.selectCompanyData = res.data.data.companys\n                  return false\n                }\n                // companyName\n                localStorage.setItem('companyName', res.data.data.companys[0].companyName)\n                localStorage.setItem(\n                  'companyId',\n                  res.data.data.companys[0].companyId\n                )\n                setTimeout(() => {\n                  this.$message.success('登录成功', 1)\n                  this.$router.push('/permission')\n                }, 600)\n                return false\n              }\n              this.loginBtn = false\n              this.$message.error(res.data.msg, 1.5)\n            })\n            .catch(err => {\n              console.log(err)\n              this.loginBtn = false\n            })\n            .finally(() => {\n              // this.loginBtn = false\n            })\n        } else {\n          this.loginBtn = false\n        }\n      })\n    },\n    handleCancel() {\n      this.visible = false\n    },\n    success() {\n      this.$message.success('登录成功', 1).then(() => {\n        // 显示弹出层\n        this.visible = true\n      })\n    },\n    selectCompanyOk(index, item) {\n      // companyId\n      localStorage.setItem('companyId', this.selectCompanyData[index].companyId)\n      // companyName\n      localStorage.setItem('companyName', this.selectCompanyData[index].companyName)\n      this.visible = false\n      this.$message.loading('欢迎回来', 1.5)\n      this.$router.push('/permission')\n    },\n    loginByAuthKey(key) {\n      post(api.loginByAuthKey, { key }).then(res => {\n        if (res.data.code === 0 && res.data.data.companys.length !== 0) {\n          localStorage.setItem('NICK', res.data.data.user.name)\n          // token\n          localStorage.setItem(\n            'ACCESS_TOKEN',\n            res.data.data['AUTH-TOKEN']\n          )\n          if (res.data.data.companys.length > 1) {\n            this.success()\n            // 获取公司信息\n            this.selectCompanyData = res.data.data.companys\n            return false\n          }\n          // companyName\n          localStorage.setItem('companyName', res.data.data.companys[0].companyName)\n          localStorage.setItem(\n            'companyId',\n            res.data.data.companys[0].companyId\n          )\n          this.$message.success('登录成功', 1)\n          this.$router.push('/permission')\n          return false\n        } else if (res.data.data.companys.length === 0) {\n          this.$message.error('归属公司认证中', 1.5)\n          return\n        }\n        this.$message.error(res.data.msg, 1.5)\n      })\n    }\n  }\n}\n",{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"bg-color\"></div>\n    <div\n      class=\"login-wrapper\"\n      style=\"border: 1px solid #F5F5F5; box-shadow: #666 0px 0px 10px; background: #FFF; padding: 20px; border-radius: 4px;\"\n      v-if=\"!key\"\n    >\n      <!-- <h3>扫码登录</h3> -->\n      <!-- 密码登录 -->\n      <div class=\"pwdLogin\">\n        <a-divider>密码登录</a-divider>\n        <a-form\n          id=\"components-form-demo-normal-login\"\n          :form=\"loginInfo\"\n          class=\"login-form\"\n          @submit=\"handleSubmit\"\n        >\n          <a-form-item>\n            <a-input\n              v-decorator=\"[\n          'userName',\n          { rules: [{ required: true, pattern: /^1[34578]\\d{9}$/, message: '请输入正确的手机号！' }], validateTrigger: 'blur' }\n        ]\"\n              placeholder=\"请输入手机号\"\n            >\n              <a-icon slot=\"prefix\" type=\"user\" style=\"color: rgba(0,0,0,.25)\"/>\n            </a-input>\n          </a-form-item>\n          <a-form-item>\n            <a-input\n              v-decorator=\"[\n          'password',\n          { rules: [{ required: true, pattern: /^[\\w]{6,18}$/, message: '请输入6~18位密码！' }], validateTrigger: 'blur' }\n        ]\"\n              type=\"password\"\n              placeholder=\"请输入密码\"\n            >\n              <a-icon slot=\"prefix\" type=\"lock\" style=\"color: rgba(0,0,0,.25)\"/>\n            </a-input>\n          </a-form-item>\n          <a-form-item>\n            <a-checkbox :checked=\"remenberMe\" @change=\"onRemenberMe\">记住密码</a-checkbox>\n            <router-link to=\"/user/retrieve\" class=\"login-form-forgot\">忘记密码</router-link>\n            <a-button\n              type=\"primary\"\n              html-type=\"submit\"\n              class=\"login-form-button\"\n              :loading=\"loginBtn\"\n            >登录</a-button>\n            <router-link to=\"/user/register\">跳转注册</router-link>\n          </a-form-item>\n        </a-form>\n      </div>\n      <!-- 扫码登录 -->\n      <!-- <div class=\"codeLogin\"></div> -->\n    </div>\n    <!-- 弹出层 -->\n    <a-modal title=\"选择公司\" :visible=\"visible\" :footer=\"null\" @cancel=\"handleCancel\">\n      <a-card>\n        <a-card-grid\n          style=\"width:25%;textAlign:'center'\"\n          class=\"selectCompany\"\n          @click=\"selectCompanyOk(index, item)\"\n          v-for=\"(item, index) of this.selectCompanyData\"\n          :key=\"index\"\n        >\n          <h3>{{ item.companyName }}</h3>\n          <img :src=\"item.companyLogo\" :alt=\"item.companyName\">\n        </a-card-grid>\n      </a-card>\n    </a-modal>\n  </div>\n</template>\n<script>\nimport { post } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { setTimeout } from 'timers'\n\nexport default {\n  name: 'Login',\n  data() {\n    return {\n      remenberMe: false,\n      visible: false,\n      selectCompanyData: '',\n      loginBtn: false,\n      key: ''\n    }\n  },\n  beforeCreate() {\n    this.loginInfo = this.$form.createForm(this)\n  },\n  created() {\n    const key = this.$route.query.key\n    this.key = key\n    if (key) {\n      this.loginByAuthKey(key)\n    }\n  },\n  mounted() {\n    // this.setRemenberLoginInfo()\n  },\n  methods: {\n    // 记住密码\n    onRemenberMe(e) {\n      this.remenberMe = e.target.checked\n      const remenberLoginInfo = this.loginInfo.getFieldsValue([\n        'userName',\n        'password'\n      ])\n      if (this.remenberMe) {\n        console.log(remenberLoginInfo)\n        localStorage.setItem(\n          'remenberLoginInfo',\n          JSON.stringify(remenberLoginInfo)\n        )\n      }\n    },\n    setRemenberLoginInfo() {\n      const getRemenberLoginInfo = localStorage.getItem('remenberLoginInfo')\n      console.log(getRemenberLoginInfo)\n      this.loginInfo.setFieldsValue({\n        userName: getRemenberLoginInfo.userName,\n        password: getRemenberLoginInfo.password\n      })\n    },\n    // 登录提交\n    handleSubmit(e) {\n      e.preventDefault()\n      this.loginInfo.validateFields((err, values) => {\n        this.loginBtn = true\n        if (!err) {\n          const loginObj = {\n            phone: values.userName,\n            pwd: values.password\n          }\n          post(api.login, loginObj)\n            .then(res => {\n              if (res.data.code === 0 && res.data.data.companys.length !== 0) {\n                console.log(res.data)\n                localStorage.setItem('NICK', res.data.data.user.name)\n                // token\n                localStorage.setItem(\n                  'ACCESS_TOKEN',\n                  res.data.data['AUTH-TOKEN']\n                )\n                if (res.data.data.companys.length > 1) {\n                  this.success()\n                  // 获取公司信息\n                  this.selectCompanyData = res.data.data.companys\n                  return false\n                }\n                // companyName\n                localStorage.setItem('companyName', res.data.data.companys[0].companyName)\n                localStorage.setItem(\n                  'companyId',\n                  res.data.data.companys[0].companyId\n                )\n                setTimeout(() => {\n                  this.$message.success('登录成功', 1)\n                  this.$router.push('/permission')\n                }, 600)\n                return false\n              }\n              this.loginBtn = false\n              this.$message.error(res.data.msg, 1.5)\n            })\n            .catch(err => {\n              console.log(err)\n              this.loginBtn = false\n            })\n            .finally(() => {\n              // this.loginBtn = false\n            })\n        } else {\n          this.loginBtn = false\n        }\n      })\n    },\n    handleCancel() {\n      this.visible = false\n    },\n    success() {\n      this.$message.success('登录成功', 1).then(() => {\n        // 显示弹出层\n        this.visible = true\n      })\n    },\n    selectCompanyOk(index, item) {\n      // companyId\n      localStorage.setItem('companyId', this.selectCompanyData[index].companyId)\n      // companyName\n      localStorage.setItem('companyName', this.selectCompanyData[index].companyName)\n      this.visible = false\n      this.$message.loading('欢迎回来', 1.5)\n      this.$router.push('/permission')\n    },\n    loginByAuthKey(key) {\n      post(api.loginByAuthKey, { key }).then(res => {\n        if (res.data.code === 0 && res.data.data.companys.length !== 0) {\n          localStorage.setItem('NICK', res.data.data.user.name)\n          // token\n          localStorage.setItem(\n            'ACCESS_TOKEN',\n            res.data.data['AUTH-TOKEN']\n          )\n          if (res.data.data.companys.length > 1) {\n            this.success()\n            // 获取公司信息\n            this.selectCompanyData = res.data.data.companys\n            return false\n          }\n          // companyName\n          localStorage.setItem('companyName', res.data.data.companys[0].companyName)\n          localStorage.setItem(\n            'companyId',\n            res.data.data.companys[0].companyId\n          )\n          this.$message.success('登录成功', 1)\n          this.$router.push('/permission')\n          return false\n        } else if (res.data.data.companys.length === 0) {\n          this.$message.error('归属公司认证中', 1.5)\n          return\n        }\n        this.$message.error(res.data.msg, 1.5)\n      })\n    }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.login {\n  position: fixed;\n  width: 400px;\n  min-height: 300px;\n  left: 50%;\n  top: 50%;\n  margin-left: 100px;\n  margin-top: -240px;\n  .bg-color {\n    position: fixed;\n    z-index: -100;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: url(\"../../assets/loginBg.png\") no-repeat center;\n    background-size: cover;\n  }\n  .login-wrapper {\n    margin-top: 20px;\n  }\n}\n.selectCompany {\n  text-align: center;\n  cursor: pointer;\n  h3 {\n    text-align: center;\n  }\n  img {\n    height: 60px;\n  }\n}\n#components-form-demo-normal-login .login-form {\n  max-width: 300px;\n}\n#components-form-demo-normal-login .login-form-forgot {\n  float: right;\n}\n#components-form-demo-normal-login .login-form-button {\n  width: 100%;\n}\n</style>\n"]}]}