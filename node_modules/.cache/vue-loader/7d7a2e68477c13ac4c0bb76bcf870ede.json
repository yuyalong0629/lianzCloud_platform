{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info/BomInfo.vue?vue&type=style&index=0&id=5bf88ca6&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info/BomInfo.vue","mtime":1561551287435},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.bom-info {\n  .bom-table {\n    border: 1px solid #69b412;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 5px;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .bom-icon-checked {\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: 0;\n      height: 30px;\n      width: 30px;\n      border-left: 30px solid transparent;\n      border-top: 30px solid #69b412;\n      .icon-right {\n        color: #fff;\n        position: absolute;\n        right: 2px;\n        top: -28px;\n        z-index: 10;\n      }\n    }\n    .bom-icon-default {\n      position: absolute;\n      top: 8px;\n      right: 40px;\n      button {\n        font-size: 12px;\n      }\n    }\n    .bom-input {\n      margin-bottom: 10px;\n      .bom-title {\n        display: inline-block;\n        margin: 0 5px;\n      }\n    }\n    .editable-row-operations a {\n      margin-right: 8px;\n    }\n  }\n}\n.bom-modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 100px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  .modalActive {\n    border: 1px solid #1890ff;\n  }\n}\n",{"version":3,"sources":["BomInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BomInfo.vue","sourceRoot":"src/views/product/pdm/goods/child_info/tab_goodsInfo/bom_info","sourcesContent":["<template>\n  <div class=\"bom-info\">\n    <div class=\"bom-table\" v-for=\"item of data\" :key=\"item.key\">\n      <!-- checked -->\n      <div class=\"bom-icon-checked\" v-if=\"item.defaultCraft\">\n        <a-icon class=\"icon-right\" type=\"check\"/>\n      </div>\n      <!-- default -->\n      <div class=\"bom-icon-default\">\n        <a-button\n          size=\"small\"\n          v-if=\"!item.defaultCraft\"\n          @click.stop=\"onDefault(item.key)\"\n          style=\"margin-right: 5px;\"\n        >设为默认</a-button>\n        <a-button size=\"small\" type=\"danger\" @click.stop=\"onDelete(item.key)\">删除</a-button>\n      </div>\n      <!-- Input -->\n      <div class=\"bom-input\">\n        <h3 v-if=\"item.inputShow\" class=\"bom-title\">{{ item.inputVal }}</h3>\n        <a-icon v-if=\"item.inputShow\" type=\"form\" @click.stop=\"onInput(item.key)\"/>\n        <a-input\n          v-if=\"!item.inputShow\"\n          :value=\"item.inputVal\"\n          size=\"small\"\n          :placeholder=\"`请输入${item.inputVal}`\"\n          style=\"width: 160px; margin-right: 5px;\"\n          @change=\"e => onChange(e.target.value, item.key)\"\n        />\n        <a-icon v-if=\"!item.inputShow\" type=\"file-add\" @click.stop=\"onSave(item.key)\"/>\n      </div>\n      <!-- Table -->\n      <a-table :columns=\"bomColumns\" :dataSource=\"item.dataSource\" :pagination=\"false\">\n        <template v-for=\"col in ['dosage']\" :slot=\"col\" slot-scope=\"text, record, index\">\n          <div :key=\"col\">\n            <a-input\n              v-if=\"record.editable\"\n              style=\"margin: -5px 0\"\n              :value=\"text\"\n              @change=\"e => onTabChange(e.target.value, record, col, item.key)\"\n            />\n            <template v-else>{{ text }}</template>\n          </div>\n        </template>\n        <template slot=\"operation\" slot-scope=\"text, record, index\">\n          <div class=\"editable-row-operations\">\n            <span v-if=\"!record.editable\">\n              <a @click.stop=\"() => onTabEdit(record, item.key)\">编辑</a>\n              <a-popconfirm title=\"确定要删除吗?\" @confirm=\"() => onTabDelete(record, item.key)\">\n                <a>删除</a>\n              </a-popconfirm>\n            </span>\n            <span v-else>\n              <a @click.stop=\"() => onTabSave(record, item.key)\">保存</a>\n            </span>\n          </div>\n        </template>\n      </a-table>\n      <a-button\n        style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n        type=\"dashed\"\n        icon=\"plus\"\n        @click.stop=\"onTabAdd(item.key)\"\n      >添加编码</a-button>\n    </div>\n    <!-- Moadl -->\n    <a-modal title=\"选择BOM\" :visible=\"visible\" @ok=\"onModalOk\" @cancel=\"onModalNo\">\n      <ul class=\"bom-modal-list\">\n        <li :class=\"{modalActive: isModalActive === 0 ? true : false}\" @click=\"onModalInfo(0)\">工艺BOM</li>\n        <li :class=\"{modalActive: isModalActive === 1 ? true : false}\" @click=\"onModalInfo(1)\">制造BOM</li>\n      </ul>\n    </a-modal>\n    <!-- 抽屉 -->\n    <a-drawer\n      :destroyOnClose=\"true\"\n      :title=\"false\"\n      width=\"300\"\n      :closable=\"false\"\n      @close=\"onChildrenDrawerClose\"\n      :visible=\"childrenDrawer\"\n    >\n      <BomDrawer @acceptChildDrawer=\"acceptChildDrawer\" @bomData=\"bomData\"/>\n    </a-drawer>\n    <a-button\n      style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n      type=\"dashed\"\n      icon=\"plus\"\n      @click=\"handleAdd\"\n    >添加方案</a-button>\n  </div>\n</template>\n<script>\nimport { bomColumns } from 'goods/basic_lib/column'\nimport BomDrawer from './BomDrawer'\n\nexport default {\n  name: 'BomInfo',\n  data() {\n    return {\n      count: 0,\n      bomColumns,\n      visible: false,\n      isModalActive: 0,\n      data: [],\n      childrenDrawer: false\n    }\n  },\n  methods: {\n    // Modal\n    handleAdd() {\n      this.visible = true\n    },\n    // Modal Add\n    async onModalOk(e) {\n      this.visible = await false\n      const { count, data, isModalActive } = this\n      const newData = {\n        key: count,\n        inputVal: `方案${count + 1}`,\n        inputShow: true,\n        bomType: isModalActive === 0 ? 'MAKE' : 'CRAFT',\n        defaultCraft: count === 0 ? true : false,\n        dataSource: []\n      }\n      this.data = [...data, newData]\n      this.count = count + 1\n      console.log(this.data)\n    },\n    // Modal Cancel\n    onModalNo(e) {\n      this.visible = false\n    },\n    // Modal Tabs\n    onModalInfo(key) {\n      this.isModalActive = key\n    },\n    // 设为默认\n    onDefault(key) {\n      const { count, data } = this\n      const target = data.map(item => {\n        return {\n          ...item,\n          defaultCraft: item.key === key ? true : false\n        }\n      })\n      this.data = [...target]\n      console.log(this.data)\n    },\n    // 删除\n    onDelete(key) {\n      const newData = [...this.data]\n      this.data = newData.filter(item => item.key !== key)\n      if (!this.data.length) {\n        this.count = 0\n      }\n      console.log(this.data)\n    },\n    // Input\n    onInput(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      console.log(target)\n      if (target) {\n        target.inputShow = false\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    onChange(value, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      if (target) {\n        target.inputVal = value\n        this.data = [...newData]\n      }\n    },\n    // Save\n    onSave(key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === key)[0]\n      console.log(target)\n      if (target) {\n        target.inputShow = true\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    // Table\n    async onTabAdd(key) {\n      this.$router.push({\n        query: {\n          ...this.$route.query,\n          bomIndex: key\n        }\n      })\n      this.childrenDrawer = await true\n    },\n    onTabChange(value, record, column, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData[column] = value\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    onTabSave(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData.editable = false\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    onTabDelete(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      target.dataSource = target.dataSource.filter(\n        item => record.key !== item.key\n      )\n      console.log(target)\n    },\n    onTabEdit(record, key) {\n      const newData = [...this.data]\n      const target = newData.filter(item => key === item.key)[0]\n      const targetData = target.dataSource.filter(\n        item => record.key === item.key\n      )[0]\n      if (targetData) {\n        targetData.editable = true\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    // 关闭抽屉\n    onChildrenDrawerClose() {\n      this.childrenDrawer = false\n    },\n    // BOM DATA\n    bomData(val) {\n      const BomIndex = this.$route.query.bomIndex\n      const newData = [...this.data]\n      const target = newData.filter(item => item.key === BomIndex)[0]\n      if (target) {\n        const newVal = {\n          ...val,\n          key: val.id,\n          dosage: 1,\n          editable: true\n        }\n        const dataSource = target.dataSource.filter(\n          item => item.id !== newVal.id\n        )\n        target.dataSource = [...dataSource, newVal]\n        this.data = [...newData]\n        console.log(this.data)\n      }\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer(val) {\n      this.childrenDrawer = val\n    }\n  },\n  components: {\n    BomDrawer\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.bom-info {\n  .bom-table {\n    border: 1px solid #69b412;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 5px;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .bom-icon-checked {\n      position: absolute;\n      top: 0;\n      right: 0;\n      z-index: 0;\n      height: 30px;\n      width: 30px;\n      border-left: 30px solid transparent;\n      border-top: 30px solid #69b412;\n      .icon-right {\n        color: #fff;\n        position: absolute;\n        right: 2px;\n        top: -28px;\n        z-index: 10;\n      }\n    }\n    .bom-icon-default {\n      position: absolute;\n      top: 8px;\n      right: 40px;\n      button {\n        font-size: 12px;\n      }\n    }\n    .bom-input {\n      margin-bottom: 10px;\n      .bom-title {\n        display: inline-block;\n        margin: 0 5px;\n      }\n    }\n    .editable-row-operations a {\n      margin-right: 8px;\n    }\n  }\n}\n.bom-modal-list {\n  text-align: center;\n  li {\n    display: inline-block;\n    width: 100px;\n    height: 60px;\n    margin: 0 10px;\n    border: 1px solid #d9d9d9;\n    line-height: 60px;\n    text-align: center;\n    border-radius: 4px;\n    box-sizing: border-box;\n    cursor: pointer;\n  }\n  .modalActive {\n    border: 1px solid #1890ff;\n  }\n}\n</style>\n"]}]}