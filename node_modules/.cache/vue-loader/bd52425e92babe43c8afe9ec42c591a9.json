{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/approval/basic_lib/common.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/approval/basic_lib/common.vue","mtime":1563972971493},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Animation from '@/assets/common/Animation'\nimport approvalInfo from '../child_lib/approvalInfo'\nimport infiniteScroll from 'vue-infinite-scroll'\nimport { status, useApp } from './menu'\nimport api from '@/api/index'\nimport { get, postJson } from '@/api/axios'\nimport Bus from '@/Bus.js'\nexport default {\n  directives: { infiniteScroll },\n  components: {\n    Animation,\n    approvalInfo\n  },\n  data() {\n    return {\n      labelCol: { span: 6 },\n      wrapperCol: { span: 18 },\n      key: '',\n      advanced: false,\n      visible: false,\n      dataList: [],\n      dataListSize: 0,\n      currentPage: 1,\n      pageSize: 20,\n      busy: true,\n      loadingCompony: false,\n      propItem: {},\n      status: status,\n      useApp: useApp,\n      founder: [],\n      showAction: false,\n      dto: {\n        bizType: 0,\n        procesEndTime: '',\n        procesStartTime: '',\n        processSerarchType: -1,\n        processStarters: []\n      },\n      timer: ''\n    }\n  },\n  created() {\n    if (this.$route.query.key) {\n      this.key = this.$route.query.key\n    }\n    if (this.$route.query.key === 4) {\n      this.getFounder()\n    }\n  },\n  methods: {\n    handleInfiniteOnLoad() {\n      if (this.dataList.length >= this.dataListSize && this.dataListSize !== 0) {\n        this.loadingCompony = false\n        this.busy = true\n      } else {\n        this.getList(this.key)\n        this.currentPage += 1\n        this.busy = false\n      }\n    },\n    toggleAdvanced() {\n      this.advanced = !this.advanced\n    },\n    getList(key) {\n      switch (key) {\n        case 1:\n          this.getItem(api.getReviewProcess)\n          break\n        case 2:\n          this.getItem(api.getProcessListToBeRead, 'READ')\n          break\n        case 3:\n          this.getItem(api.foRunProcessByStarter)\n          break\n        case 4:\n          this.getSearchResult()\n          break\n      }\n    },\n    getItem(url, processSerarch) {\n      this.loadingCompony = true\n      get(url, { currentPage: this.currentPage, pageSize: this.pageSize, processSerarch }).then(res => {\n        if (res.data.code === 0) {\n          this.dataListSize = Number(res.data.data.total)\n          this.loadingCompony = false\n          this.dataList = this.dataList.concat(res.data.data.records)\n        }\n      })\n    },\n    // 查看审批详情 打开抽屉\n    detialView(item, type) {\n      if (type === 'noRead') {\n        get(api.readProcess + `?runProcessIds=${item.foRunProcess.id}`).then(res => {\n          if (res.data.code === 0) {\n            this.currentPage = 1\n            this.dataList = []\n            Bus.$emit('ToObtain', true)\n            this.getList(this.key)\n          }\n        })\n        item.foRunProcessDtoType = 'READED'\n      }\n      if (type === 'RUN') {\n        this.showAction = false\n      } else {\n        this.showAction = true\n      }\n      this.propItem = item\n      this.visible = true\n    },\n    // 全部已读\n    allRead() {\n      const data = this.dataList\n      let runProcessIds = []\n      data.forEach(item => {\n        runProcessIds.push(`runProcessIds=${item.foRunProcess.id}`)\n      })\n      runProcessIds = runProcessIds.join('&')\n      get(api.readProcess + `?${runProcessIds}`).then(res => {\n        if (res.data.code === 0) {\n          this.currentPage = 1\n          this.dataList = []\n          this.getList(this.key)\n          Bus.$emit('ToObtain', true)\n        }\n      })\n    },\n    // 关闭审批详情抽屉\n    onClose() {\n      this.visible = false\n    },\n    // 获取创建人\n    getFounder() {\n      get(api.getCompanyAllUsers).then(res => {\n        if (res.data.code === 0) {\n          this.founder = this.founder.concat(res.data.data)\n        }\n      })\n    },\n    // 按条件搜索\n    inputChange(val, type) {\n      this.dataList = []\n      const dto = this.dto\n      if (type === 'date') {\n        dto.procesStartTime = val[0]\n        dto.procesEndTime = val[1]\n      } else {\n        dto[type] = val >= 0 ? val : -1\n      }\n      if (this.timer !== '') {\n        clearTimeout(this.timer)\n      }\n      this.timer = setTimeout(() => {\n        this.getSearchResult(1)\n      }, 1000)\n    },\n    getSearchResult(currentPage) {\n      const dto = this.dto\n      dto.currentPage = currentPage || this.currentPage\n      dto.pageSize = this.pageSize\n      postJson(api.searchRunProcess, dto).then(res => {\n        if (res.data.code === 0) {\n          this.dataListSize = Number(res.data.data.total)\n          this.loadingCompony = false\n          this.dataList = this.dataList.concat(res.data.data.records)\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["common.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"common.vue","sourceRoot":"src/views/approval/basic_lib","sourcesContent":["<template>\n  <div class=\"examination\">\n    <div class=\"examination-search\" v-show=\"key === 4\">\n      <a-form layout=\"horizontal\" style=\"margin-bottom:20px\">\n        <a-row>\n          <a-col :span=\"22\">\n            <a-row>\n              <a-col :span=\"8\">\n                <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"所属应用\">\n                  <a-select\n                    class=\"inputWidth\"\n                    placeholder=\"请选择所属应用\"\n                    :allowClear=\"true\"\n                    @change=\"(val)=>inputChange(val,'bizType')\"\n                  >\n                    <a-select-option v-for=\"item in useApp\" :key=\"item.value\">{{item.label}}</a-select-option>\n                  </a-select>\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"8\">\n                <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"创建时间\">\n                  <a-range-picker\n                    class=\"inputWidth\"\n                    format=\"YYYY/MM/DD\"\n                    @change=\"(dates, dateStrings)=>inputChange(dateStrings,'date')\"\n                  />\n                </a-form-item>\n              </a-col>\n              <a-col :span=\"8\">\n                <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"状态\">\n                  <a-select\n                    class=\"inputWidth\"\n                    :allowClear=\"true\"\n                    placeholder=\"请选择审批状态\"\n                    @change=\"(val)=>inputChange(val,'processSerarchType')\"\n                  >\n                    <a-select-option v-for=\"item in status\" :key=\"item.value\">{{item.label}}</a-select-option>\n                  </a-select>\n                </a-form-item>\n              </a-col>\n            </a-row>\n            <Animation name=\"fadeIn\">\n              <a-row v-show=\"advanced\">\n                <a-col :span=\"8\">\n                  <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"创建人\">\n                    <a-select\n                      mode=\"multiple\"\n                      class=\"inputWidth\"\n                      :allowClear=\"true\"\n                      placeholder=\"请选择创建人\"\n                      @change=\"(val)=>inputChange(val,'processStarters')\"\n                    >\n                      <a-select-option v-for=\"item in founder\" :key=\"item.id\">{{item.name}}</a-select-option>\n                    </a-select>\n                  </a-form-item>\n                </a-col>\n                <a-col :span=\"8\">\n                  <a-form-item :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\" label=\"处理时间\">\n                    <a-range-picker class=\"inputWidth\" format=\"YYYY/MM/DD\" />\n                  </a-form-item>\n                </a-col>\n              </a-row>\n            </Animation>\n          </a-col>\n          <a-col :span=\"2\">\n            <a-form-item style=\"text-align:center\">\n              <span style=\"cursor: pointer;\" @click=\"toggleAdvanced\">\n                {{ advanced ? '收起' : '展开' }}\n                <a-icon :type=\"advanced ? 'caret-up' : 'caret-down'\" />\n              </span>\n            </a-form-item>\n          </a-col>\n        </a-row>\n      </a-form>\n    </div>\n    <div class=\"examination-title\">\n      <span>标题</span>\n      <span>内容</span>\n      <span>时间</span>\n      <span>操作</span>\n      <div v-show=\"key === 2\" @click=\"allRead\">全部已阅</div>\n    </div>\n    <div class=\"examination-content\">\n      <div\n        class=\"examination-content-list\"\n        v-infinite-scroll=\"handleInfiniteOnLoad\"\n        :infinite-scroll-disabled=\"busy\"\n        :infinite-scroll-distance=\"10\"\n        :infinite-scroll-immediate-check=\"false\"\n      >\n        <a-list :dataSource=\"dataList\">\n          <a-list-item slot=\"renderItem\" slot-scope=\"item\">\n            <div class=\"examination-content-list-item\">\n              <div class=\"list-item-title\">\n                <span>{{item.foRunProcess.processStarterName}}</span>\n                {{item.foRunProcess.processName}}\n              </div>\n              <div class=\"list-item-content\">\n                <ul>\n                  <li\n                    v-for=\"(item,index) in item.foRunProcess.digest.split('/')\"\n                    :key=\"index\"\n                  >{{item}}</li>\n                </ul>\n              </div>\n              <div class=\"list-item-time\">{{item.foRunProcess.processStarttime | formatDate}}</div>\n              <div class=\"list-item-action\">\n                <template v-if=\"key === 1\">\n                  <a-button type=\"primary\" ghost @click=\"detialView(item,'RUN')\">进入审批</a-button>\n                </template>\n                <template v-if=\"key === 2\">\n                  <a-button\n                    type=\"primary\"\n                    v-if=\"item.foRunProcessDtoType === 'WAITE_READ'\"\n                    @click=\"detialView(item,'noRead')\"\n                  >未阅</a-button>\n                  <a-button\n                    type=\"primary\"\n                    @click=\"detialView(item)\"\n                    v-if=\"item.foRunProcessDtoType === 'READED'\"\n                  >已阅</a-button>\n                </template>\n                <template v-if=\"key === 3\">\n                  <a href=\"javascript:;\" @click=\"detialView(item)\">详情</a>\n                </template>\n                <template v-if=\"key === 4\">\n                  <a-button\n                    type=\"primary\"\n                    v-if=\"item.foRunProcessDtoType === 'WAITE_READ'\"\n                    @click=\"detialView(item,'noRead')\"\n                  >未阅</a-button>\n                  <a-button\n                    type=\"primary\"\n                    v-if=\"item.foRunProcessDtoType === 'READED'\"\n                    @click=\"detialView(item)\"\n                  >已阅</a-button>\n                  <a-button\n                    type=\"primary\"\n                    ghost\n                    v-if=\"item.foRunProcessDtoType==='RUNING'\"\n                    @click=\"detialView(item,'RUN')\"\n                  >进入审批</a-button>\n                  <a-button\n                    type=\"danger\"\n                    ghost\n                    v-if=\"item.foRunProcessDtoType==='NO_PASS'\"\n                    @click=\"detialView(item)\"\n                  >审批不通过</a-button>\n                  <a-button\n                    type=\"primary\"\n                    ghost\n                    v-if=\"item.foRunProcessDtoType==='PASS'\"\n                    @click=\"detialView(item)\"\n                  >审批通过</a-button>\n                </template>\n              </div>\n            </div>\n          </a-list-item>\n        </a-list>\n        <div v-if=\"loadingCompony && !busy\" class=\"demo-loading-container\">\n          <a-spin />\n        </div>\n      </div>\n    </div>\n    <a-drawer\n      destroyOnClose\n      :visible=\"visible\"\n      @close=\"onClose\"\n      :closable=\"false\"\n      :width=\"1040\"\n      :wrapStyle=\"{overflow: 'auto',paddingBottom: '108px'}\"\n    >\n      <approvalInfo @onClose=\"onClose\" :detial=\"propItem\" :showAction=\"showAction\"></approvalInfo>\n    </a-drawer>\n  </div>\n</template>\n\n<script>\nimport Animation from '@/assets/common/Animation'\nimport approvalInfo from '../child_lib/approvalInfo'\nimport infiniteScroll from 'vue-infinite-scroll'\nimport { status, useApp } from './menu'\nimport api from '@/api/index'\nimport { get, postJson } from '@/api/axios'\nimport Bus from '@/Bus.js'\nexport default {\n  directives: { infiniteScroll },\n  components: {\n    Animation,\n    approvalInfo\n  },\n  data() {\n    return {\n      labelCol: { span: 6 },\n      wrapperCol: { span: 18 },\n      key: '',\n      advanced: false,\n      visible: false,\n      dataList: [],\n      dataListSize: 0,\n      currentPage: 1,\n      pageSize: 20,\n      busy: true,\n      loadingCompony: false,\n      propItem: {},\n      status: status,\n      useApp: useApp,\n      founder: [],\n      showAction: false,\n      dto: {\n        bizType: 0,\n        procesEndTime: '',\n        procesStartTime: '',\n        processSerarchType: -1,\n        processStarters: []\n      },\n      timer: ''\n    }\n  },\n  created() {\n    if (this.$route.query.key) {\n      this.key = this.$route.query.key\n    }\n    if (this.$route.query.key === 4) {\n      this.getFounder()\n    }\n  },\n  methods: {\n    handleInfiniteOnLoad() {\n      if (this.dataList.length >= this.dataListSize && this.dataListSize !== 0) {\n        this.loadingCompony = false\n        this.busy = true\n      } else {\n        this.getList(this.key)\n        this.currentPage += 1\n        this.busy = false\n      }\n    },\n    toggleAdvanced() {\n      this.advanced = !this.advanced\n    },\n    getList(key) {\n      switch (key) {\n        case 1:\n          this.getItem(api.getReviewProcess)\n          break\n        case 2:\n          this.getItem(api.getProcessListToBeRead, 'READ')\n          break\n        case 3:\n          this.getItem(api.foRunProcessByStarter)\n          break\n        case 4:\n          this.getSearchResult()\n          break\n      }\n    },\n    getItem(url, processSerarch) {\n      this.loadingCompony = true\n      get(url, { currentPage: this.currentPage, pageSize: this.pageSize, processSerarch }).then(res => {\n        if (res.data.code === 0) {\n          this.dataListSize = Number(res.data.data.total)\n          this.loadingCompony = false\n          this.dataList = this.dataList.concat(res.data.data.records)\n        }\n      })\n    },\n    // 查看审批详情 打开抽屉\n    detialView(item, type) {\n      if (type === 'noRead') {\n        get(api.readProcess + `?runProcessIds=${item.foRunProcess.id}`).then(res => {\n          if (res.data.code === 0) {\n            this.currentPage = 1\n            this.dataList = []\n            Bus.$emit('ToObtain', true)\n            this.getList(this.key)\n          }\n        })\n        item.foRunProcessDtoType = 'READED'\n      }\n      if (type === 'RUN') {\n        this.showAction = false\n      } else {\n        this.showAction = true\n      }\n      this.propItem = item\n      this.visible = true\n    },\n    // 全部已读\n    allRead() {\n      const data = this.dataList\n      let runProcessIds = []\n      data.forEach(item => {\n        runProcessIds.push(`runProcessIds=${item.foRunProcess.id}`)\n      })\n      runProcessIds = runProcessIds.join('&')\n      get(api.readProcess + `?${runProcessIds}`).then(res => {\n        if (res.data.code === 0) {\n          this.currentPage = 1\n          this.dataList = []\n          this.getList(this.key)\n          Bus.$emit('ToObtain', true)\n        }\n      })\n    },\n    // 关闭审批详情抽屉\n    onClose() {\n      this.visible = false\n    },\n    // 获取创建人\n    getFounder() {\n      get(api.getCompanyAllUsers).then(res => {\n        if (res.data.code === 0) {\n          this.founder = this.founder.concat(res.data.data)\n        }\n      })\n    },\n    // 按条件搜索\n    inputChange(val, type) {\n      this.dataList = []\n      const dto = this.dto\n      if (type === 'date') {\n        dto.procesStartTime = val[0]\n        dto.procesEndTime = val[1]\n      } else {\n        dto[type] = val >= 0 ? val : -1\n      }\n      if (this.timer !== '') {\n        clearTimeout(this.timer)\n      }\n      this.timer = setTimeout(() => {\n        this.getSearchResult(1)\n      }, 1000)\n    },\n    getSearchResult(currentPage) {\n      const dto = this.dto\n      dto.currentPage = currentPage || this.currentPage\n      dto.pageSize = this.pageSize\n      postJson(api.searchRunProcess, dto).then(res => {\n        if (res.data.code === 0) {\n          this.dataListSize = Number(res.data.data.total)\n          this.loadingCompony = false\n          this.dataList = this.dataList.concat(res.data.data.records)\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n@import \"~styles/variable.less\";\n\n.inputWidth {\n  .inputWidth();\n}\n\n.examination {\n  padding: 0 30px;\n  &-title {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    font-size: 14px;\n    color: #999999;\n    border-bottom: 1px dashed #eeeeee;\n    & > span {\n      flex: 15%;\n      padding: 10px;\n      &:first-child {\n        flex: 30%;\n      }\n      &:nth-child(2) {\n        flex: 40%;\n      }\n    }\n    & > div {\n      position: absolute;\n      right: 10px;\n      top: 10px;\n      color: #007aff;\n      cursor: pointer;\n    }\n  }\n  &-content {\n    &-list-item {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      border-bottom: 1px solid #eeeeee;\n      font-size: 14px;\n      color: #333333;\n      width: 100%;\n      & > div {\n        flex: 15%;\n        padding: 10px;\n        &:first-child {\n          flex: 30%;\n          & > span {\n            display: inline-block;\n            width: 50px;\n            height: 50px;\n            background-color: #5077d1;\n            text-align: center;\n            line-height: 50px;\n            border-radius: 50%;\n            color: #fff;\n            margin-right: 10px;\n          }\n        }\n        &:nth-child(2) {\n          flex: 40%;\n          & > ul > li {\n            padding: 3px 0;\n            &:last-child {\n              font-size: 16px;\n              color: #ff9436;\n            }\n          }\n        }\n      }\n      .list-item-action {\n        & > button {\n          border-radius: 15px;\n        }\n      }\n    }\n  }\n}\n/deep/.ant-list-split .ant-list-item {\n  border: none !important;\n  padding: 0 !important;\n}\n.demo-infinite-container {\n  border: 1px solid #e8e8e8;\n  border-radius: 4px;\n  overflow: auto;\n  padding: 8px 24px 8px 10px;\n  height: 84vh;\n}\n.demo-loading-container {\n  position: absolute;\n  bottom: 40px;\n  width: 100%;\n  text-align: center;\n}\n</style>\n"]}]}