{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/craft/craftLine/child_info/CraftLineInfo.vue?vue&type=style&index=0&id=2a93a6f4&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/craft/craftLine/child_info/CraftLineInfo.vue","mtime":1563867599229},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import '~styles/variable.less';\n\n.carftLine-info {\n  .carftLine-title {\n    margin-bottom: 16px;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n  .craftline-box {\n    border: 1px solid #d9d9d9;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 10px 5px 0;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .ant-steps {\n      overflow-x: scroll;\n      /deep/ .ant-steps-item-icon {\n        .ant-steps-icon {\n          color: #f00;\n          font-size: 16px;\n        }\n      }\n      .ant-steps-item {\n        flex: none;\n        padding: 5px 10px 20px 10px;\n        &:last-child {\n          min-width: 30px;\n          padding-right: 0px;\n        }\n        /deep/ .ant-steps-item-content {\n          padding-right: 50px;\n        }\n      }\n    }\n  }\n}\n",{"version":3,"sources":["CraftLineInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwRA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CraftLineInfo.vue","sourceRoot":"src/views/product/craft/craftLine/child_info","sourcesContent":["<template>\n  <div class=\"carftLine-info\">\n    <prompt-title @isDisabled=\"isDisabled\" @isDelete=\"isDelete\"></prompt-title>\n    <a-row>\n      <a-col :span=\"24\">\n        <h3 class=\"carftLine-title\">工艺路线</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <a-form :form=\"processFormInfo\" layout=\"horizontal\" hideRequiredMark>\n          <a-row>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"工艺编码\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-input\n                  v-if=\"disabled\"\n                  disabled=\"disabled\"\n                  v-decorator=\"['craftLineCode']\"\n                  placeholder=\"默认带出\"\n                />\n                <template v-else=\"disabled\">{{getCraftLineInfo.groupCode}}</template>\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"工艺名称\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-input v-if=\"disabled\" v-decorator=\"['craftLineName']\" placeholder=\"请输入工艺名称\" />\n                <template v-else=\"disabled\">{{getCraftLineInfo.groupName}}</template>\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"状态\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-switch\n                  v-if=\"disabled\"\n                  v-decorator=\"['craftLineStatus', { initialValue: false, valuePropName: 'checked' }]\"\n                />\n                <template v-else=\"disabled\">{{getCraftLineInfo.status ? '已发布' : '未发布'}}</template>\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-form>\n      </a-col>\n    </a-row>\n    <a-row style=\"marginBottom: 50px;\">\n      <a-col :span=\"24\">\n        <h3 class=\"carftLine-title\">工序列表</h3>\n      </a-col>\n      <a-col :span=\"24\" style=\"margin-bottom: 15px;\">\n        <!-- Steps -->\n        <div class=\"craftline-box\">\n          <a-steps :current=\"craftData.length\" size=\"small\">\n            <a-step v-for=\"(item, index) in craftData\" :key=\"index\" :title=\"item.name\">\n              <a-icon\n                v-show=\"disabled\"\n                class=\"step-icon\"\n                type=\"close-circle\"\n                slot=\"icon\"\n                @click=\"onStepDelete(index)\"\n              />\n            </a-step>\n          </a-steps>\n          <a-button\n            style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\"\n            v-show=\"disabled\"\n            type=\"dashed\"\n            icon=\"plus\"\n            @click.stop=\"onTabAdd\"\n          >添加工艺流程</a-button>\n        </div>\n        <!-- 抽屉 -->\n        <a-drawer\n          :destroyOnClose=\"true\"\n          :title=\"false\"\n          width=\"300\"\n          :closable=\"false\"\n          @close=\"onChildrenDrawerClose\"\n          :visible=\"childrenDrawer\"\n        >\n          <craft-drawer @acceptChildDrawer=\"acceptChildDrawer\" @craftDrawerData=\"craftDrawerData\" />\n        </a-drawer>\n      </a-col>\n      <a-col :span=\"24\">\n        <a-table\n          :rowKey=\"record => Math.random(record.key)\"\n          :columns=\"columnsInfo\"\n          :dataSource=\"data\"\n          :pagination=\"false\"\n        >\n          <template slot=\"optBook\" slot-scope=\"text, record, index\">\n            <a v-if=\"text\" :href=\"text\">文件</a>\n            <a v-else=\"text\">无</a>\n          </template>\n        </a-table>\n      </a-col>\n    </a-row>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #E9E9E9',\n          padding: '10px 16px',\n          background: '#FFF',\n          textAlign: 'right',\n          zIndex: 100\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" type=\"primary\" :loading=\"loading\" v-if=\"isEdit\">提交</a-button>\n      <a-button\n        @click=\"onSave\"\n        type=\"primary\"\n        :disabled=\"!disabled\"\n        :loading=\"loading\"\n        v-show=\"getDetailPermission.includes('UPDATE')\"\n        v-else=\"!isEdit\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport CraftDrawer from './CraftDrawer'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport { columnsInfo } from '../basic_lib/column'\nimport {\n  craftLineAdd,\n  craftLineUpdate,\n  craftLineDelete\n} from '../basic_lib/index'\n\nexport default {\n  name: 'CarftLineInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      processFormInfo: this.$form.createForm(this),\n      data: [],\n      craftData: [],\n      columnsInfo,\n      craftProcessIds: '', // 工序流程图ID集合\n      getCraftLineInfo: {},\n      childrenDrawer: false\n    }\n  },\n  props: {\n    craftLineInfo: {\n      type: Object,\n      default: {}\n    }\n  },\n  methods: {\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData(null, craftLineAdd)\n    },\n    // stpe\n    onStepDelete(key) {\n      this.craftData.splice(key, 1)\n      this.data = [...this.craftData]\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData(this.getCraftLineInfo.id, craftLineUpdate)\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      craftLineDelete.call(this, [this.getCraftLineInfo.id])\n    },\n    // Form Data\n    getFormData(id, postFormData) {\n      this.data.forEach(e => {\n        if (e.key) {\n          this.craftProcessIds += `${e.key},`\n        }\n        if (e.id) {\n          this.craftProcessIds += `${e.id},`\n        }\n      })\n      this.processFormInfo.validateFields((err, values) => {\n        if (!err) {\n          const params = {\n            // groupCode: values.craftLineCode, // code\n            id,\n            craftProcessIds: this.craftProcessIds.slice(0, -1), // 工序流程图ID\n            groupName: values.craftLineName, // 工艺名称\n            status: values.craftLineStatus // 状态\n          }\n          postFormData.call(this, params)\n          // this.craftProcessIds = []\n        }\n      })\n    },\n    setFormData() {\n      this.processFormInfo.setFieldsValue({\n        // groupCode: values.craftLineCode, // code\n        craftLineName: this.getCraftLineInfo.groupName, // 工艺名称\n        craftLineStatus: this.getCraftLineInfo.status // 状态\n      })\n    },\n    onTabAdd(key) {\n      this.childrenDrawer = true\n    },\n    // 关闭抽屉\n    onChildrenDrawerClose() {\n      this.childrenDrawer = false\n    },\n    // 抽屉关闭回调\n    acceptChildDrawer(val) {\n      this.childrenDrawer = val\n    },\n    // drawer data\n    craftDrawerData(val) {\n      if (val) {\n        this.craftData = [...this.craftData, val]\n        this.data = [...this.craftData]\n      }\n    }\n  },\n  watch: {\n    craftLineInfo: {\n      handler(val) {\n        this.getCraftLineInfo = val\n        if (val.map || val.craftProcessIds) {\n          // 通过工艺ID获取所对应的工序对象\n          val.craftProcessIds.split(',').forEach((e, index) => {\n            const newData = Object.values(val.map).filter(\n              item => item.id === e\n            )[0]\n            this.craftData[index] = newData\n            this.data = [...this.craftData]\n          })\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getDetailPermission() {\n      return this.$store.state.detailPermission\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'craft-drawer': CraftDrawer\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.carftLine-info {\n  .carftLine-title {\n    margin-bottom: 16px;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n  .craftline-box {\n    border: 1px solid #d9d9d9;\n    border-radius: 4px;\n    box-sizing: border-box;\n    padding: 10px 5px 0;\n    margin: 10px 0;\n    min-height: 50px;\n    position: relative;\n    .ant-steps {\n      overflow-x: scroll;\n      /deep/ .ant-steps-item-icon {\n        .ant-steps-icon {\n          color: #f00;\n          font-size: 16px;\n        }\n      }\n      .ant-steps-item {\n        flex: none;\n        padding: 5px 10px 20px 10px;\n        &:last-child {\n          min-width: 30px;\n          padding-right: 0px;\n        }\n        /deep/ .ant-steps-item-content {\n          padding-right: 50px;\n        }\n      }\n    }\n  }\n}\n</style>\n"]}]}