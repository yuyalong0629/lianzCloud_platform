{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/category/child_info/CategoryInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/product/pdm/category/child_info/CategoryInfo.vue","mtime":1563242048832},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport {\n  getGoodsClass,\n  postCategoryAdd,\n  onSave,\n  deleteCategory\n} from '../basic_lib/index'\nimport { setTimeout } from 'timers'\nimport { Promise } from 'q'\nimport { findParentId } from 'utils/utils.js'\n\nexport default {\n  name: 'CategoryInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      cateGoryInfo: this.$form.createForm(this),\n      options: [],\n      viewCategoryInfo: {},\n      categorySuperiorObj: {\n        val: [],\n        id: []\n      }\n    }\n  },\n  props: {\n    categoryInfo: {\n      type: Object,\n      default: {}\n    }\n  },\n  created() {},\n  methods: {\n    // 公司上级分类\n    onChangeCategoryName(value) {\n      console.log(value)\n    },\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData(null, postCategoryAdd)\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData(this.viewCategoryInfo.id, onSave)\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      deleteCategory.call(this, this.viewCategoryInfo.id).then(() => {\n        this.$emit('isDrawer', val)\n      })\n    },\n    // FormData\n    async getFormData(id, postCategory) {\n      this.cateGoryInfo.validateFields((err, values) => {\n        if (!err) {\n          this.loading = true\n          const params = {\n            catType: 0,\n            id,\n            name: values.categoryClassName || '',\n            pid: values.categorySuperior\n              ? values.categorySuperior.slice(-1).join('')\n              : 0,\n            remark: values.categoryRemark || ''\n          }\n          postCategory.call(this, params)\n        }\n      })\n    },\n    // Form详情\n    setFormData() {\n      console.log(this.categorySuperiorObj.id)\n\n      this.cateGoryInfo.setFieldsValue({\n        categoryClassName: this.viewCategoryInfo.name,\n        categorySuperior:\n          this.categorySuperiorObj.id.length === 1\n            ? undefined\n            : [...this.categorySuperiorObj.id].slice(\n                0,\n                this.categorySuperiorObj.id.length - 1\n              ),\n        categoryRemark: this.viewCategoryInfo.remark\n      })\n    }\n  },\n  watch: {\n    // Info\n    categoryInfo: {\n      handler(val) {\n        this.viewCategoryInfo = Object.assign({}, val)\n        getGoodsClass.call(this).then(() => {\n          this.categorySuperiorObj.val = findParentId(\n            val.id,\n            this.options,\n            'name'\n          )\n          this.categorySuperiorObj.id = findParentId(val.id, this.options, 'id')\n        })\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getDetailPermission() {\n      return this.$store.state.detailPermission\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle\n  }\n}\n",{"version":3,"sources":["CategoryInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CategoryInfo.vue","sourceRoot":"src/views/product/pdm/category/child_info","sourcesContent":["<template>\n  <div class=\"category-info\">\n    <prompt-title @isDisabled=\"isDisabled\" @isDelete=\"isDelete\"></prompt-title>\n    <a-row>\n      <a-col :span=\"24\">\n        <h3 class=\"categoryInfo-title\">分类信息</h3>\n      </a-col>\n    </a-row>\n    <a-row>\n      <a-col :span=\"24\">\n        <a-form :form=\"cateGoryInfo\" layout=\"horizontal\" hideRequiredMark>\n          <a-form-item\n            label=\"分类名称\"\n            :class=\"{labelColor: isLabelColor}\"\n            :label-col=\"labelCol\"\n            :wrapper-col=\"wrapperCol\"\n          >\n            <a-input\n              v-if=\"disabled\"\n              v-decorator=\"['categoryClassName', {rules: [{ required: true, message: '请输入分类名称' }]}]\"\n              placeholder=\"请输入分类名称\"\n            />\n            <template v-else=\"!disabled\">{{viewCategoryInfo.name}}</template>\n          </a-form-item>\n          <a-form-item\n            label=\"上级分类\"\n            :class=\"{labelColor: isLabelColor}\"\n            :label-col=\"labelCol\"\n            :wrapper-col=\"wrapperCol\"\n          >\n            <a-cascader\n              v-if=\"disabled\"\n              v-decorator=\"['categorySuperior']\"\n              :options=\"options\"\n              :fieldNames=\"{ label: 'name', value: 'id', children: 'childrens' }\"\n              @change=\"onChangeCategoryName\"\n              placeholder=\"请输入上级分类\"\n              changeOnSelect\n            />\n            <template\n              v-else=\"!disabled\"\n            >{{categorySuperiorObj.val.length > 1 ? categorySuperiorObj.val.slice(0, -1).join('/') : '无上级分类'}}</template>\n          </a-form-item>\n          <a-form-item\n            label=\"备注\"\n            :class=\"{labelColor: isLabelColor}\"\n            :label-col=\"labelCol\"\n            :wrapper-col=\"wrapperCol\"\n          >\n            <a-input v-if=\"disabled\" v-decorator=\"['categoryRemark']\" placeholder=\"请输入备注\" />\n            <template v-else=\"!disabled\">{{viewCategoryInfo.remark}}</template>\n          </a-form-item>\n        </a-form>\n      </a-col>\n    </a-row>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #E9E9E9',\n          padding: '10px 16px',\n          background: '#FFF',\n          textAlign: 'right',\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" type=\"primary\" :loading=\"loading\" v-if=\"isEdit\">提交</a-button>\n      <a-button\n        @click=\"onSave\"\n        type=\"primary\"\n        :disabled=\"!disabled\"\n        :loading=\"loading\"\n        v-show=\"getDetailPermission.includes('UPDATE')\"\n        v-else=\"!isEdit\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport {\n  getGoodsClass,\n  postCategoryAdd,\n  onSave,\n  deleteCategory\n} from '../basic_lib/index'\nimport { setTimeout } from 'timers'\nimport { Promise } from 'q'\nimport { findParentId } from 'utils/utils.js'\n\nexport default {\n  name: 'CategoryInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      cateGoryInfo: this.$form.createForm(this),\n      options: [],\n      viewCategoryInfo: {},\n      categorySuperiorObj: {\n        val: [],\n        id: []\n      }\n    }\n  },\n  props: {\n    categoryInfo: {\n      type: Object,\n      default: {}\n    }\n  },\n  created() {},\n  methods: {\n    // 公司上级分类\n    onChangeCategoryName(value) {\n      console.log(value)\n    },\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData(null, postCategoryAdd)\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData(this.viewCategoryInfo.id, onSave)\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      deleteCategory.call(this, this.viewCategoryInfo.id).then(() => {\n        this.$emit('isDrawer', val)\n      })\n    },\n    // FormData\n    async getFormData(id, postCategory) {\n      this.cateGoryInfo.validateFields((err, values) => {\n        if (!err) {\n          this.loading = true\n          const params = {\n            catType: 0,\n            id,\n            name: values.categoryClassName || '',\n            pid: values.categorySuperior\n              ? values.categorySuperior.slice(-1).join('')\n              : 0,\n            remark: values.categoryRemark || ''\n          }\n          postCategory.call(this, params)\n        }\n      })\n    },\n    // Form详情\n    setFormData() {\n      console.log(this.categorySuperiorObj.id)\n\n      this.cateGoryInfo.setFieldsValue({\n        categoryClassName: this.viewCategoryInfo.name,\n        categorySuperior:\n          this.categorySuperiorObj.id.length === 1\n            ? undefined\n            : [...this.categorySuperiorObj.id].slice(\n                0,\n                this.categorySuperiorObj.id.length - 1\n              ),\n        categoryRemark: this.viewCategoryInfo.remark\n      })\n    }\n  },\n  watch: {\n    // Info\n    categoryInfo: {\n      handler(val) {\n        this.viewCategoryInfo = Object.assign({}, val)\n        getGoodsClass.call(this).then(() => {\n          this.categorySuperiorObj.val = findParentId(\n            val.id,\n            this.options,\n            'name'\n          )\n          this.categorySuperiorObj.id = findParentId(val.id, this.options, 'id')\n        })\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    getDetailPermission() {\n      return this.$store.state.detailPermission\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.category-info {\n  .categoryInfo-title {\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n}\n</style>"]}]}