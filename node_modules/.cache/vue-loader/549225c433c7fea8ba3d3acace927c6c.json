{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/customer/AddCustomerInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/customer/AddCustomerInfo.vue","mtime":1557728834815},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport EditableCell from './EditableCell'\nimport { getCustIndustry } from './getPage.js'\nimport { areas } from 'utils/area.js'\nimport { columns } from './columns.js'\nimport {\n  reduceObj,\n  subAddCust,\n  uploadCustomerAndMallUser,\n  searchAddress,\n  custManagerfetch\n} from './getPage.js'\nimport { setTimeout, clearTimeout } from 'timers'\nimport Title from 'utils/Title.vue'\n\nconst formItemLayout = {\n  labelCol: { span: 8 },\n  wrapperCol: { span: 14 }\n}\n\nexport default {\n  name: 'AddCustomerInfo',\n  data() {\n    return {\n      customerInfo: this.$form.createForm(this),\n      customerInvoiceInfo: this.$form.createForm(this),\n      isVisible: true,\n      formItemLayout,\n      options: areas,\n      dataContact: [],\n      getDataContact: [],\n      custIndustryArr: [], // 行业字典表\n      columns,\n      // 编辑添加弹出层\n      isAddContactInfo: false,\n      timer: null,\n      // 表单提交\n      loading: false,\n      custFormData: {\n        mallUserNatureDtos: [], // 添加联系人数组\n        custInvoiceInfo: {\n          companyId: '', // 厂家ID\n          createTime: '', // 创建时间\n          custId: '', //  供应商ID\n          creatorId: '', // 创建人ID\n          deleted: '', // 已删除(0未删1已删)\n          id: '0', // 已删除(0未删1已删)\n          iiAccountName: '', // 账户名\n          iiAddress: '', // 收票地址\n          iiBank: '', // 开户行\n          iiCompanyName: '', // 发票抬头\n          iiContact: '', // 联系方式\n          iiLinkman: '', // 收票联系人\n          iiTaxContent: '', // 开票内容\n          iiTaxpayerId: '', // 纳税人识别号\n          iiType: 0, // 发票类型\n          modifierId: '', // 修改人\n          modifyTime: '' // 修改时间\n        },\n        customer: {\n          companyId: '', // 厂家ID\n          custArea: '', // 客户所属区\n          custCity: '', // 客户所属市\n          custCode: '', // 客户编码\n          custDetailAddr: '', // 客户详细地址,\n          custFax: '', // 公司传真\n          custFrom: '', // 来源0线上注册，1线下注册\n          custIndustry: '', // 客户行业(字典表选择)\n          custLevel: '', // 客户级别0普通，1一般，2重点，3vip\n          custManager: '', // 客户经理 （厂家为公司服务的人员从后台录入）\n          custManagerId: 0, // 客户经理ID （厂家为公司服务的人员从后台录入）\n          custName: '', // 客户名称\n          custPhone: '', // 客户电话\n          custProvince: '', // 客户所属省\n          custShortName: '', // 客户简称\n          custStatus: '', // 状态0无购买记录 1有\n          custType: 0, // 类型0正常1虚拟添加\n          custWebsite: '', // 公司网址\n          id: '0' // 已删除(0未删1已删)\n        }\n      },\n      getCustDetailInfo: '',\n      custEdit: '点击编辑',\n      isDisabled: false,\n      getcustIndustry: '',\n      isInfoDisplay: {\n        display: 'block'\n      },\n      isColor: true,\n      isLabelColor: false,\n      // 客户经理\n      custManagerData: [],\n      custManagerValue: {}\n    }\n  },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    setCustomerAndMallUser: {\n      type: Object,\n      required: true\n    }\n  },\n  created() {\n    getCustIndustry.call(this, 'INDUSTRY')\n  },\n  destroyed() {\n    clearTimeout(this.timer)\n  },\n  watch: {\n    setCustomerAndMallUser: {\n      // immediate: true,\n      handler(val) {\n        this.getCustInfo(val)\n      },\n      deep: true\n    }\n  },\n  computed: {\n    isCategoryEdit() {\n      return this.isEdit\n    },\n    reGetCustDetailInfo() {\n      return this.getCustDetailInfo\n    }\n  },\n  methods: {\n    handleCustManagerSearch(value) {\n      custManagerfetch.call(this, value, data => (this.custManagerData = data))\n    },\n    handleCustManagerChange(value) {\n      console.log(value)\n      this.custManagerValue = {\n        key: value.key.toString(),\n        label: value.label\n      }\n    },\n    // 客户详情\n    getCustInfo(val) {\n      this.getCustDetailInfo = val\n      this.isDisabled = true\n      this.isLabelColor = true\n      this.isInfoDisplay.display = 'none'\n      console.log(this.getCustDetailInfo)\n      // 省市区\n      this.timer = setTimeout(() => {\n        console.log(this.getCustDetailInfo.customer.custLevel)\n        // 客户信息\n        this.customerInfo.setFieldsValue({\n          custCode: this.getCustDetailInfo.customer.custCode, // 客户编码\n          custName: this.getCustDetailInfo.customer.custName || '无', // 客户名称\n          custPhone: this.getCustDetailInfo.customer.custPhone || '无', // 客户电话\n          custIndustry: this.getCustDetailInfo.customer.custIndustry || '无', // 客户行业\n          custAbbreviation:\n            this.getCustDetailInfo.customer.custShortName || '无', // 简称\n          custManager: {\n            key: this.getCustDetailInfo.customer.custManagerId || '',\n            label: this.getCustDetailInfo.customer.custManager || ''\n          }, // 客户经理\n          custLevel:\n            this.getCustDetailInfo.customer.custLevel === 0\n              ? 'V1'\n              : this.getCustDetailInfo.customer.custLevel === 1\n              ? 'V2'\n              : this.getCustDetailInfo.customer.custLevel === 2\n              ? 'V3'\n              : this.getCustDetailInfo.customer.custLevel === 3\n              ? 'V4'\n              : 'V5', // 客户级别\n          custAddress: [\n            this.getCustDetailInfo.customer.custProvince,\n            this.getCustDetailInfo.customer.custCity,\n            this.getCustDetailInfo.customer.custArea\n          ], // 地址\n          custDetailAddress:\n            this.getCustDetailInfo.customer.custDetailAddr || '无', // 详细地址\n          custFax: this.getCustDetailInfo.customer.custFax || '无', // 传真\n          custUrl: this.getCustDetailInfo.customer.custWebsite || '无', // 网址\n          custSource:\n            this.getCustDetailInfo.customer.custFrom === '0'\n              ? '线上注册'\n              : '线下注册' // 来源\n        })\n        // 联系人信息\n        // this.dataContact = this.getCustDetailInfo.mallUserNatureDtos\n        this.getCustDetailInfo.mallUserNatureDtos.forEach(item => {\n          this.dataContact.push({\n            key: item.id,\n            editName: item.name,\n            editSex: item.sex === 0 ? '男' : '女',\n            editPhone: item.phone,\n            editDepartment: item.companyPosition,\n            editMaill: item.email,\n            editOther: item.contact\n          })\n        })\n        // 发票信息\n        this.customerInvoiceInfo.setFieldsValue({\n          custInvoiceAccount:\n            this.getCustDetailInfo.custInvoiceInfo.iiAccountName || '无', // 账户名\n          custInvoiceAddress:\n            this.getCustDetailInfo.custInvoiceInfo.iiAddress || '无', // 收票地址\n          custInvoiceBank:\n            this.getCustDetailInfo.custInvoiceInfo.iiBank || '无', // 开户行\n          custInvoiceUp:\n            this.getCustDetailInfo.custInvoiceInfo.iiCompanyName || '无', // 发票抬头\n          custInvoicePhone:\n            this.getCustDetailInfo.custInvoiceInfo.iiContact || '无', // 联系方式\n          custInvoiceContent:\n            this.getCustDetailInfo.custInvoiceInfo.iiTaxContent || '无', // 开票内容\n          custInvoiceNumber:\n            this.getCustDetailInfo.custInvoiceInfo.iiTaxpayerId || '无' // 纳税人识别号\n        })\n        console.log(this.dataContact)\n      }, 400)\n    },\n    // 一级新建列表遮罩显示\n    onClose() {\n      this.isVisible = false\n      this.$emit('isVisible', this.isVisible)\n    },\n    onSubmit() {\n      this.$emit('isVisible', this.isVisible)\n      // 客户信息\n      const asyncSubmit = new Promise(resolve => {\n        this.getFormData()\n        resolve()\n      })\n      asyncSubmit.then(() => {\n        subAddCust.call(this)\n      })\n    },\n    // 获取表单参数\n    getFormData() {\n      this.customerInfo.validateFields((err, value) => {\n        console.log(value)\n        if (!err) {\n          // this.custFormData.custCode = value.custCode // 客户编码\n          this.custFormData.customer.custName = value.custName // 客户名称\n          this.custFormData.customer.custPhone = value.custPhone // 客户电话\n          this.custFormData.customer.custProvince = value.custAddress[0] // 省\n          this.custFormData.customer.custCity = value.custAddress[1] // 市\n          this.custFormData.customer.custArea = value.custAddress[2] // 区\n          this.custFormData.customer.custShortName = value.custAbbreviation\n            ? value.custAbbreviation\n            : '' // 客户简称\n          this.custFormData.customer.custManager = (value.custManager.label || value.custManager.label === '全部')\n            ? value.custManager.label\n            : '' // 客户经理\n          this.custFormData.customer.custManagerId = value.custManager.key\n            ? value.custManager.key\n            : 0 // 客户经理ID\n          this.custFormData.customer.custDetailAddr = value.custDetailAddress\n            ? value.custDetailAddress\n            : '' // 详细地址\n          this.custFormData.customer.custFax = value.custFax\n            ? value.custFax\n            : '' // 传真\n          this.custFormData.customer.custWebsite = value.custUrl\n            ? value.custUrl\n            : '' // 网址\n          this.custFormData.customer.custFrom =\n            value.custSource === '线上注册' ? 0 : 1 // 来源\n          // this.dataContact 联系人数组\n          this.custFormData.mallUserNatureDtos = []\n          this.dataContact.forEach(item => {\n            console.log(item)\n            this.custFormData.mallUserNatureDtos.push({\n              id: 0,\n              companyPosition: item.editDepartment,\n              contact: item.editOther,\n              email: item.editMaill,\n              name: item.editName,\n              phone: item.editPhone,\n              sex: item.editSex === '男' ? 0 : 1\n            })\n          })\n        }\n      })\n      // 发票信息\n      this.customerInvoiceInfo.validateFields((err, value) => {\n        if (!err) {\n          this.custFormData.custInvoiceInfo.iiCompanyName = value.custInvoiceUp\n            ? value.custInvoiceUp\n            : '' // 发票抬头\n          this.custFormData.custInvoiceInfo.iiTaxpayerId = value.custInvoiceNumber\n            ? value.custInvoiceNumber\n            : '' // 纳税人识别号\n          this.custFormData.custInvoiceInfo.iiBank = value.custInvoiceBank\n            ? value.custInvoiceBank\n            : '' // 开户行\n          this.custFormData.custInvoiceInfo.iiAccountName = value.custInvoiceAccount\n            ? value.custInvoiceAccount\n            : '' // 开户账号\n          this.custFormData.custInvoiceInfo.iiTaxContent = value.custInvoiceContent\n            ? value.custInvoiceContent\n            : '' // 开票内容\n          this.custFormData.custInvoiceInfo.iiContact = value.custInvoicePhone\n            ? value.custInvoicePhone\n            : '' // 联系电话\n          this.custFormData.custInvoiceInfo.iiAddress = value.custInvoiceAddress\n            ? value.custInvoiceAddress\n            : '' // 发票地址\n          console.info(value)\n        }\n      })\n    },\n    // 客户行业\n    onSelectCustIndustry(value) {\n      console.log(value)\n      this.custFormData.customer.custIndustry = value // 客户行业\n    },\n    // 客户等级\n    onSelectCustLevel(value) {\n      console.log(value)\n      this.custFormData.customer.custLevel = value // 客户行业\n    },\n    // 客户来源\n    onSelectCustFrom(value) {\n      this.custFormData.customer.custFrom = value // 客户行业\n      console.log(this.custFormData.customer.custFrom)\n    },\n    // 地址选择\n    onSelectArea(value, selectedOptions) {\n      console.log(value)\n      this.custFormData.customer.custProvince = ''\n      this.custFormData.customer.custCity = ''\n      this.custFormData.customer.custArea = ''\n      if (value.length === 1) {\n        this.custFormData.customer.custProvince = value[0]\n        console.log(this.custFormData)\n        return false\n      }\n      if (value.length === 2) {\n        this.custFormData.customer.custProvince = value[0]\n        this.custFormData.customer.custCity = value[1]\n        console.log(this.custFormData)\n        return false\n      }\n      if (value.length === 3) {\n        this.custFormData.customer.custProvince = value[0]\n        this.custFormData.customer.custCity = value[1]\n        this.custFormData.customer.custArea = value[2]\n        console.log(this.custFormData)\n        return false\n      }\n    },\n    // 联系人信息\n    onDeleteContact(key) {\n      const dataSource = [...this.dataSource]\n      this.dataSource = dataSource.filter(item => {\n        console.log(item)\n        return item.key !== key\n      })\n    },\n    onEditContact(key) {\n      console.log(key)\n    },\n    // 监听table修改状态\n    onChangeEdit(value, key, column) {\n      console.log(value, key, column)\n      const newData = [...this.dataContact]\n      const target = this.dataContact.filter(item => key === item.key)[0]\n      console.log(target)\n      if (target) {\n        target[column] = value\n        this.Contact = newData\n      }\n    },\n    // 编辑\n    edit(key) {\n      if (!this.isDisabled) {\n        const newData = [...this.dataContact]\n        const target = newData.filter(item => key === item.key)[0]\n        if (target) {\n          target.editable = true\n          this.dataContact = newData\n        }\n      }\n    },\n    // 保存\n    save(key) {\n      const newData = [...this.dataContact]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        delete target.editable\n        this.dataContact = newData\n        console.log(this.dataContact)\n      }\n    },\n    // 删除\n    removeCancel(key) {\n      const newData = [...this.dataContact]\n      this.dataContact = newData.filter(item => item.key !== key)\n    },\n    // 联系人添加遮罩\n    onAddContact() {\n      this.isAddContactInfo = true\n    },\n    handleOkContact(e) {\n      setTimeout(() => {\n        this.isAddContactInfo = false\n      }, 2000)\n    },\n    handleCancelContact(e) {\n      console.log('Clicked cancel button')\n      this.isAddContactInfo = false\n    },\n    // 添加信息详情关闭回调\n    closeAddInfo() {\n      if (this.$store.state.custEditableInfo) {\n        this.getDataContact.push(this.$store.state.custEditableInfo)\n        console.log(this.getDataContact)\n        const repeatArr = reduceObj.call(this, this.getDataContact)\n        // 防止同步加载阻塞\n        this.$nextTick(() => {\n          // 修改时记录详情数据\n          if (this.isDisabled === true) {\n            this.dataContact = []\n          }\n          if (this.isDisabled === false) {\n            this.dataContact = [...this.getCustDetailInfo.mallUserNatureDtos]\n          }\n          for (let i = 0; i < repeatArr.length; i++) {\n            this.dataContact.push({\n              key: i.toString(),\n              editName: repeatArr[i].name,\n              editSex: repeatArr[i].sex === '0' ? '男' : '女',\n              editPhone: repeatArr[i].phone,\n              editDepartment: repeatArr[i].companyPosition,\n              editMaill: repeatArr[i].email,\n              editOther: repeatArr[i].contact\n            })\n          }\n        })\n        return false\n      }\n    },\n    // $emit 监听遮罩\n    showAddContactInfo(data) {\n      this.isAddContactInfo = data\n    },\n    // 详情编辑\n    onHandleCustEdit() {\n      if (this.custEdit === '点击编辑') {\n        this.isInfoDisplay.display = 'block'\n        this.custEdit = '取消编辑'\n        this.isDisabled = false\n        this.isLabelColor = false\n        return\n      }\n      this.custEdit = '点击编辑'\n      this.isDisabled = true\n      this.isLabelColor = true\n      this.isInfoDisplay.display = 'none'\n    },\n    // 保存修改\n    onEditSave() {\n      // 客户信息\n      const asyncSubmit = new Promise(resolve => {\n        // 设置CUSTID\n        this.getFormData()\n        this.custFormData.customer.id = this.getCustDetailInfo.customer.id\n        this.custFormData.customer.companyId = this.getCustDetailInfo.customer.companyId\n        this.custFormData.customer.custIndustry =\n          this.custFormData.customer.custIndustry ||\n          this.getCustDetailInfo.customer.custIndustry // 客户行业\n        this.custFormData.customer.custLevel =\n          this.custFormData.customer.custLevel ||\n          this.getCustDetailInfo.customer.custLevel // 客户等级\n        this.custFormData.customer.custFrom =\n          this.custFormData.customer.custFrom ||\n          this.getCustDetailInfo.customer.custFrom // 客户来源\n        this.custFormData.custInvoiceInfo.custId = this.getCustDetailInfo.customer.id\n        if (this.getCustDetailInfo.mallUserNatureDtos.length > 0) {\n          this.getCustDetailInfo.mallUserNatureDtos.forEach((item, index) => {\n            console.log(index)\n            this.custFormData.mallUserNatureDtos[index].id = item.id\n          })\n        }\n        // console.log(this.custFormData.mallUserNatureDtos)\n        this.custFormData.custInvoiceInfo.id =\n          this.getCustDetailInfo.custInvoiceInfo === null\n            ? '0'\n            : this.getCustDetailInfo.custInvoiceInfo.id\n        this.custFormData.custInvoiceInfo.companyId =\n          this.getCustDetailInfo.custInvoiceInfo === null\n            ? this.getCustDetailInfo.customer.companyId\n            : this.getCustDetailInfo.custInvoiceInfo.companyId\n        resolve()\n      })\n      asyncSubmit.then(() => {\n        console.log(this.custFormData)\n        uploadCustomerAndMallUser.call(this)\n      })\n    }\n  },\n  components: {\n    EditableCell,\n    Title\n  }\n}\n",{"version":3,"sources":["AddCustomerInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddCustomerInfo.vue","sourceRoot":"src/views/customer","sourcesContent":["<template>\n  <div class=\"addCustomerInfo\">\n    <div class=\"info-title\">\n      <a-row>\n        <Title>\n          <a-col :span=\"12\">\n            <h3 class=\"prompt-title\">{{ isCategoryEdit === false ? '新建客户信息' : '客户信息详情' }}</h3>\n          </a-col>\n          <a-col :span=\"12\" class=\"categoryEdit-wrapper\" v-if=\"isCategoryEdit\">\n            <a-button size=\"small\" @click=\"onHandleCustEdit\" class=\"custEdit\">{{ custEdit }}</a-button>\n          </a-col>\n        </Title>\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">客户信息</h3>\n        </a-col>\n      </a-row>\n    </div>\n    <a-form :form=\"customerInfo\" layout=\"horizontal\" class=\"setInput\">\n      <a-row :gutter=\"16\">\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户编码\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input disabled v-decorator=\"['custCode']\" placeholder=\"客户编码自动生成\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户名称\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custName', {\n                  rules: [{ required: true, message: '请输入客户名称' }]\n                }]\"\n              placeholder=\"请输入客户名称\"\n              :disabled=\"isDisabled\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户电话\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custPhone', {\n                  rules: [{ required: true, message: '请输入客户电话' }]\n                }]\"\n              placeholder=\"请输入客户电话\"\n              :disabled=\"isDisabled\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户行业\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-select\n              v-decorator=\"['custIndustry', {rules: [{ required: true, message: '请输入客户行业' }]}]\"\n              placeholder=\"请输入客户行业\"\n              @change=\"onSelectCustIndustry\"\n              class=\"inputWidth\"\n              :class=\"{setColor: isColor}\"\n              :disabled=\"isDisabled\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" :style=\"isInfoDisplay\"/>\n              <a-select-option\n                :value=\"item.id\"\n                v-for=\"(item, index) in this.custIndustryArr\"\n                :key=\"index\"\n              >{{ item.displayValue }}</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户简称\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custAbbreviation', {\n                  rules: [{ required: true, message: '请输入客户简称' }]\n                }]\"\n              placeholder=\"客户简称\"\n              :disabled=\"isDisabled\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户经理\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-select\n              showSearch\n              labelInValue\n              placeholder=\"请输入客户经理\"\n              style=\"width: 200px\"\n              :defaultActiveFirstOption=\"false\"\n              :showArrow=\"false\"\n              :filterOption=\"false\"\n              @search=\"handleCustManagerSearch\"\n              @change=\"handleCustManagerChange\"\n              :notFoundContent=\"null\"\n              :disabled=\"isDisabled\"\n              v-decorator=\"['custManager', {\n                rules: [{ required: true, message: '请输入客户经理' }]\n              }]\"\n            >\n              <a-select-option class=\"defaultSelect\" value=\"0\">全部</a-select-option>\n              <a-select-option v-for=\"d in custManagerData\" :key=\"d.text\" :value=\"d.text\">{{ d.value }}</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"客户级别\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-select\n              class=\"inputWidth\"\n              v-decorator=\"['custLevel']\"\n              placeholder=\"请输入客户级别\"\n              @change=\"onSelectCustLevel\"\n              :disabled=\"isDisabled\"\n              :class=\"{setColor: isColor}\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" :style=\"isInfoDisplay\"/>\n              <a-select-option value=\"0\">V1</a-select-option>\n              <a-select-option value=\"1\">V2</a-select-option>\n              <a-select-option value=\"2\">V3</a-select-option>\n              <a-select-option value=\"3\">V4</a-select-option>\n              <a-select-option value=\"4\">V5</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"地址\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-cascader\n              :fieldNames=\"{ label: 'name', value: 'id', children: 'childrens' }\"\n              v-decorator=\"['custAddress']\"\n              :options=\"options\"\n              @change=\"onSelectArea\"\n              placeholder=\"请选择地址\"\n              class=\"inputWidth\"\n              :disabled=\"isDisabled\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" :style=\"isInfoDisplay\"/>\n            </a-cascader>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"详细地址\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custDetailAddress']\"\n              :disabled=\"isDisabled\"\n              placeholder=\"请输入详细地址\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"传真\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input v-decorator=\"['custFax']\" :disabled=\"isDisabled\" placeholder=\"请输入传真\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"网址\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input v-decorator=\"['custUrl']\" :disabled=\"isDisabled\" placeholder=\"请输入网址\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"来源\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-select\n              class=\"inputWidth\"\n              v-decorator=\"['custSource']\"\n              placeholder=\"请输入来源\"\n              @change=\"onSelectCustFrom\"\n              :disabled=\"isDisabled\"\n              :class=\"{setColor: isColor}\"\n            >\n              <a-icon slot=\"suffixIcon\" type=\"down\" :style=\"isInfoDisplay\"/>\n              <a-select-option value=\"0\">线上注册</a-select-option>\n              <a-select-option value=\"1\">线下注册</a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n    <!-- 联系人信息 -->\n    <a-row :gutter=\"16\">\n      <a-col :span=\"24\">\n        <h3 class=\"addCustomer-title\">联系人信息</h3>\n      </a-col>\n      <a-col :span=\"24\" style=\"margin: 10px auto 15px;\">\n        <a-table showHeader :dataSource=\"dataContact\" :columns=\"columns\" :pagination=\"false\">\n          <template\n            v-for=\"col in ['editName', 'editSex', 'editPhone', 'editDepartment', 'editMaill', 'editOther']\"\n            :slot=\"col\"\n            slot-scope=\"text, record\"\n          >\n            <div :key=\"col\">\n              <a-input\n                v-if=\"record.editable\"\n                style=\"margin: -5px 0\"\n                :value=\"text\"\n                @change=\"e => onChangeEdit(e.target.value, record.key, col)\"\n              />\n              <template v-else>{{text}}</template>\n            </div>\n          </template>\n          <!-- 编辑 -->\n          <template slot=\"operation\" slot-scope=\"text, record\">\n            <div class=\"editable-row-operations\">\n              <span v-if=\"record.editable\">\n                <a @click=\"() => save(record.key)\">保存</a> |\n                <a-popconfirm\n                  okText=\"确认\"\n                  cancelText=\"取消\"\n                  title=\"确定取消这项业务吗?\"\n                  @confirm=\"() => removeCancel(record.key)\"\n                >\n                  <a>删除</a>\n                </a-popconfirm>\n              </span>\n              <span v-else>\n                <a @click=\"() => edit(record.key)\">操作</a>\n              </span>\n            </div>\n          </template>\n        </a-table>\n        <a-button\n          class=\"editable-add-btn\"\n          style=\"margin: 10px 0; float: right;\"\n          @click=\"onAddContact\"\n          :disabled=\"isDisabled\"\n          v-show=\"!isDisabled\"\n        >添加</a-button>\n        <!-- 添加新信息 -->\n        <a-modal\n          title=\"添加\"\n          cancelText=\"取消\"\n          okText=\"确认添加\"\n          :maskClosable=\"false\"\n          :footer=\"null\"\n          :afterClose=\"closeAddInfo\"\n          :visible=\"isAddContactInfo\"\n          @ok=\"handleOkContact\"\n          @cancel=\"handleCancelContact\"\n        >\n          <EditableCell @showAddContactInfo=\"showAddContactInfo\"></EditableCell>\n        </a-modal>\n      </a-col>\n    </a-row>\n    <a-form\n      :form=\"customerInvoiceInfo\"\n      layout=\"horizontal\"\n      style=\"marginBottom: 50px;\"\n      class=\"setInput\"\n    >\n      <a-row :gutter=\"16\">\n        <a-col :span=\"24\">\n          <h3 class=\"addCustomer-title\">发票信息</h3>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"发票抬头\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input v-decorator=\"['custInvoiceUp']\" :disabled=\"isDisabled\" placeholder=\"发票抬头\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"纳税人识别号\"\n            :label-col=\"{ span: 9 }\"\n            :wrapper-col=\"{ span: 15 }\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custInvoiceNumber']\"\n              :disabled=\"isDisabled\"\n              placeholder=\"纳税人识别号\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"开户行\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input v-decorator=\"['custInvoiceBank']\" :disabled=\"isDisabled\" placeholder=\"开户行\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"开户账号\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custInvoiceAccount']\"\n              :disabled=\"isDisabled\"\n              placeholder=\"开户账号\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"开票内容\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custInvoiceContent']\"\n              :disabled=\"isDisabled\"\n              placeholder=\"开票内容\"\n            />\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"8\">\n          <a-form-item\n            label=\"联系电话\"\n            :label-col=\"formItemLayout.labelCol\"\n            :wrapper-col=\"formItemLayout.wrapperCol\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input v-decorator=\"['custInvoicePhone']\" :disabled=\"isDisabled\" placeholder=\"联系电话\"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span=\"16\">\n          <a-form-item\n            label=\"发票地址\"\n            :label-col=\"{ span: 3 }\"\n            :wrapper-col=\"{ span: 19 }\"\n            :class=\"{ setLabelColor: isLabelColor }\"\n          >\n            <a-input\n              v-decorator=\"['custInvoiceAddress']\"\n              :disabled=\"isDisabled\"\n              placeholder=\"发票地址\"\n            />\n          </a-form-item>\n        </a-col>\n      </a-row>\n    </a-form>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #e9e9e9',\n          padding: '10px 16px',\n          background: '#fff',\n          textAlign: 'right',\n          zIndex: 100\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" v-if=\"!isCategoryEdit\" type=\"primary\" :loading=\"loading\">提交</a-button>\n      <a-button\n        @click=\"onEditSave\"\n        type=\"primary\"\n        v-if=\"isCategoryEdit\"\n        :disabled=\"isDisabled\"\n        :loading=\"loading\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport EditableCell from './EditableCell'\nimport { getCustIndustry } from './getPage.js'\nimport { areas } from 'utils/area.js'\nimport { columns } from './columns.js'\nimport {\n  reduceObj,\n  subAddCust,\n  uploadCustomerAndMallUser,\n  searchAddress,\n  custManagerfetch\n} from './getPage.js'\nimport { setTimeout, clearTimeout } from 'timers'\nimport Title from 'utils/Title.vue'\n\nconst formItemLayout = {\n  labelCol: { span: 8 },\n  wrapperCol: { span: 14 }\n}\n\nexport default {\n  name: 'AddCustomerInfo',\n  data() {\n    return {\n      customerInfo: this.$form.createForm(this),\n      customerInvoiceInfo: this.$form.createForm(this),\n      isVisible: true,\n      formItemLayout,\n      options: areas,\n      dataContact: [],\n      getDataContact: [],\n      custIndustryArr: [], // 行业字典表\n      columns,\n      // 编辑添加弹出层\n      isAddContactInfo: false,\n      timer: null,\n      // 表单提交\n      loading: false,\n      custFormData: {\n        mallUserNatureDtos: [], // 添加联系人数组\n        custInvoiceInfo: {\n          companyId: '', // 厂家ID\n          createTime: '', // 创建时间\n          custId: '', //  供应商ID\n          creatorId: '', // 创建人ID\n          deleted: '', // 已删除(0未删1已删)\n          id: '0', // 已删除(0未删1已删)\n          iiAccountName: '', // 账户名\n          iiAddress: '', // 收票地址\n          iiBank: '', // 开户行\n          iiCompanyName: '', // 发票抬头\n          iiContact: '', // 联系方式\n          iiLinkman: '', // 收票联系人\n          iiTaxContent: '', // 开票内容\n          iiTaxpayerId: '', // 纳税人识别号\n          iiType: 0, // 发票类型\n          modifierId: '', // 修改人\n          modifyTime: '' // 修改时间\n        },\n        customer: {\n          companyId: '', // 厂家ID\n          custArea: '', // 客户所属区\n          custCity: '', // 客户所属市\n          custCode: '', // 客户编码\n          custDetailAddr: '', // 客户详细地址,\n          custFax: '', // 公司传真\n          custFrom: '', // 来源0线上注册，1线下注册\n          custIndustry: '', // 客户行业(字典表选择)\n          custLevel: '', // 客户级别0普通，1一般，2重点，3vip\n          custManager: '', // 客户经理 （厂家为公司服务的人员从后台录入）\n          custManagerId: 0, // 客户经理ID （厂家为公司服务的人员从后台录入）\n          custName: '', // 客户名称\n          custPhone: '', // 客户电话\n          custProvince: '', // 客户所属省\n          custShortName: '', // 客户简称\n          custStatus: '', // 状态0无购买记录 1有\n          custType: 0, // 类型0正常1虚拟添加\n          custWebsite: '', // 公司网址\n          id: '0' // 已删除(0未删1已删)\n        }\n      },\n      getCustDetailInfo: '',\n      custEdit: '点击编辑',\n      isDisabled: false,\n      getcustIndustry: '',\n      isInfoDisplay: {\n        display: 'block'\n      },\n      isColor: true,\n      isLabelColor: false,\n      // 客户经理\n      custManagerData: [],\n      custManagerValue: {}\n    }\n  },\n  props: {\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    setCustomerAndMallUser: {\n      type: Object,\n      required: true\n    }\n  },\n  created() {\n    getCustIndustry.call(this, 'INDUSTRY')\n  },\n  destroyed() {\n    clearTimeout(this.timer)\n  },\n  watch: {\n    setCustomerAndMallUser: {\n      // immediate: true,\n      handler(val) {\n        this.getCustInfo(val)\n      },\n      deep: true\n    }\n  },\n  computed: {\n    isCategoryEdit() {\n      return this.isEdit\n    },\n    reGetCustDetailInfo() {\n      return this.getCustDetailInfo\n    }\n  },\n  methods: {\n    handleCustManagerSearch(value) {\n      custManagerfetch.call(this, value, data => (this.custManagerData = data))\n    },\n    handleCustManagerChange(value) {\n      console.log(value)\n      this.custManagerValue = {\n        key: value.key.toString(),\n        label: value.label\n      }\n    },\n    // 客户详情\n    getCustInfo(val) {\n      this.getCustDetailInfo = val\n      this.isDisabled = true\n      this.isLabelColor = true\n      this.isInfoDisplay.display = 'none'\n      console.log(this.getCustDetailInfo)\n      // 省市区\n      this.timer = setTimeout(() => {\n        console.log(this.getCustDetailInfo.customer.custLevel)\n        // 客户信息\n        this.customerInfo.setFieldsValue({\n          custCode: this.getCustDetailInfo.customer.custCode, // 客户编码\n          custName: this.getCustDetailInfo.customer.custName || '无', // 客户名称\n          custPhone: this.getCustDetailInfo.customer.custPhone || '无', // 客户电话\n          custIndustry: this.getCustDetailInfo.customer.custIndustry || '无', // 客户行业\n          custAbbreviation:\n            this.getCustDetailInfo.customer.custShortName || '无', // 简称\n          custManager: {\n            key: this.getCustDetailInfo.customer.custManagerId || '',\n            label: this.getCustDetailInfo.customer.custManager || ''\n          }, // 客户经理\n          custLevel:\n            this.getCustDetailInfo.customer.custLevel === 0\n              ? 'V1'\n              : this.getCustDetailInfo.customer.custLevel === 1\n              ? 'V2'\n              : this.getCustDetailInfo.customer.custLevel === 2\n              ? 'V3'\n              : this.getCustDetailInfo.customer.custLevel === 3\n              ? 'V4'\n              : 'V5', // 客户级别\n          custAddress: [\n            this.getCustDetailInfo.customer.custProvince,\n            this.getCustDetailInfo.customer.custCity,\n            this.getCustDetailInfo.customer.custArea\n          ], // 地址\n          custDetailAddress:\n            this.getCustDetailInfo.customer.custDetailAddr || '无', // 详细地址\n          custFax: this.getCustDetailInfo.customer.custFax || '无', // 传真\n          custUrl: this.getCustDetailInfo.customer.custWebsite || '无', // 网址\n          custSource:\n            this.getCustDetailInfo.customer.custFrom === '0'\n              ? '线上注册'\n              : '线下注册' // 来源\n        })\n        // 联系人信息\n        // this.dataContact = this.getCustDetailInfo.mallUserNatureDtos\n        this.getCustDetailInfo.mallUserNatureDtos.forEach(item => {\n          this.dataContact.push({\n            key: item.id,\n            editName: item.name,\n            editSex: item.sex === 0 ? '男' : '女',\n            editPhone: item.phone,\n            editDepartment: item.companyPosition,\n            editMaill: item.email,\n            editOther: item.contact\n          })\n        })\n        // 发票信息\n        this.customerInvoiceInfo.setFieldsValue({\n          custInvoiceAccount:\n            this.getCustDetailInfo.custInvoiceInfo.iiAccountName || '无', // 账户名\n          custInvoiceAddress:\n            this.getCustDetailInfo.custInvoiceInfo.iiAddress || '无', // 收票地址\n          custInvoiceBank:\n            this.getCustDetailInfo.custInvoiceInfo.iiBank || '无', // 开户行\n          custInvoiceUp:\n            this.getCustDetailInfo.custInvoiceInfo.iiCompanyName || '无', // 发票抬头\n          custInvoicePhone:\n            this.getCustDetailInfo.custInvoiceInfo.iiContact || '无', // 联系方式\n          custInvoiceContent:\n            this.getCustDetailInfo.custInvoiceInfo.iiTaxContent || '无', // 开票内容\n          custInvoiceNumber:\n            this.getCustDetailInfo.custInvoiceInfo.iiTaxpayerId || '无' // 纳税人识别号\n        })\n        console.log(this.dataContact)\n      }, 400)\n    },\n    // 一级新建列表遮罩显示\n    onClose() {\n      this.isVisible = false\n      this.$emit('isVisible', this.isVisible)\n    },\n    onSubmit() {\n      this.$emit('isVisible', this.isVisible)\n      // 客户信息\n      const asyncSubmit = new Promise(resolve => {\n        this.getFormData()\n        resolve()\n      })\n      asyncSubmit.then(() => {\n        subAddCust.call(this)\n      })\n    },\n    // 获取表单参数\n    getFormData() {\n      this.customerInfo.validateFields((err, value) => {\n        console.log(value)\n        if (!err) {\n          // this.custFormData.custCode = value.custCode // 客户编码\n          this.custFormData.customer.custName = value.custName // 客户名称\n          this.custFormData.customer.custPhone = value.custPhone // 客户电话\n          this.custFormData.customer.custProvince = value.custAddress[0] // 省\n          this.custFormData.customer.custCity = value.custAddress[1] // 市\n          this.custFormData.customer.custArea = value.custAddress[2] // 区\n          this.custFormData.customer.custShortName = value.custAbbreviation\n            ? value.custAbbreviation\n            : '' // 客户简称\n          this.custFormData.customer.custManager = (value.custManager.label || value.custManager.label === '全部')\n            ? value.custManager.label\n            : '' // 客户经理\n          this.custFormData.customer.custManagerId = value.custManager.key\n            ? value.custManager.key\n            : 0 // 客户经理ID\n          this.custFormData.customer.custDetailAddr = value.custDetailAddress\n            ? value.custDetailAddress\n            : '' // 详细地址\n          this.custFormData.customer.custFax = value.custFax\n            ? value.custFax\n            : '' // 传真\n          this.custFormData.customer.custWebsite = value.custUrl\n            ? value.custUrl\n            : '' // 网址\n          this.custFormData.customer.custFrom =\n            value.custSource === '线上注册' ? 0 : 1 // 来源\n          // this.dataContact 联系人数组\n          this.custFormData.mallUserNatureDtos = []\n          this.dataContact.forEach(item => {\n            console.log(item)\n            this.custFormData.mallUserNatureDtos.push({\n              id: 0,\n              companyPosition: item.editDepartment,\n              contact: item.editOther,\n              email: item.editMaill,\n              name: item.editName,\n              phone: item.editPhone,\n              sex: item.editSex === '男' ? 0 : 1\n            })\n          })\n        }\n      })\n      // 发票信息\n      this.customerInvoiceInfo.validateFields((err, value) => {\n        if (!err) {\n          this.custFormData.custInvoiceInfo.iiCompanyName = value.custInvoiceUp\n            ? value.custInvoiceUp\n            : '' // 发票抬头\n          this.custFormData.custInvoiceInfo.iiTaxpayerId = value.custInvoiceNumber\n            ? value.custInvoiceNumber\n            : '' // 纳税人识别号\n          this.custFormData.custInvoiceInfo.iiBank = value.custInvoiceBank\n            ? value.custInvoiceBank\n            : '' // 开户行\n          this.custFormData.custInvoiceInfo.iiAccountName = value.custInvoiceAccount\n            ? value.custInvoiceAccount\n            : '' // 开户账号\n          this.custFormData.custInvoiceInfo.iiTaxContent = value.custInvoiceContent\n            ? value.custInvoiceContent\n            : '' // 开票内容\n          this.custFormData.custInvoiceInfo.iiContact = value.custInvoicePhone\n            ? value.custInvoicePhone\n            : '' // 联系电话\n          this.custFormData.custInvoiceInfo.iiAddress = value.custInvoiceAddress\n            ? value.custInvoiceAddress\n            : '' // 发票地址\n          console.info(value)\n        }\n      })\n    },\n    // 客户行业\n    onSelectCustIndustry(value) {\n      console.log(value)\n      this.custFormData.customer.custIndustry = value // 客户行业\n    },\n    // 客户等级\n    onSelectCustLevel(value) {\n      console.log(value)\n      this.custFormData.customer.custLevel = value // 客户行业\n    },\n    // 客户来源\n    onSelectCustFrom(value) {\n      this.custFormData.customer.custFrom = value // 客户行业\n      console.log(this.custFormData.customer.custFrom)\n    },\n    // 地址选择\n    onSelectArea(value, selectedOptions) {\n      console.log(value)\n      this.custFormData.customer.custProvince = ''\n      this.custFormData.customer.custCity = ''\n      this.custFormData.customer.custArea = ''\n      if (value.length === 1) {\n        this.custFormData.customer.custProvince = value[0]\n        console.log(this.custFormData)\n        return false\n      }\n      if (value.length === 2) {\n        this.custFormData.customer.custProvince = value[0]\n        this.custFormData.customer.custCity = value[1]\n        console.log(this.custFormData)\n        return false\n      }\n      if (value.length === 3) {\n        this.custFormData.customer.custProvince = value[0]\n        this.custFormData.customer.custCity = value[1]\n        this.custFormData.customer.custArea = value[2]\n        console.log(this.custFormData)\n        return false\n      }\n    },\n    // 联系人信息\n    onDeleteContact(key) {\n      const dataSource = [...this.dataSource]\n      this.dataSource = dataSource.filter(item => {\n        console.log(item)\n        return item.key !== key\n      })\n    },\n    onEditContact(key) {\n      console.log(key)\n    },\n    // 监听table修改状态\n    onChangeEdit(value, key, column) {\n      console.log(value, key, column)\n      const newData = [...this.dataContact]\n      const target = this.dataContact.filter(item => key === item.key)[0]\n      console.log(target)\n      if (target) {\n        target[column] = value\n        this.Contact = newData\n      }\n    },\n    // 编辑\n    edit(key) {\n      if (!this.isDisabled) {\n        const newData = [...this.dataContact]\n        const target = newData.filter(item => key === item.key)[0]\n        if (target) {\n          target.editable = true\n          this.dataContact = newData\n        }\n      }\n    },\n    // 保存\n    save(key) {\n      const newData = [...this.dataContact]\n      const target = newData.filter(item => key === item.key)[0]\n      if (target) {\n        delete target.editable\n        this.dataContact = newData\n        console.log(this.dataContact)\n      }\n    },\n    // 删除\n    removeCancel(key) {\n      const newData = [...this.dataContact]\n      this.dataContact = newData.filter(item => item.key !== key)\n    },\n    // 联系人添加遮罩\n    onAddContact() {\n      this.isAddContactInfo = true\n    },\n    handleOkContact(e) {\n      setTimeout(() => {\n        this.isAddContactInfo = false\n      }, 2000)\n    },\n    handleCancelContact(e) {\n      console.log('Clicked cancel button')\n      this.isAddContactInfo = false\n    },\n    // 添加信息详情关闭回调\n    closeAddInfo() {\n      if (this.$store.state.custEditableInfo) {\n        this.getDataContact.push(this.$store.state.custEditableInfo)\n        console.log(this.getDataContact)\n        const repeatArr = reduceObj.call(this, this.getDataContact)\n        // 防止同步加载阻塞\n        this.$nextTick(() => {\n          // 修改时记录详情数据\n          if (this.isDisabled === true) {\n            this.dataContact = []\n          }\n          if (this.isDisabled === false) {\n            this.dataContact = [...this.getCustDetailInfo.mallUserNatureDtos]\n          }\n          for (let i = 0; i < repeatArr.length; i++) {\n            this.dataContact.push({\n              key: i.toString(),\n              editName: repeatArr[i].name,\n              editSex: repeatArr[i].sex === '0' ? '男' : '女',\n              editPhone: repeatArr[i].phone,\n              editDepartment: repeatArr[i].companyPosition,\n              editMaill: repeatArr[i].email,\n              editOther: repeatArr[i].contact\n            })\n          }\n        })\n        return false\n      }\n    },\n    // $emit 监听遮罩\n    showAddContactInfo(data) {\n      this.isAddContactInfo = data\n    },\n    // 详情编辑\n    onHandleCustEdit() {\n      if (this.custEdit === '点击编辑') {\n        this.isInfoDisplay.display = 'block'\n        this.custEdit = '取消编辑'\n        this.isDisabled = false\n        this.isLabelColor = false\n        return\n      }\n      this.custEdit = '点击编辑'\n      this.isDisabled = true\n      this.isLabelColor = true\n      this.isInfoDisplay.display = 'none'\n    },\n    // 保存修改\n    onEditSave() {\n      // 客户信息\n      const asyncSubmit = new Promise(resolve => {\n        // 设置CUSTID\n        this.getFormData()\n        this.custFormData.customer.id = this.getCustDetailInfo.customer.id\n        this.custFormData.customer.companyId = this.getCustDetailInfo.customer.companyId\n        this.custFormData.customer.custIndustry =\n          this.custFormData.customer.custIndustry ||\n          this.getCustDetailInfo.customer.custIndustry // 客户行业\n        this.custFormData.customer.custLevel =\n          this.custFormData.customer.custLevel ||\n          this.getCustDetailInfo.customer.custLevel // 客户等级\n        this.custFormData.customer.custFrom =\n          this.custFormData.customer.custFrom ||\n          this.getCustDetailInfo.customer.custFrom // 客户来源\n        this.custFormData.custInvoiceInfo.custId = this.getCustDetailInfo.customer.id\n        if (this.getCustDetailInfo.mallUserNatureDtos.length > 0) {\n          this.getCustDetailInfo.mallUserNatureDtos.forEach((item, index) => {\n            console.log(index)\n            this.custFormData.mallUserNatureDtos[index].id = item.id\n          })\n        }\n        // console.log(this.custFormData.mallUserNatureDtos)\n        this.custFormData.custInvoiceInfo.id =\n          this.getCustDetailInfo.custInvoiceInfo === null\n            ? '0'\n            : this.getCustDetailInfo.custInvoiceInfo.id\n        this.custFormData.custInvoiceInfo.companyId =\n          this.getCustDetailInfo.custInvoiceInfo === null\n            ? this.getCustDetailInfo.customer.companyId\n            : this.getCustDetailInfo.custInvoiceInfo.companyId\n        resolve()\n      })\n      asyncSubmit.then(() => {\n        console.log(this.custFormData)\n        uploadCustomerAndMallUser.call(this)\n      })\n    }\n  },\n  components: {\n    EditableCell,\n    Title\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.addCustomerInfo {\n  .setInput {\n    .ant-form-item {\n      .inputSpace();\n    }\n    /deep/ .ant-form-item-label {\n      .labelWidth();\n    }\n    .ant-input,\n    .inputWidth {\n      .inputWidth();\n    }\n    .setColor {\n      color: #333;\n    }\n    .setLabelColor {\n      /deep/ .ant-form-item-label label {\n        .labelColor();\n      }\n    }\n  }\n  .addCustomer-title {\n    .h3_title();\n  }\n  .info-title {\n    .prompt-title {\n      .prompt-title();\n    }\n  }\n  .custEdit {\n    float: right;\n    margin-bottom: 10px;\n  }\n  .custDetailCustInfo {\n    margin-bottom: 30px;\n  }\n  .custdetailInvoicInfo {\n    margin-bottom: 30px;\n  }\n}\n</style>\n"]}]}