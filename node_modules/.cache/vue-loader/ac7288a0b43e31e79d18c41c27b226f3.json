{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/craft/craftLine/child_info/CraftLineInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/src/views/product/craft/craftLine/child_info/CraftLineInfo.vue","mtime":1559010775495},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-project/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport LineDiagram from '@/components/line_diagram/LineDiagram.vue'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport { columnsInfo } from '../basic_lib/column'\nimport { craftLineAdd, craftLineUpdate } from '../basic_lib/index'\n\nexport default {\n  name: 'CarftLineInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      processFormInfo: this.$form.createForm(this),\n      data: [],\n      columnsInfo,\n      craftProcessIds: '', // 工序流程图ID集合\n      getCraftLineInfo: {},\n      newData: [],\n      childCraftList: []\n    }\n  },\n  props: {\n    craftLineInfo: {\n      type: Object,\n      default: {}\n    }\n  },\n  methods: {\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData(null, craftLineAdd)\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData(this.getCraftLineInfo.id, craftLineUpdate)\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      // deleteCategory.call(this, this.viewCategoryInfo.id).then(() => {\n      this.$emit('isDrawer', val)\n      // })\n    },\n    // 接受子组件tabList 删除\n    deleteTabList(val) {\n      this.data.splice(val, 1)\n    },\n    // $emit Tablist\n    setCraftList(val) {\n      this.data.push(val)\n    },\n    // Form Data\n    getFormData(id, postFormData) {\n      console.log(this.data)\n      this.data.forEach(e => {\n        if (e.key) {\n          this.craftProcessIds += `${e.key},`\n        }\n        if (e.id) {\n          this.craftProcessIds += `${e.id},`\n        }\n      })\n      this.processFormInfo.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          const params = {\n            // groupCode: values.craftLineCode, // code\n            id,\n            craftProcessIds: this.craftProcessIds.slice(0, -1), // 工序流程图ID\n            groupName: values.craftLineName, // 工艺名称\n            status: values.craftLineStatus // 状态\n          }\n          postFormData.call(this, params)\n          // this.craftProcessIds = []\n        }\n      })\n    },\n    setFormData() {\n      this.processFormInfo.setFieldsValue({\n        // groupCode: values.craftLineCode, // code\n        craftLineName: this.getCraftLineInfo.groupName, // 工艺名称\n        craftLineStatus: this.getCraftLineInfo.status // 状态\n      })\n    }\n  },\n  watch: {\n    craftLineInfo: {\n      handler(val) {\n        console.log(val)\n        this.getCraftLineInfo = val\n        this.newData = []\n        this.childCraftList = []\n        if (val.map || val.craftProcessIds) {\n          // 序列化所有工序对象Tab列表\n          for (let obj in val.map) {\n            this.newData.push(val.map[obj])\n          }\n          // 通过工艺ID获取所对应的工序对象\n          val.craftProcessIds.split(',').forEach(e => {\n            const getCraftProcessIds = this.newData.filter(i => {\n              return i.id === e\n            })[0]\n            this.data.push(getCraftProcessIds)\n            // 孙组件 props\n            this.childCraftList.push(getCraftProcessIds)\n          })\n          console.log(this.data)\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'line-diagram': LineDiagram\n  }\n}\n",{"version":3,"sources":["CraftLineInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CraftLineInfo.vue","sourceRoot":"src/views/product/craft/craftLine/child_info","sourcesContent":["<template>\n  <div class=\"carftLine-info\">\n    <prompt-title @isDisabled=\"isDisabled\" @isDelete=\"isDelete\"></prompt-title>\n    <a-row>\n      <a-col :span=\"24\">\n        <h3 class=\"carftLine-title\">工艺路线</h3>\n      </a-col>\n      <a-col :span=\"24\">\n        <a-form :form=\"processFormInfo\" layout=\"horizontal\" hideRequiredMark>\n          <a-row>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"工艺编码\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-input\n                  v-if=\"disabled\"\n                  disabled=\"disabled\"\n                  v-decorator=\"['craftLineCode']\"\n                  placeholder=\"默认带出\"\n                />\n                <template v-else=\"disabled\">{{getCraftLineInfo.groupCode}}</template>\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"工艺名称\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-input v-if=\"disabled\" v-decorator=\"['craftLineName']\" placeholder=\"请输入工艺名称\"/>\n                <template v-else=\"disabled\">{{getCraftLineInfo.groupName}}</template>\n              </a-form-item>\n            </a-col>\n            <a-col :span=\"8\">\n              <a-form-item\n                label=\"状态\"\n                :class=\"{labelColor: isLabelColor}\"\n                :label-col=\"labelCol\"\n                :wrapper-col=\"wrapperCol\"\n              >\n                <a-switch\n                  v-if=\"disabled\"\n                  v-decorator=\"['craftLineStatus', { initialValue: false, valuePropName: 'checked' }]\"\n                />\n                <template v-else=\"disabled\">{{getCraftLineInfo.status ? '已发布' : '未发布'}}</template>\n              </a-form-item>\n            </a-col>\n          </a-row>\n        </a-form>\n      </a-col>\n    </a-row>\n    <a-row style=\"marginBottom: 50px;\">\n      <a-col :span=\"24\">\n        <h3 class=\"carftLine-title\">工序列表</h3>\n      </a-col>\n      <a-col :span=\"24\" style=\"margin-bottom: 15px;\">\n        <line-diagram\n          @deleteTabList=\"deleteTabList\"\n          @setCraftList=\"setCraftList\"\n          :childCraftList=\"childCraftList\"\n        />\n      </a-col>\n      <a-col :span=\"24\">\n        <a-table\n          :rowKey=\"record => Math.random(record.key)\"\n          :columns=\"columnsInfo\"\n          :dataSource=\"data\"\n          :pagination=\"false\"\n        >\n          <template slot=\"qc\" slot-scope=\"text, record, index\">\n            <span>{{text ? '是' : '否'}}</span>\n          </template>\n          <template slot=\"optBook\" slot-scope=\"text, record, index\">\n            <a v-if=\"text\" :href=\"text\">文件</a>\n            <a v-else=\"text\">无</a>\n          </template>\n        </a-table>\n      </a-col>\n    </a-row>\n    <div\n      :style=\"{\n          position: 'absolute',\n          left: 0,\n          bottom: 0,\n          width: '100%',\n          borderTop: '1px solid #E9E9E9',\n          padding: '10px 16px',\n          background: '#FFF',\n          textAlign: 'right',\n          zIndex: 100\n        }\"\n    >\n      <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\">取消</a-button>\n      <a-button @click=\"onSubmit\" type=\"primary\" :loading=\"loading\" v-if=\"isEdit\">提交</a-button>\n      <a-button\n        @click=\"onSave\"\n        type=\"primary\"\n        :disabled=\"!disabled\"\n        :loading=\"loading\"\n        v-else=\"!isEdit\"\n      >保存</a-button>\n    </div>\n  </div>\n</template>\n<script>\nimport PromptTitle from '@/components/tools/prompt/PromptTitle'\nimport LineDiagram from '@/components/line_diagram/LineDiagram.vue'\nimport { mixinBasic, mixinIsEdit } from '@/components/tools/mixin/mixin'\nimport { columnsInfo } from '../basic_lib/column'\nimport { craftLineAdd, craftLineUpdate } from '../basic_lib/index'\n\nexport default {\n  name: 'CarftLineInfo',\n  mixins: [mixinBasic, mixinIsEdit],\n  data() {\n    return {\n      processFormInfo: this.$form.createForm(this),\n      data: [],\n      columnsInfo,\n      craftProcessIds: '', // 工序流程图ID集合\n      getCraftLineInfo: {},\n      newData: [],\n      childCraftList: []\n    }\n  },\n  props: {\n    craftLineInfo: {\n      type: Object,\n      default: {}\n    }\n  },\n  methods: {\n    // 提交\n    onSubmit(e) {\n      e.preventDefault()\n      this.getFormData(null, craftLineAdd)\n    },\n    // 保存修改\n    onSave(e) {\n      e.preventDefault()\n      this.getFormData(this.getCraftLineInfo.id, craftLineUpdate)\n    },\n    // 编辑 || 取消\n    isDisabled(val) {\n      const edit = new Promise(resolved => {\n        // Input选中\n        this.disabled = !val\n        // label color\n        this.isLabelColor = !this.isLabelColor\n        resolved()\n      })\n      edit.then(() => {\n        if (this.disabled) {\n          this.setFormData()\n        }\n      })\n    },\n    // 删除\n    isDelete(val) {\n      // deleteCategory.call(this, this.viewCategoryInfo.id).then(() => {\n      this.$emit('isDrawer', val)\n      // })\n    },\n    // 接受子组件tabList 删除\n    deleteTabList(val) {\n      this.data.splice(val, 1)\n    },\n    // $emit Tablist\n    setCraftList(val) {\n      this.data.push(val)\n    },\n    // Form Data\n    getFormData(id, postFormData) {\n      console.log(this.data)\n      this.data.forEach(e => {\n        if (e.key) {\n          this.craftProcessIds += `${e.key},`\n        }\n        if (e.id) {\n          this.craftProcessIds += `${e.id},`\n        }\n      })\n      this.processFormInfo.validateFields((err, values) => {\n        if (!err) {\n          console.log(values)\n          const params = {\n            // groupCode: values.craftLineCode, // code\n            id,\n            craftProcessIds: this.craftProcessIds.slice(0, -1), // 工序流程图ID\n            groupName: values.craftLineName, // 工艺名称\n            status: values.craftLineStatus // 状态\n          }\n          postFormData.call(this, params)\n          // this.craftProcessIds = []\n        }\n      })\n    },\n    setFormData() {\n      this.processFormInfo.setFieldsValue({\n        // groupCode: values.craftLineCode, // code\n        craftLineName: this.getCraftLineInfo.groupName, // 工艺名称\n        craftLineStatus: this.getCraftLineInfo.status // 状态\n      })\n    }\n  },\n  watch: {\n    craftLineInfo: {\n      handler(val) {\n        console.log(val)\n        this.getCraftLineInfo = val\n        this.newData = []\n        this.childCraftList = []\n        if (val.map || val.craftProcessIds) {\n          // 序列化所有工序对象Tab列表\n          for (let obj in val.map) {\n            this.newData.push(val.map[obj])\n          }\n          // 通过工艺ID获取所对应的工序对象\n          val.craftProcessIds.split(',').forEach(e => {\n            const getCraftProcessIds = this.newData.filter(i => {\n              return i.id === e\n            })[0]\n            this.data.push(getCraftProcessIds)\n            // 孙组件 props\n            this.childCraftList.push(getCraftProcessIds)\n          })\n          console.log(this.data)\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  components: {\n    'prompt-title': PromptTitle,\n    'line-diagram': LineDiagram\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n@import '~styles/variable.less';\n\n.carftLine-info {\n  .carftLine-title {\n    margin-bottom: 16px;\n    .h3_title();\n  }\n  .labelColor {\n    /deep/ .ant-form-item-label label {\n      .labelColor();\n    }\n  }\n}\n</style>\n"]}]}