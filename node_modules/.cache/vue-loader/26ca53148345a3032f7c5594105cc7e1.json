{"remainingRequest":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue?vue&type=style&index=0&id=2ac0627c&lang=less&scoped=true&","dependencies":[{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/src/views/sale/orderList/basic_lib/EditableCell.vue","mtime":1565252860549},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/less-loader/dist/cjs.js","mtime":1556420627437},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuyalong/myProjects/lianzhiyun/projects/web-projects/platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.product-list {\n  margin-bottom: 4px;\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  align-content: center;\n  font-size: 12px;\n  &-left {\n    img {\n      width: 50px;\n      height: 50px;\n      vertical-align: middle;\n    }\n  }\n  &-right {\n    text-align: left;\n    margin-left: 10px;\n    &-name {\n      font-size: 14px;\n      font-weight: 600;\n    }\n  }\n}\n.product-list::after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  bottom: -2px;\n  width: 100%;\n  height: 1px;\n  background-color: #ddd;\n}\n",{"version":3,"sources":["EditableCell.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditableCell.vue","sourceRoot":"src/views/sale/orderList/basic_lib","sourcesContent":["<template>\n  <a-form :form=\"form\">\n    <a-form-item label=\"产品编码\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-select\n        style=\"width:280px\"\n        showSearch\n        :value=\"value\"\n        :showArrow=\"false\"\n        :filterOption=\"false\"\n        :defaultActiveFirstOption=\"false\"\n        :dropdownMatchSelectWidth=\"false\"\n        @search=\"handleSelect\"\n        @change=\"(val)=>{inputChange(val)}\"\n        @popupScroll=\"e=>currentPageChange(e)\"\n      >\n        <a-select-option v-for=\"(item,index) in listCustomerGoods\" :key=\"index\">\n          <div class=\"product-list\">\n            <div class=\"product-list-left\">\n              <img :src=\"item.skuPic\" />\n            </div>\n            <div class=\"product-list-right\">\n              <div class=\"product-list-right-name\">{{item.name}}</div>\n              <div>{{item.code}}</div>\n              <div>{{item.spec}} - {{item.cz}} - {{item.drawNum}}</div>\n            </div>\n          </div>\n        </a-select-option>\n      </a-select>\n    </a-form-item>\n    <a-form-item label=\"订单数量\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odNumber',{rules: [{ required: true, message: '请输入订单数量' }, {validator: odNumberRegx}],initialValue:sku.odNumber}]\"\n        @change=\"(e)=>{inputnumChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">{{sku.unit}}</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"产品单价\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input\n        style=\"width:280px\"\n        v-decorator=\"['sku.odSkuCustPrice',{initialValue:sku.odSkuCustPrice}]\"\n        @change=\"(e)=>{inputPriceChange(e.target.value)}\"\n      >\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"订单总计\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odAmount',{initialValue:sku.odAmount}]\">\n        <span slot=\"addonAfter\">元</span>\n      </a-input>\n    </a-form-item>\n    <a-form-item label=\"采购单号：\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-input style=\"width:280px\" v-decorator=\"['sku.odPurchaseOrderno']\" />\n    </a-form-item>\n    <a-form-item label=\"要求交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odRequireDueDate']\" />\n    </a-form-item>\n    <a-form-item label=\"承诺交期\" :label-col=\"labelCol\" :wrapper-col=\"wrapperCol\">\n      <a-date-picker style=\"width:280px\" v-decorator=\"['sku.odPromiseDueDate']\" />\n    </a-form-item>\n    <a-form-item :style=\"{ textAlign: 'center' }\">\n      <a-button :style=\"{ marginRight: '8px' }\" @click=\"handleReset\">取消</a-button>\n      <a-button type=\"primary\" @click=\"handleEditableInfo\">确认添加</a-button>\n    </a-form-item>\n  </a-form>\n</template>\n<script>\nimport { get } from '@/api/axios.js'\nimport api from '@/api/index.js'\nimport { mixinCurrentPage } from '@/views/sale/mixin/minxinSale'\nimport moment from 'moment'\nexport default {\n  mixins: [mixinCurrentPage],\n  props: {\n    custId: {\n      type: String\n    }\n  },\n  data() {\n    return {\n      form: this.$form.createForm(this),\n      customerGoodsPages: 0,\n      currentPage: 1,\n      labelCol: { span: 6, offset: 0 },\n      wrapperCol: { span: 16 },\n      sku: {\n        skuId: '',\n        code: undefined,\n        odSkuName: '',\n        odSpec: '',\n        taxRate: 0,\n        odSkuCustPrice: '',\n        odAmount: '',\n        odSkuCustCode: '', // 客户产品编码\n        unit: ''\n      },\n      value: '',\n      codeKey: '',\n      timer: '',\n      listCustomerGoods: [] // 商品信息\n    }\n  },\n  created() {\n    this.getListCompanyCustomGoods()\n  },\n  methods: {\n    moment,\n    inputChange(val) {\n      const listCustomerGoods = this.listCustomerGoods[val]\n      this.value = `${listCustomerGoods.code}-${listCustomerGoods.name}`\n      this.form.resetFields('sku.odNumber')\n      this.sku.odAmount = ''\n      this.sku.odSkuCustPrice = ''\n      get(api.getSkuPrice + `/${listCustomerGoods.id}/${this.custId}`).then(res => {\n        if (res.data.code === 0) {\n          const data = res.data.data\n          const skuCustPrice = data.skuCustPrice\n          this.sku.odSkuName = data.name\n          this.sku.odSpec = data.spec\n          this.sku.taxRate = data.taxRate\n          this.sku.odSkuCustPrice = skuCustPrice.length ? skuCustPrice[0].price : data.price\n          this.sku.code = data.code\n          this.sku.odSkuCustCode = data.skuCustInfo ? data.skuCustInfo.custSkuCode : ''\n          this.sku.skuId = data.id\n          this.sku.unit = data.unit\n        }\n      })\n    },\n    // 订单数量变化\n    inputnumChange(val) {\n      const price = this.form.getFieldValue('sku.odSkuCustPrice')\n      let total = 0\n      total = Number((Number(price) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    // 产品价格变化\n    inputPriceChange(val) {\n      const num = this.form.getFieldValue('sku.odNumber')\n      let total = 0\n      total = Number((Number(num) * Number(val)).toString().match(/^\\d+(?:\\.\\d{0,2})?/))\n      this.sku.odAmount = total\n    },\n    handleEditableInfo(e) {\n      e.preventDefault()\n      if (!this.value) {\n        this.$message.warning('请选择产品')\n        return\n      }\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          const val = {\n            'odRequireDueDate': values.sku.odRequireDueDate ? values.sku.odRequireDueDate.format('YYYY-MM-DD') : '',\n            'odPromiseDueDate': values.sku.odPromiseDueDate ? values.sku.odPromiseDueDate.format('YYYY-MM-DD') : '',\n            'odAmount': values.sku.odAmount,\n            'odNumber': values.sku.odNumber,\n            'odSkuCustPrice': values.sku.odSkuCustPrice,\n            'odPurchaseOrderno': values.sku.odPurchaseOrderno\n          }\n          const data = {}\n          const backData = { ...this.sku, ...val }\n          data.isAddContactInfo = false\n          data.sku = backData\n          this.$emit('showAddContactInfo', data)\n          for (const i in this.sku) {\n            this.sku[i] = ''\n          }\n          this.form.resetFields()\n        }\n      })\n    },\n    handleReset() {\n      var data = {}\n      data.isAddContactInfo = false\n      for (const i in this.sku) {\n        this.sku[i] = ''\n      }\n      this.form.resetFields()\n      this.$emit('showAddContactInfo', data)\n    },\n    currentPageChange(e) {\n      const resut = this.getCurrentPageChange(e)\n      if (resut) {\n        this.getListCompanyCustomGoods(this.currentPage)\n      }\n    },\n    handleSelect(value) {\n      if (this.timer !== '') {\n        clearTimeout(this.timer)\n      }\n      this.timer = setTimeout(() => {\n        this.customerGoodsPages = 0\n        this.currentPage = 1\n        this.listCustomerGoods = []\n        this.codeKey = value\n        this.getListCompanyCustomGoods()\n      }, 500)\n    },\n    /**\n     * @description 列表商家对客户的定制商品基本信息\n     * @description 客户已经有的商品排在前面 先获取列表商家对客户的定制商品基本信息 如果数据少于预定的pagesize数量则再获取商家的所有产品\n     */\n    getListCompanyCustomGoods(currentPage = 1, pageSize = 20) {\n      if (currentPage >= this.customerGoodsPages && this.customerGoodsPages !== 0) {\n        return\n      }\n      get(api.getListCompanyCustomGoods, { key: this.codeKey, skuType: 'SPRING', currentPage, pageSize, custId: this.custId }).then(res => {\n        const listCustomerGoods = res.data.data.records\n        this.listCustomerGoods = this.listCustomerGoods.concat(listCustomerGoods)\n        this.currentPage += 1\n        this.customerGoodsPages = Number(res.data.data.pages)\n      })\n    },\n    odNumberRegx(rule, value, callback) {\n      if (value && value <= 0) {\n        callback('购买数量不能为0')\n      } else {\n        callback()\n      }\n    }\n  }\n}\n</script>\n\n<style lang='less' scoped>\n.product-list {\n  margin-bottom: 4px;\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  align-content: center;\n  font-size: 12px;\n  &-left {\n    img {\n      width: 50px;\n      height: 50px;\n      vertical-align: middle;\n    }\n  }\n  &-right {\n    text-align: left;\n    margin-left: 10px;\n    &-name {\n      font-size: 14px;\n      font-weight: 600;\n    }\n  }\n}\n.product-list::after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  bottom: -2px;\n  width: 100%;\n  height: 1px;\n  background-color: #ddd;\n}\n</style>\n"]}]}