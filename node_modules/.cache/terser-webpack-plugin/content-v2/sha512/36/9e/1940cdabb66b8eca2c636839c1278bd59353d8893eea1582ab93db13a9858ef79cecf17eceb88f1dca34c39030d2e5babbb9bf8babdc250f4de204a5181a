{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-10089e4a\"],{\"20c4\":function(t,e,i){\"use strict\";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(\"a-form\",{attrs:{layout:\"inline\"}},[i(\"a-row\",{staticClass:\"search\"},[i(\"a-form-item\",{attrs:{label:\"规格\",\"label-col\":t.labelCol,\"wrapper-col\":t.wrapperCol}},[i(\"a-select\",{staticStyle:{width:\"200px\"},attrs:{showSearch:\"\",allowClear:\"\",showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1},on:{search:function(e){return t.handleSelectChange(e,\"spec\")},change:function(e){t.inputChange(e,\"spec\")},popupScroll:function(e){return t.currentPageChange(e,\"spec\")}}},t._l(t.odSpecList,function(e){return i(\"a-select-option\",{key:e},[t._v(t._s(e))])}),1)],1),i(\"a-form-item\",{attrs:{label:\"交期\",\"label-col\":t.labelCol,\"wrapper-col\":t.wrapperCol}},[i(\"a-range-picker\",{staticStyle:{width:\"200px\"},attrs:{format:\"YYYY-MM-DD\"},on:{change:function(e,i){t.inputChange(i,\"date\")}}})],1),i(\"a-form-item\",{attrs:{label:\"材质\",\"label-col\":t.labelCol,\"wrapper-col\":t.wrapperCol}},[i(\"a-select\",{staticStyle:{width:\"200px\"},attrs:{showSearch:\"\",allowClear:\"\",showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1},on:{search:function(e){return t.handleSelectChange(e,\"cz\")},change:function(e){t.inputChange(e,\"cz\")},popupScroll:function(e){return t.currentPageChange(e,\"cz\")}}},t._l(t.textures,function(e){return i(\"a-select-option\",{key:e},[t._v(t._s(e))])}),1)],1)],1)],1)},n=[],s=i(\"c1df\"),o=i.n(s),c=i(\"cd34\"),r=i(\"75cd\"),l={mixins:[c[\"a\"],r[\"b\"],r[\"c\"]],props:[\"companyType\"],data:function(){return{timer:\"\",data:{cz:\"\",spec:\"\",startTime:\"\",endTime:\"\"}}},created:function(){this.getCz(),this.getSpec()},methods:{moment:o.a,inputChange:function(t,e){var i=this;this.dataCompany=[];var a=this.data;\"date\"===e?(a.startTime=t[0],a.endTime=t[1]):a[e]=t,\"\"!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.$emit(\"changeInput\",i.data)},500)},currentPageChange:function(t,e){var i=this.getCurrentPageChange(t);i&&(\"cz\"===e?this.getCz(this.czCurrentPage):\"spec\"===e&&this.getSpec(this.specCurrentPage))},handleSelectChange:function(t,e){var i=this;\"\"!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){\"cz\"===e?(i.textures=[],i.texturesValue=t,i.getCz()):(i.odSpecList=[],i.odSpecListValue=t,i.getSpec())},500)},getCz:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;\"FACTORY\"===this.companyType?this.getFactoryPolicyOrderCz(t):this.getListCompanySpringCz(t)},getSpec:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;\"FACTORY\"===this.companyType?this.getFactoryPolicyOrderSpec(t):this.getListCompanySpringSpecs(t)}}},d=l,u=i(\"2877\"),m=Object(u[\"a\"])(d,a,n,!1,null,null,null);e[\"a\"]=m.exports},\"475f\":function(t,e,i){\"use strict\";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(\"div\",{staticClass:\"dispatch\"},[i(\"a-row\",[i(\"a-col\",{staticClass:\"dispatch-left\",attrs:{span:12}},[i(\"inputSearch\",{attrs:{companyType:t.companyType},on:{changeInput:t.changeInput}}),i(\"div\",{staticClass:\"order-list\"},[i(\"div\",{directives:[{name:\"infinite-scroll\",rawName:\"v-infinite-scroll\",value:t.handleInfiniteOnLoad,expression:\"handleInfiniteOnLoad\"}],staticClass:\"order-list-item demo-infinite-container\",attrs:{\"infinite-scroll-disabled\":t.busy,\"infinite-scroll-distance\":10}},[i(\"a-list\",{attrs:{dataSource:t.dataCompany},scopedSlots:t._u([{key:\"renderItem\",fn:function(e,a){return i(\"a-list-item\",{},[i(\"div\",{staticClass:\"list-item\",on:{click:function(i){return t.addCompany(e.channelSkuId,a,e.number,e.odRequireDueDate)}}},[i(\"div\",{staticClass:\"item-left\"},[i(\"div\",{staticClass:\"item-left-top\"},[i(\"a\",{attrs:{href:\"javascript:;\"},on:{click:function(i){return t.infoView(i,e.channelSkuId,a)}}},[t._v(t._s(e.name))]),i(\"span\",[t._v(t._s(e.bom)+\" \"+t._s(e.craft))])]),i(\"ul\",{staticClass:\"item-left-desc\"},[i(\"li\",[t._v(t._s(e.spec))]),i(\"li\",[t._v(t._s(e.cz))]),i(\"li\",[t._v(t._s(e.odRequireDueDate?t.moment(e.odRequireDueDate).format(t.dateFormat):\"\"))]),i(\"li\",[t._v(t._s(e.number)+t._s(e.unit))])])]),i(\"div\",{staticClass:\"item-right\"},[i(\"a-popover\",{attrs:{trigger:\"click\"},model:{value:e.clickedVisible,callback:function(i){t.$set(e,\"clickedVisible\",i)},expression:\"item.clickedVisible\"}},[i(\"template\",{slot:\"content\"},[i(\"a-form-item\",{staticClass:\"mb\",attrs:{label:\"交期\",\"label-col\":{span:5,offset:0},\"wrapper-col\":{span:12}}},[t.updateList.date?i(\"a-date-picker\",{staticStyle:{width:\"170px\"},attrs:{format:\"YYYY-MM-DD\",value:t.moment(t.updateList.date,\"YYYY-MM-DD\")},on:{change:t.updateTime}}):i(\"a-date-picker\",{staticStyle:{width:\"170px\"},attrs:{format:\"YYYY-MM-DD\"},on:{change:t.updateTime}})],1),i(\"a-form-item\",{staticClass:\"mb\",attrs:{label:\"数量\",\"label-col\":{span:5,offset:0},\"wrapper-col\":{span:12}}},[i(\"a-input-number\",{staticStyle:{width:\"170px\"},attrs:{min:1,max:e.number},model:{value:t.updateList.num,callback:function(e){t.$set(t.updateList,\"num\",e)},expression:\"updateList.num\"}})],1),i(\"a-form-item\",{staticClass:\"mb\"},[i(\"a-button\",{on:{click:function(i){return t.uploadBom(e,a)}}},[t._v(\"修改BOM/工艺\")])],1),i(\"a-form-item\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.getMenuPermission.includes(\"DELETE\"),expression:\"getMenuPermission.includes('DELETE')\"}],staticClass:\"mb\"},[i(\"a-button\",{attrs:{type:\"danger\"},on:{click:function(i){return t.removeItem(e.id,a)}}},[t._v(\"移除\")])],1),i(\"a-form-item\",{staticClass:\"mb\"},[i(\"a-button\",{attrs:{type:\"primary\"},on:{click:function(i){return t.addLittle(e.channelSkuId,a)}}},[t._v(\"确定\")])],1)],1),i(\"a-icon\",{staticClass:\"item-right-edit\",attrs:{type:\"ellipsis\"},on:{click:function(i){return t.updataDes(i,e.number,e.odRequireDueDate,a)}}})],2),i(\"a-button\",{attrs:{type:\"primary\",shape:\"circle\",icon:\"plus\"}})],1)])])}}])},[t.loadingCompony&&!t.busy?i(\"div\",{staticClass:\"demo-loading-container\"},[i(\"a-spin\")],1):t._e()])],1)])],1),i(\"a-col\",{staticClass:\"dispatch-right\",attrs:{span:12}},[i(\"div\",{staticClass:\"title\"}),i(\"div\",{staticClass:\"order-list demo-infinite-container\"},[i(\"a-list\",{attrs:{dataSource:t.companyList},scopedSlots:t._u([{key:\"renderItem\",fn:function(e,a){return i(\"a-list-item\",{},[i(\"div\",{staticClass:\"list-item\"},[i(\"div\",{staticClass:\"item-left\"},[i(\"div\",{staticClass:\"item-left-top\"},[i(\"a\",{attrs:{href:\"javascript:;\"}},[t._v(t._s(e.name))]),i(\"span\",[t._v(t._s(e.bom)+\" \"+t._s(e.craft))])]),i(\"ul\",{staticClass:\"item-left-desc\"},[i(\"li\",[t._v(t._s(e.spec))]),i(\"li\",[t._v(t._s(e.cz))]),i(\"li\",[t._v(t._s(e.odRequireDueDate?t.moment(e.odRequireDueDate).format(t.dateFormat):\"\"))]),i(\"li\",[t._v(t._s(e.number)+t._s(e.unit))])])]),i(\"div\",{staticClass:\"item-right\"},[i(\"a-button\",{staticStyle:{background:\"#f5222d\",color:\"#fff\"},attrs:{type:\"danger\",shape:\"circle\",icon:\"minus\"},on:{click:function(e){return t.minusCompany(a)}}})],1)])])}}])}),i(\"div\",{staticStyle:{height:\"40px\"}}),i(\"div\",{staticClass:\"dispatch-right-bottom\"},[i(\"a-button\",{on:{click:t.minusCompany}},[t._v(\"取消\")]),i(\"a-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.getMenuPermission.includes(\"ADD\"),expression:\"getMenuPermission.includes('ADD')\"}],attrs:{type:\"primary\",loading:t.submitLoading},on:{click:t.submit}},[t._v(\"生成工单\")])],1)],1)])],1),i(\"a-modal\",{attrs:{title:\"选择BOM\",visible:t.visibleModal},on:{ok:t.onModalOk,cancel:t.onModalNo}},[i(\"ul\",{staticClass:\"bom-modal-list\"},[i(\"li\",{class:{modalActive:0===t.isModalActive},on:{click:function(e){return t.onModalInfo(0)}}},[t._v(\"设置工艺和BOM\")]),i(\"li\",{class:{modalActive:1===t.isModalActive},on:{click:function(e){return t.onModalInfo(1)}}},[t._v(\"选择工艺和BOM\")])])]),i(\"a-drawer\",{attrs:{destroyOnClose:\"\",placement:\"right\",closable:!1,visible:t.visible,width:1040,wrapStyle:{height:\"100%\",overflow:\"auto\",paddingBottom:\"108px\"}},on:{close:t.closeDrawer}},[i(\"dispatchInfo\",{attrs:{goodsViewInfo:t.goodsViewInfo},on:{isDrawer:t.isDrawer,setDispatchInfo:t.setDispatchInfo}})],1)],1)},n=[],s=(i(\"c5f6\"),i(\"f499\")),o=i.n(s),c=i(\"cba0\"),r=i(\"487a\"),l=i.n(r),d=i(\"0d5e\"),u=i(\"365c\"),m=i(\"c1df\"),p=i.n(m),h=i(\"350b\"),f=i(\"20c4\"),g=i(\"cd34\"),v={directives:{infiniteScroll:l.a},mixins:[g[\"a\"],g[\"b\"]],components:{dispatchInfo:h[\"a\"],inputSearch:f[\"a\"]},data:function(){return{companyType:\"FACTORY\",dateFormat:\"YYYY-MM-DD\",busy:!1,loadingCompony:!1,dataCompanySize:0,dataCompany:[],orderMerge:[],currentPage:1,pageSize:15,searchTerm:{},updateList:{num:0,date:\"\"},companyList:[],submitLoading:!1,goodsViewInfo:{},visibleModal:!1,selectIndex:\"\",isModalActive:0,channelSkuId:\"\"}},computed:{getMenuPermission:function(){return this.$store.state.menuPermission}},methods:{moment:p.a,changeInput:function(t,e){this.dataCompany=[],this.searchTerm=t,this.getFactoryOrder()},handleInfiniteOnLoad:function(){var t=this.dataCompany;this.loadingCompony=!0,this.busy=!0,t.length>=this.dataCompanySize&&0!==this.dataCompanySize?(this.busy=!0,this.loadingCompony=!1):(this.getFactoryOrder(this.currentPage),this.busy=!1,this.loadingCompony=!1)},removeItem:function(t,e){var i=this;this.$confirm({title:\"移除订单信息\",content:\"您确定要移除这条订单消息吗?\",zIndex:99999,onOk:function(){Object(d[\"e\"])(u[\"a\"].delFactoryPolicyOrder,{id:t}).then(function(t){0===t.data.code?(i.$message.success(\"订单移除成功\"),i.dataCompany.splice(e,1),i.dataCompanySize--):i.$message.error(t.data.msg)})},onCancel:function(){}})},addCompany:function(t,e,i,a){this.dispatchAction(t,e,i,a)},addLittle:function(t,e){var i=this.updateList;this.dispatchAction(t,e,i.num,i.date)},dispatchAction:function(t,e,i,a){this.selectIndex=e,this.channelSkuId=t;var n=this.dataCompany,s=this.companyList,c=n[e],r=JSON.parse(o()(c)),l=s.filter(function(t){return t.odRequireDueDate===a})[0];if(n[e].clickedVisible=!1,null===c.bom||null===c.craft)return this.visibleModal=!0,void(this.channelSkuId=t);if(0!==s.length){if(c.channelSkuId!==s[0].channelSkuId)return void this.$message.warning(\"不同产品不能合并生成工单。\");if(c.bomGroupId!==s[0].bomGroupId||c.craftGroupId!==s[0].craftGroupId)return void this.$message.warning(\"不同制造工艺和BOM不能合并生成工单。\");if(!l)return void this.$message.warning(\"不同的交期不能合并生成工单\");var d=s.filter(function(t){return t.id===c.id})[0];d?d.number+=i:(r.odRequireDueDate=a,r.number=i,s.push(r)),i>=c.number?n.splice(e,1):c.number-=i}else r.odRequireDueDate=a,r.number=i,i>=c.number?n.splice(e,1):c.number-=i,s.push(r)},uploadBom:function(t,e){this.selectIndex=e,this.dataCompany[e].clickedVisible=!1,this.channelSkuId=t.channelSkuId,this.isModalActive=1,this.onModalOk()},onModalOk:function(){this.visibleModal=!1,this.getViewInfo(this.channelSkuId),this.$store.commit(\"setPromptTitle\",{title:\"产品信息\",isEdit:!0})},onModalNo:function(){this.visibleModal=!1},setDispatchInfo:function(t){var e=this,i=this.dataCompany,a=this.selectIndex,n=t[0],s=t[1],o={};o.id=i[a].id,o.bomGroupId=n.id,o.craftGroupId=s.productCraftId,Object(d[\"e\"])(u[\"a\"].updateBomCraft,o).then(function(t){0===t.data.code?(i[a].bom=n.inputVal,i[a].craft=s.inputVal,e.$message.success(\"设置工艺和BOM成功\"),e.visible=!1):e.$message.error(t.data.msg)})},onModalInfo:function(t){this.isModalActive=t},minusCompany:function(t){if(t>=0){var e=this.companyList,i=this.dataCompany,a=e[t],n=i.filter(function(t){return t.id===a.id})[0];n?n.number+=a.number:(i.push(a),this.dataCompanySize+=1),e.splice(t,1)}else this.companyList=[],this.dataCompany=[],this.getFactoryOrder()},getFactoryOrder:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=this.searchTerm;a.currentPage=e,a.pageSize=i,Object(d[\"e\"])(u[\"a\"].getFactoryPolicyOrder,a).then(function(e){if(0===e.data.code){var i=e.data.data.records;t.dataCompanySize=Number(e.data.data.total),i.length&&(i.forEach(function(t){t.clickedVisible=!1}),t.dataCompany=t.dataCompany.concat(i)),t.currentPage+=1}}).catch(function(){t.$message.error(\"系统错误\")})},updataDes:function(t,e,i,a){window.event?window.event.cancelBubble=!0:t.stopPropagation();var n=this.updateList;n.num=e,n.date=i,this.dataCompany[a].clickedVisible=!0},updateTime:function(t,e){this.updateList.date=e},submit:function(){var t=this;if(0!==this.companyList.length){this.submitLoading=!0;var e=[],i=null,a=null;this.companyList.forEach(function(t){e.push({id:t.id,number:t.number}),i+=t.number,a=t.odRequireDueDate}),Object(d[\"e\"])(u[\"a\"].putFactoryPolicyOrderAdd,{list:e,totalNumber:i,odRequireDueDate:a,remarks:\"\"}).then(function(e){0===e.data.code?(t.$message.success(\"分单成功\"),t.companyList=[],t.orderMerge={},t.dataCompany=[],t.getFactoryOrder()):t.$message.error(e.data.msg),t.submitLoading=!1}).catch(function(){t.submitLoading=!1,t.$message.error(\"系统错误\")})}},isDrawer:function(t){this.visible=t},infoView:function(t,e,i){window.event?window.event.cancelBubble=!0:t.stopPropagation(),this.channelSkuId=e,this.selectIndex=i,this.visibleModal=!0},getViewInfo:function(t){var e=this;Object(d[\"c\"])(u[\"a\"].goodsView+\"?skuId=\".concat(t)).then(function(t){0===t.data.code&&(e.goodsViewInfo=t.data.data,e.visible=!0)}).then(function(){c[\"a\"].$emit(\"setBomButton\",!0),c[\"a\"].$emit(\"basicInfo\",{skuId:e.goodsViewInfo.sku.id,type:e.isModalActive})}).catch(function(t){console.log(t)})},handleCancel:function(){this.selectBom=!1}}},b=v,y=(i(\"b803\"),i(\"2877\")),C=Object(y[\"a\"])(b,a,n,!1,null,\"34e2b222\",null);e[\"default\"]=C.exports},\"8a76\":function(t,e,i){},b803:function(t,e,i){\"use strict\";var a=i(\"8a76\"),n=i.n(a);n.a}}]);","extractedComments":[]}